<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
            <script src="https://cdn.optimizely.com/js/421270022.js"></script>
    
                    <script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"Vg4HUlBbGwAHVlFSDgM="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{c.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(12),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){r(t.stack)}),c.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,o){try{d?d-=1:i("err",[o||new UncaughtException(t,e,n)])}catch(c){try{i("ierr",[c,(new Date).getTime(),!0])}catch(s){}}return"function"==typeof f&&f.apply(this,a(arguments))}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t){i("err",[t,(new Date).getTime()])}var i=t("handle"),a=t(13),c=t("ee"),s=t("loader"),f=window.onerror,u=!1,d=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(l){"stack"in l&&(t(5),t(4),"addEventListener"in window&&t(3),s.xhrWrappable&&t(6),u=!0)}c.on("fn-start",function(t,e,n){u&&(d+=1)}),c.on("fn-err",function(t,e,n){u&&(this.thrown=!0,o(n))}),c.on("fn-end",function(){u&&!this.thrown&&d>0&&(d-=1)}),c.on("internal-error",function(t){i("ierr",[t,(new Date).getTime(),!0])})},{}],3:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){c.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),c=t(14)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){var n=t[1],r=s(n,"nr@wrapped",function(){function t(){if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,"function":n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],4:[function(t,e,n){var r=t("ee").get("raf"),o=t(14)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],5:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration="number"==typeof t[1]?t[1]:0,t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(14)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)},{}],6:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",c)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,v,"fn-",c)}function i(t){y.push(t),h&&(w=-w,b.data=w)}function a(){for(var t=0;t<y.length;t++)r([],y[t]);y.length&&(y=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(3);var f=t("ee"),u=f.get("xhr"),d=t(14)(u),l=NREUM.o,p=l.XHR,h=l.MO,m="readystatechange",v=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],y=[];e.exports=u;var g=window.XMLHttpRequest=function(t){var e=new p(t);try{u.emit("new-xhr",[e],e),e.addEventListener(m,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(s(p,g),g.prototype=p.prototype,d.inPlace(g.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),h){var w=1,b=document.createTextNode(w);new h(a).observe(b,{characterData:!0})}else f.on("fn-end",function(t){t[0]&&t[0].type===m||a()})},{}],7:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=(new Date).getTime()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var a=t.getResponseHeader("X-NewRelic-App-Data");a&&(e.cat=a.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return h(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(8),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,l=t("id"),p=t(11),h=t(10),m=window.XMLHttpRequest;a.features.xhr=!0,t(6),f.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,p&&(p>34||p<10)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var i=h(r);i&&(n.txSize=i)}this.startTime=(new Date).getTime(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}};for(var a=0;a<d;a++)e.addEventListener(u[a],this.listener,!1)}),f.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),f.on("xhr-load-added",function(t,e){var n=""+l(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,e){var n=""+l(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)}),f.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)}),f.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=(new Date).getTime()))}),f.on("fn-end",function(t,e){this.xhrCbStart&&f.emit("xhr-cb-time",[(new Date).getTime()-this.xhrCbStart,this.onload,e],e)})}},{}],8:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],9:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[(new Date).getTime()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(12),c=t(13),s=t("ee").get("tracer"),f=NREUM;"undefined"==typeof window.newrelic&&(newrelic=f);var u=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit"],d="api-",l=d+"ixn-";a(u,function(t,e){f[e]=o(d+e,!0,"api")}),f.addPageAction=o(d+"addPageAction",!0),f.setCurrentRouteName=o(d+"routeName",!0),e.exports=newrelic,f.interaction=function(){return(new r).get()};var p=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(l+"tracer",[Date.now(),t,n],r),function(){if(s.emit((o?"":"no-")+"fn-start",[Date.now(),r,o],n),o)try{return e.apply(this,arguments)}finally{s.emit("fn-end",[Date.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){p[e]=o(l+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,(new Date).getTime()])}},{}],10:[function(t,e,n){e.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}},{}],11:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],12:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],13:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],14:[function(t,e,n){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(13),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){function n(t,e,n,o){function nrWrapper(){var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){l([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,e,o,i){o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))}function u(n,r,o){if(!s||e){var i=s;s=!0;try{t.emit(n,r,o)}catch(a){l([a,n,r,o])}s=i}}function d(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){l([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e}function l(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),n.inPlace=f,n.flag=a,n}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,c,i):i()}function n(n,r,o){if(!l.aborted){t&&t(n,r,o);for(var i=e(o),a=h(n),c=a.length,s=0;s<c;s++)a[s].apply(i,r);var f=u[g[n]];return f&&f.push([w,n,r,i]),i}}function p(t,e){y[t]=h(t).concat(e)}function h(t){return y[t]||[]}function m(t){return d[t]=d[t]||o(n)}function v(t,e){f(t,function(t,n){e=e||"feature",g[n]=e,e in u||(u[e]=[])})}var y={},g={},w={on:p,emit:n,get:m,listeners:h,context:e,buffer:v,abort:a,aborted:!1};return w}function i(){return new r}function a(){(u.api||u.feature)&&(l.aborted=!0,u=l.backlog={})}var c="nr@context",s=t("gos"),f=t(12),u={},d={},l=e.exports=o();l.backlog=u},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!b++){var t=w.info=NREUM.info,e=d.getElementsByTagName("script")[0];if(setTimeout(f.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return f.abort();s(y,function(e,n){t[e]||(t[e]=n)}),c("mark",["onload",a()],null,"api");var n=d.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}}function o(){"complete"===d.readyState&&i()}function i(){c("mark",["domContent",a()],null,"api")}function a(){return(new Date).getTime()}var c=t("handle"),s=t(12),f=t("ee"),u=window,d=u.document,l="addEventListener",p="attachEvent",h=u.XMLHttpRequest,m=h&&h.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:h,REQ:u.Request,EV:u.Event,PR:u.Promise,MO:u.MutationObserver},t(9);var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-998.min.js"},g=h&&m&&m[l]&&!/CriOS/.test(navigator.userAgent),w=e.exports={offset:a(),origin:v,features:{},xhrWrappable:g};d[l]?(d[l]("DOMContentLoaded",i,!1),u[l]("load",r,!1)):(d[p]("onreadystatechange",o),u[p]("onload",r)),c("mark",["firstbyte",a()],null,"api");var b=0},{}]},{},["loader",2,7]);</script>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ManyToOne Doctrine Relationships > Starting in Symfony2: Course 3 (2.4+) | KnpUniversity</title>

                    <link href="../../builds/main-db6835bf19d99bcc09032789f3bd39e4.css" rel="stylesheet">

        <link href='https://fonts.googleapis.com/css?family=Rokkitt' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Cedarville+Cursive' rel='stylesheet' type='text/css'>
    

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/tomorrow-night.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/tomorrow-night.min.css">


        <link rel="stylesheet" href="../../builds/code_block_styles-2d783e385d9dbb1ef88d9053d1b8d675.css">



    <link href="../../builds/video-6b5fa6dfb768239b226d39d08bd4867e.css" rel="stylesheet">

                        <script src="../../bundles/fosjsrouting/js/router.js"></script>

        <script src="../../builds/main-1dfa89b76a105f9c2d98.js"></script>
        <script src="../../js/routing?callback=fos.Router.setData"></script>
            

    <script>
        // video settings
        window.video = {
            isCourseChapterPaid: true,
            courseChapterId: 15611
        };

                window.video.nextDetails = {
            'type': 'video',
            'title': 'Up Next: Sharing\x20Data\x20between\x20Fixture\x20Classes <i class="fa fa-play"></i>',
            'url': '/screencast/symfony2-ep3/sharing-data-fixtures#play'
        };
            </script>

    <script src="../../builds/video-1dfa89b76a105f9c2d98.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            var hashValue = window.location.hash.substr(1);
            if (hashValue.substr(0, 7) == 'comment') {
                // this is a #comment link - open up the comment tab!
                $('.nav-tabs a[href="#tab-comment"]').click();
            }
        });
    </script>

    <link rel="alternate" type="application/rss+xml" title="Blog feed with technical articles around PHP and screencast and tutorial updates from KnpUniversity.com" href="http://feeds.feedburner.com/knpuniversity" />

    <meta name="description" content="Welcome back for part 3 of our Starting in Symfony2 series! In part 3 of this series, we&#039;re going to discover even more about Symfony and begin to learn more about how Symfony really works under the hood. Over the next hour or so, we&#039;re going to learn what a service is, find out more about the core Symfony services, and create a few of our own. In Doctrine, we&#039;ll create some Doctrine associations, including ManyToOne and ManyToMany relationships. We&#039;ll also talk about lifecycle callbacks and event listeners. Plus a ton more!

Highlights:

* Doctrine relations, metadata, and the JoinColumn
* ManyToMany relationship that&#039;s bidirectional, owning versus inverse side and why that matters
* Loading fixtures with shared data
* Creating shortcuts with your very own base controller!
* Doctrine extensions: timestampable, sluggable
* Ajax: returning Json from a controller, setting the content type and the _format parameter
* Customizing error pages at the template and controller level
* Overriding bundle templates
* Embedding other controllers with Twig&#039;s render tag
* Services! What they are, where to find and use the core services, and a step-by-step on how to create your own. Also, demystifying dependency injection.
* Creating your very own Twig extension
* Doctrine lifecycle callbacks and how to create and leverage your own doctrine event listener service
">

    <meta property="og:site_name" content="KnpUniversity - PHP and Symfony Video Tutorial Screencasts">
    <meta name="twitter:site" content="@KnpUniversity"><link rel="shortcut icon" href="../../assets/images/favicon.ico">
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->    <meta property="og:title" content="ManyToOne Doctrine Relationships">
<meta property="og:description" content="Welcome back for part 3 of our Starting in Symfony2 series! In part 3 of this series, we&amp;#039;re going to discover even more about Symfony and begin to learn more about how Symfony really works under the hood. Over the next hour or so, we&amp;#039;re going to learn what a service is, find out more about the core Symfony services, and create a few of our own">
<meta property="og:url" content="http://knpuniversity.com/screencast/symfony2-ep3/doctrine-relationship">
    <meta property="og:image" content="http://knpuniversity.com/imagine/course_video_poster_large/uploads/screencast/symfony2-ep3:248cf7b3f824f16696190ac7ac2bbeec1163a4ae/sf2-ep3.png">

<meta name="twitter:card" content="summary">


                            
    </head>
<body data-user-id="" >
<nav class="navbar navbar-inverse nav-margin navbar-learning-layout">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle toggle-button collapsed" data-toggle="collapse" data-target="#js-navbar" aria-expanded="false" aria-controls="js-navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../logout" class="navbar-brand">
                <span class="knp-color-blue">Knp</span>
                <span class="knp-color-white">University</span>
            </a>
        </div>
        <form class="navbar-form navbar-left navbar-form-border" role="search" method="GET" action="http://knpuniversity.com/search">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search Tutorials" value="" name="q">

                <div class="input-group-btn">
                    <button class="btn btn-default" type="submit">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </div>
        </form>
        <div id="js-navbar" class="collapse-fix collapse navbar-right navbar-collapse">
            

<ul class="nav navbar-nav nav-narrowerOnSmall">
            <li><a href="../../checkout/subscription/team_yearly/5" title="Cart"><i class="fa fa-shopping-cart"></i></a></li>
        <li class="dropdown"><a href="doctrine-relationship#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <i class="fa fa-angle-down"></i></a>
        <ul class="dropdown-menu">
          <li><a href="../../tracks.1">Tracks</a></li>
          <li><a href="../../courses/all">All Courses</a></li>
        </ul>
    </li>
            <li><a href="../../pricing.1">Pricing</a></li>
        <li><a href="../../training">Training</a></li>
                <li class="visible-xs"><a href="../../logout">My Profile</a></li>
        <li class="visible-xs"><a href="../../logout">Sign Out</a></li>

            <li><a href="../../login.1">Log In</a></li>
        <li class="btn btn-sm btn-warning signup-btn"><a class="signup" href="../../signup/index.html">Sign Up</a></li>
    </ul>

        </div>
    </div>
</nav>


    




<div class="table-contents-container">
  <div class="container expandList" id="js-chapter-list">
      <button class="table-contents-container-button js-expand-list" data-target="js-chapter-list" title="Chapter List">
          <i class="fa fa-bars"></i>
                        2.
                            ManyToOne Doctrine Relationships
                </button>
      <div class="expandList-body">
          <div class="expandList-bodyInner">
              <h3 class="expandList-header">
                  <a class="course-title-expand" href="../starting-in-symfony2-episode-3-2-1">Starting in Symfony2: Course 3 (2.4+)</a>
              </h3>

                                <div class="watched-tut-progress-container watched-tut-progress-container-overview">
        <div class="watched-tut-progress-overview" style="width: 0%; margin-right: 100%;" title="0% complete"><span class="profile-progress-title">0%</span></div>
    </div>


              
              <div class="expand-chapter-list">
                      
    
    <!-- Table of contents -->
    <div class="chapter-list">
        <ul class="list-unstyled">
            
                
                                <li class="title chapter-list-item ">
            <a href="intro" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                1.
                        Introduction
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 1:00</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item chapter-list-item-active">
            <a href="doctrine-relationship" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                2.
                        ManyToOne Doctrine Relationships
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:40</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="sharing-data-fixtures" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                3.
                        Sharing Data between Fixture Classes
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 1:49</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="event-edit-security" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                4.
                        Restricting Edit Access to Owners
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 1:53</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="base-controller" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                5.
                        Using a shortcut Base Controller Class
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:30</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="phpdoc-autocomplete" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                6.
                        Using PHPDoc for Auto-Completion
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 1:26</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="doctrine-inverse-relation" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                7.
                        OneToMany: The Inverse Side of a Relationship
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 5:37</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="doctrine-extensions" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                8.
                        Doctrine Extensions: Sluggable and Timestampable
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:30</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="slug-url" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                9.
                        Using the slug in the Event URL
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:04</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="timestampable" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                10.
                        Adding createdAt and updatedAt Timestampable Fields
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 1:41</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="custom-repository-query" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                11.
                        Creating a Custom orderBy Query
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:11</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="many-to-many-relationship" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                12.
                        ManyToMany Relationship
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:37</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="using-many-to-many" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                13.
                        Using the ManyToMany so Users can Attend an Event
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:53</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="using-many-to-many2" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                14.
                        More with ManyToMany: Avoiding Duplicates
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:51</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="json-response" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                15.
                        JSON up in your Response
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:50</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="content-type-jsonresponse" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                16.
                        Come on, Set the Content-Type Header!
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 3:19</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="attend-event-ajax" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                17.
                        Adding the AJAX Touch: JavaScript
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:16</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="error-pages" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                18.
                        Customizing Error Pages and How Errors are Handled
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 6:01</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="render-controller" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                19.
                        Render another Controller in Twig
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:28</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="csv-download" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                20.
                        Creating a Pretty CSV Download
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:19</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="services" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                21.
                        Your Very First Service
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:42</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="service-container" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                22.
                        Symfony Overlord: The Service Container
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:58</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="config-imports-type-hinting" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                23.
                        Configuration Loading and Type-Hinting
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:01</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="more-dependency-injection" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                24.
                        Dependency Inject All the Things
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 3:14</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="twig-extension-listener" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                25.
                        Twig Extensions and Dependency Injection Tags
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:33</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="doctrine-lifecycle-callback" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                26.
                        Doctrine is in your Lifecycle (with Callbacks)
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:08</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="doctrine-listener" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                27.
                        Doctrine Event Listeners
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 5:59</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="doctrine-listener-update" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                28.
                        Doctrine Listeners on Update
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:48</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="outro" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                29.
                        Keep Going!
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 1:19</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


                    </ul>
    </div>

    
              </div>
          </div>
      </div>
  </div>
  <div>
                <a href="../../pricing/symfony2-ep3" class="btn btn-success pull-right-md download-buy-buttons">Buy <span class="hidden-xs">Access to Course</span></a>
              </div>
</div>


        <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-9 col-lg-10">
                <h1 class="account-header account-header-low-margin-top">ManyToOne Doctrine Relationships</h1>
                    <div style="margin-bottom: 10px;">
        <span class="label label-success">UPGRADE!</span>
        <a href="../symfony/resume">Check out the newest version of this tutorial</a>
    </div>

                                    <p class="hidden-xs">
                        Course:
                        <a class="knp-color-black" href="../starting-in-symfony2-episode-3-2-1"><em>Starting in Symfony2: Course 3 (2.4+) Tutorial</em></a>                    </p>
                            </div>
        </div>

                <div class="row">
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <div class="full-block-container">
                    <div class="frame-padding">
                        <div id="player">
                                                        <div class="hidden alert alert-danger js-video-not-supported" style="margin-bottom: 10px;">
        <h4>Video not working?</h4>
        It looks like your browser may not support the H264 codec.
        If you're using Linux+Firefox, try a different browser or try
        installing the
        <code>gstreamer0.10-ffmpeg</code>
        <code>gstreamer0.10-plugins-good</code> packages.
        <br/><br/>
        Thanks! This saves us
        from needing to use Flash or encode videos in multiple formats. And that
        let's us get back to making more videos :). But as always, please feel
        free to <a href="../../contact">message us</a>.
    </div>

    <video id="js-video-player" class="video-js vjs-default-skin vjs-big-play-centered "
            controls preload="auto" width="auto" height="auto"
            poster="http://i.vimeocdn.com/video/536604798_960x600.jpg?r=pad">
        <source src="http://player.vimeo.com/external/140207117.hd.mp4?s=c6b75d1efbc400d408f569b5b676712e310a9677&amp;profile_id=113&amp;oauth2_token_id=308801954" type="video/mp4" data-res="HD" data-default="true" />
        <source src="http://player.vimeo.com/external/140207117.sd.mp4?s=ce6fc394d15ceeafa400428b8f5fdc2e66a7e448&amp;profile_id=112&amp;oauth2_token_id=308801954" type="video/mp4" data-res="SD" />
        <p class="vjs-no-js">
            To view this video please enable JavaScript, and consider upgrading to a web browser that
            <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
        </p>
    </video>


                            <div class="end-show js-post-play-wrapper" style="display: none;">
                                <p class="end-show-header">You're Killing it!</p>

                                <div class="text-center overlay-btn">
                                    <!-- This is filled in via JS -->
                                    <a href="doctrine-relationship#" class="btn btn-lg btn-warning js-next-item-anchor"></a>
                                    <div class="js-all-finished-holder" style="display: none; color: #fff;">
                                        Another Tutorial down!<br/><br/>
                                                                                    <a href="../../tracks/symfony2" class="btn btn-lg btn-success">Back to the <i>Symfony 2</i> Track</a>
                                                                            </div>
                                </div>

                                <p class="end-show-link js-video-repeat"><a class="knp-color-white link-no-underline" href="doctrine-relationship#">
                                    <i class="fa fa-repeat"></i> Watch again
                                </a></p>
                            </div>
                                                </div>
                    </div>
                </div>
            </div>
        </div>
         
        <div class="row">
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <div class="pull-right">
                                    <a class="btn btn-success"
           href="sharing-data-fixtures#play">
            Next Chapter <i class="fa fa-caret-right"></i>
        </a>
    
                </div>

                <ul class="nav nav-tabs" role="tablist">
                    <li class="active"><a data-toggle="tab" href="doctrine-relationship#tab-script">Script</a></li>
                    <li><a data-toggle="tab" href="doctrine-relationship#tab-comment">
                        <i class="fa fa-comment-o"></i>
                                                    
                                                                                                (9)
                                                                                        Conversation
                                            </a></li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="tab-script">
                        <div class="js-script-content-wrapper top-margin-script script-content">
                                                                                        <a href="https://github.com/knpuniversity/symfony2-series/edit/master/knpu/episode3/doctrine-relationship.rst" target="_blank" class="btn btn-default btn-circle pull-right js-tooltip" title="Edit on GitHub"><span class="fa fa-pencil"></span></a>
                                                                    
  <div class="section" id="manytoone-doctrine-relationships">
<h1>ManyToOne Doctrine Relationships<a class="headerlink" href="doctrine-relationship#manytoone-doctrine-relationships" title="Permalink to this headline">Â¶</a></h1>
<p>Right now, if I creat an Event, there&#8217;s no database link back to my user.
We don&#8217;t know which user created each Event.</p>
<p>To fix this, we need to create a <tt class="docutils literal"><span class="pre">OneToMany</span></tt> relationship from <tt class="docutils literal"><span class="pre">User</span></tt>
to <tt class="docutils literal"><span class="pre">Event</span></tt>. In the database, this will mean a <tt class="docutils literal"><span class="pre">user_id</span></tt> foreign key column
on the <tt class="docutils literal"><span class="pre">yoda_event</span></tt> table.</p>
<p>In Doctrine, relationships are handled by creating links between objects.
Start by creating an <tt class="docutils literal"><span class="pre">owner</span></tt> property inside Event:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Yoda/EventBundle/Entity/Event.php</span>
<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">Event</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">protected</span> <span class="nv">$owner</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For normal fields, we use the <tt class="docutils literal"><span class="pre">&#64;ORM\Column</span></tt> annotation. But for relationships,
we use <tt class="docutils literal"><span class="pre">&#64;ORM\ManyToOne</span></tt>, <tt class="docutils literal"><span class="pre">&#64;ORM\ManyToMany</span></tt> or <tt class="docutils literal"><span class="pre">&#64;ORM\OneToMany</span></tt>. This
is a <tt class="docutils literal"><span class="pre">ManyToOne</span></tt> relationship because many events may have the same <em>one</em>
<tt class="docutils literal"><span class="pre">User</span></tt>. I&#8217;ll talk about the other 2 relationships later (<a class="reference internal" href="doctrine-inverse-relation"><em>OneToMany</em></a>,
<a class="reference internal" href="many-to-many-relationship"><em>ManyToMany</em></a>).</p>
<p>Add the <tt class="docutils literal"><span class="pre">&#64;ORM\ManyToOne</span></tt> relationship and pass in the entity that forms
the other side:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Yoda/EventBundle/Entity/Event.php</span>
<span class="c1">// ...</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\ManyToOne(targetEntity=&quot;Yoda\UserBundle\Entity\User&quot;)</span>
<span class="sd"> */</span>
<span class="k">protected</span> <span class="nv">$owner</span><span class="p">;</span>
</pre></div>
</div>
<p>Next, create the getter and setter for the the new property:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Yoda/EventBundle/Entity/Event.php</span>
<span class="c1">// ...</span>

<span class="k">use</span> <span class="nx">Yoda\UserBundle\Entity\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Event</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOwner</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">owner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setOwner</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$owner</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">owner</span> <span class="o">=</span> <span class="nv">$owner</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notice that when we call <tt class="docutils literal"><span class="pre">setOwner</span></tt>, we&#8217;ll pass it an actual <tt class="docutils literal"><span class="pre">User</span></tt> object,
<em>not</em> the id of a user. But when you save an <tt class="docutils literal"><span class="pre">Event</span></tt>, Doctrine will use
the owner&#8217;s id value to populate an <tt class="docutils literal"><span class="pre">owner_id</span></tt> column on the <tt class="docutils literal"><span class="pre">yoda_event</span></tt>
table. So we link objects to objects in PHP, and Doctrine takes care of setting
the foreign key id value for us. If you&#8217;re newer to an ORM, this is one of
the toughest things to understand about Doctrine.</p>
<div class="section" id="updating-the-database">
<h2>Updating the Database<a class="headerlink" href="doctrine-relationship#updating-the-database" title="Permalink to this headline">Â¶</a></h2>
<p>How can we update our database with the new column and foreign key? Why, with
the <tt class="docutils literal"><span class="pre">doctrine:schema:update</span></tt> command of course! I&#8217;ll dump the SQL to the
terminal first to see it:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console doctrine:schema:update --dump-sql
php app/console doctrine:schema:update --force
</pre></div>
</div>
<p>As expected, the SQL that&#8217;s generated will add a new <tt class="docutils literal"><span class="pre">owner_id</span></tt> field to
<tt class="docutils literal"><span class="pre">yoda_event</span></tt> along with the foreign key constraint.</p>
</div>
<div class="section" id="manytoone-options">
<h2>ManyToOne Options<a class="headerlink" href="doctrine-relationship#manytoone-options" title="Permalink to this headline">Â¶</a></h2>
<p>Since I&#8217;m feeling fancy, let&#8217;s configure a few things. Whenever you have
a <tt class="docutils literal"><span class="pre">ManyToOne</span></tt> annotation, you can optionally add an <tt class="docutils literal"><span class="pre">&#64;ORM\JoinColumn</span></tt>
annotation to control some database options.</p>
<div class="section" id="joincolumn-ondelete">
<h3>JoinColumn onDelete<a class="headerlink" href="doctrine-relationship#joincolumn-ondelete" title="Permalink to this headline">Â¶</a></h3>
<p>To add a database-level &#8220;ON DELETE&#8221; cascade behavior, add the <tt class="docutils literal"><span class="pre">onDelete</span></tt>
option:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Yoda/EventBundle/Entity/Event.php</span>
<span class="c1">// ...</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\ManyToOne(targetEntity=&quot;Yoda\UserBundle\Entity\User&quot;)</span>
<span class="sd"> * @ORM\JoinColumn(onDelete=&quot;CASCADE&quot;)</span>
<span class="sd"> */</span>
<span class="k">protected</span> <span class="nv">$owner</span><span class="p">;</span>
</pre></div>
</div>
<p>Now, let&#8217;s run the <tt class="docutils literal"><span class="pre">doctrine:schema:update</span></tt> command again:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console doctrine:schema:update --dump-sql
php app/console doctrine:schema:update --force
</pre></div>
</div>
<p>The SQL tells us that this actually re-creates the foreign key with the &#8220;on delete&#8221;
behavior. So if we delete a <tt class="docutils literal"><span class="pre">User</span></tt>, the database will automatically delete
all rows in the <tt class="docutils literal"><span class="pre">yoda_event</span></tt> table that link to that user and ship them off into
hyper space.</p>
</div>
<div class="section" id="the-cascade-option">
<h3>The cascade Option<a class="headerlink" href="doctrine-relationship#the-cascade-option" title="Permalink to this headline">Â¶</a></h3>
<p>Another common option is <tt class="docutils literal"><span class="pre">cascade</span></tt> on the actual <tt class="docutils literal"><span class="pre">ManyToOne</span></tt> part:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Yoda/EventBundle/Entity/Event.php</span>
<span class="c1">// ...</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\ManyToOne(targetEntity=&quot;Yoda\UserBundle\Entity\User&quot;, cascade={&quot;remove&quot;})</span>
<span class="sd"> * @ORM\JoinColumn(onDelete=&quot;CASCADE&quot;)</span>
<span class="sd"> */</span>
<span class="k">protected</span> <span class="nv">$owner</span><span class="p">;</span>
</pre></div>
</div>
<p>This is like <tt class="docutils literal"><span class="pre">onDelete</span></tt>, but in the opposite direction. With this, if we
delete an Event, it will <em>cascade</em> the remove onto the owner. In other words,
If I delete an Event, it will also delete the User who is the owner.</p>
<p>Run <tt class="docutils literal"><span class="pre">doctrine:schema:update</span></tt> again:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console doctrine:schema:update --dump-sql
</pre></div>
</div>
<p>Now, it doesn&#8217;t want to change our database at all. Unlike <tt class="docutils literal"><span class="pre">onDelete</span></tt>,
this behavior is enforced entirely by Doctrine in PHP, not in the database layer.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can also cascade <tt class="docutils literal"><span class="pre">persist</span></tt>, which is useful at times with <tt class="docutils literal"><span class="pre">ManyToMany</span></tt>
relationship where you&#8217;re creating new items in the relationship.</p>
</div>
<p>Remove the <tt class="docutils literal"><span class="pre">cascade</span></tt> option because it&#8217;s dangerous in our situation:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Yoda/EventBundle/Entity/Event.php</span>
<span class="c1">// ...</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\ManyToOne(targetEntity=&quot;Yoda\UserBundle\Entity\User&quot;)</span>
<span class="sd"> * @ORM\JoinColumn(onDelete=&quot;CASCADE&quot;)</span>
<span class="sd"> */</span>
<span class="k">protected</span> <span class="nv">$owner</span><span class="p">;</span>
</pre></div>
</div>
<p>If we delete an Event, we definitely don&#8217;t want that to delete the Event&#8217;s
owner. Darth would be so angry.</p>
</div>
</div>
<div class="section" id="linking-an-event-to-its-owner-on-creation">
<h2>Linking an Event to its owner on creation<a class="headerlink" href="doctrine-relationship#linking-an-event-to-its-owner-on-creation" title="Permalink to this headline">Â¶</a></h2>
<p>Time to put our shiny relationship to the test. When a new <tt class="docutils literal"><span class="pre">Event</span></tt> object
is created, let&#8217;s associate it with the <tt class="docutils literal"><span class="pre">User</span></tt> object for whoever is logged
in:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Yoda/EventBundle/Controller/EventController.php</span>
<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">createAction</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To complete the link, just call <tt class="docutils literal"><span class="pre">setOwner</span></tt> on the Event and pass in the <em>whole</em>
<tt class="docutils literal"><span class="pre">User</span></tt> object:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Yoda/EventBundle/Controller/EventController.php</span>
<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">createAction</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>

        <span class="nv">$entity</span><span class="o">-&gt;</span><span class="na">setOwner</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>

        <span class="c1">// ... the existing save logic</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Yep, that&#8217;s it. When we save the Event, Doctrine will automatically grab
the id of the <tt class="docutils literal"><span class="pre">User</span></tt> object and place it on the <tt class="docutils literal"><span class="pre">owner_id</span></tt> field.</p>
<p>Time to test! Login as Wayne. Remember, he has <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt>, which also
means he has <tt class="docutils literal"><span class="pre">ROLE_EVENT_CREATE</span></tt> because of the <tt class="docutils literal"><span class="pre">role_hierarchy</span></tt> section
in <tt class="docutils literal"><span class="pre">security.yml</span></tt>.</p>
<p>Now, fill in some basic data and submit it. To see the result, use the query
tool to list the events:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console doctrine:query:sql <span class="s2">&quot;SELECT * FROM yoda_event&quot;</span>
</pre></div>
</div>
<p>Sure enough, our newest event is linked back to our user! #Winning</p>
</div>
</div>


    
                        </div>
                    </div>
                    <div class="tab-pane" id="tab-comment">
                        <h3>Leave a comment!</h3>
                                                        <div id="disqus_thread">
                <style type="text/css">
            #dsq-comments {padding: 10px 0 0}
            .dsq-comment {position: relative;clear: both;margin: 0 0 1.5em;}
            .dsq-avatar {left: 0;position: absolute;}
            .dsq-avatar img {border: 0 none;border-radius: 3px;height: 36px;width: 36px;}
            .dsq-comment-body {padding: 0 0 0 46px;}
            .dsq-comment-header {border: 1px solid rgba(0, 0, 0, 0.15);border-radius: 3px;font-size: 13px;line-height: 14px;margin: 0 0 1em;max-height: 36px;overflow: hidden;padding: 10px;position: relative;text-overflow: ellipsis;white-space: nowrap;}
            .dsq-comment-message {word-wrap: break-word;}
            .dsq-comment-message {line-height: 1.5em;margin: 0 0 1em;}
            .dsq-comment-text {display: inline;}
            .dsq-comment-date {float: right;font-size: 90%;margin: 0 12px 0 0;}
        </style>

	    <div id="dsq-content">
	        <ul id="dsq-comments">
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2265469969" id="dsq-comment-2265469969">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/shairyarbaig/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/10592/9062/avatar92.jpg?1469787361">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2265469969">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-09-21</span>
	                            <span class="dsq-commenter-name">Shairyar Baig</span>
	                        </div>

	                        <div id="dsq-comment-message-2265469969" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2265469969" class="dsq-comment-text">
	                                <p>Thanks Ryan, Really appreciate the help.....</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2265460137" id="dsq-comment-2265460137">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2265460137">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-09-21</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2265460137" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2265460137" class="dsq-comment-text">
	                                <p>Hey again!</p><p>1) Yep, I agree with the OneToMany because cards cannot have multiple surveys.</p><p>2) The easiest way to delete a card is to do it just like you said: have an action, with the {id} of the card in the URL, and delete it that way. The "collection" form type also has an "allow_delete" option, but it can be a bit tricky, as you need to make sure you "unlink" the relationship in the removeXX method and also probably need to use the orphanRemoval option so that Doctrine fully deletes the removed Creditcards (not just unlink them from the Survey). Your way is much easier.</p><p>3) We talk about this a little bit here: <a href="http://disq.us/url?url=http%3A%2F%2Fknpuniversity.com%2Fscreencast%2Fsymfony2-ep3%2Fdoctrine-relationship%23the-cascade-option%3AqBfr7ymRppOyMyw0zrUSFsZdyRI&amp;cuid=1175718" rel="nofollow noopener">http://knpuniversity.com/scree...</a> - I rarely use the cascade option. Basically, it says "If I save a Survey, automatically call $em-&gt;persist() on all of the related Creditcards entities linked to it". In your case, in your controller, you're never looping over $survey-&gt;getCreditcards() and calling $em-&gt;persist() on each, so without the cascade, Doctrine says "You told me to persist this Survey, and this survey is related to these 2 Creditcards, but you did not tell me to persist them. What the heck?". I usually call persist() manually on all of my entities, to avoid any wtf issues later. But, this is probably the best situation for cascade persist. I would still probably remove it and manually loop over the linked creditCards in your controller and persist them.</p><p>Thanks for the nice comment - I love it!</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2265449245" id="dsq-comment-2265449245">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/shairyarbaig/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/10592/9062/avatar92.jpg?1469787361">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2265449245">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-09-21</span>
	                            <span class="dsq-commenter-name">Shairyar Baig</span>
	                        </div>

	                        <div id="dsq-comment-message-2265449245" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2265449245" class="dsq-comment-text">
	                                <p>Wow, that did fix the problem, I did not know when collectionType is used we do not need to worry about getting the linked data saved, thats great to know.</p><p>I have couple of queries to get the concept straight</p><p>1)<br>The relationship I am using here between Survey and Creditcard is OneToMany bidirectional, is this is correct relationship? A survey can have multiple cards linked to it, but the cards cannot have multiple surveys they can be linked with only one survey. I dont think ManyToMany relationship goes here, correct?</p><p>2)<br>How will the delete work here if I need to delete one card? will that be linked with an action with get parameter card id and based on the id run the delete query or Symfony has a shortcut to that?</p><p>3)<br>My survey.orm.yml where I have defined OneToMany relationship, I had to use cascade: ["persist"], what is the purpose of this?</p><p>You asked me the reason for  manual data setting, its actually an extremely long survey which is broken down is different forms, i was doing the manual data setting as i did not want one section to overwrite the data of other section while saving and now i realize i do not need to do that as symfony will do it for me automatically and all I need to do is  $em-&gt;flush(); i have no idea why i did that :) may be i was going crazy making the relationship work and save data :)</p><p>Coming across this website is such a blessing :)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2265309551" id="dsq-comment-2265309551">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2265309551">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-09-21</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2265309551" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2265309551" class="dsq-comment-text">
	                                <p>Hey Shairyar!</p><p>Hmm, I can see a few things initially. First, what's the purpose of all the manual data setting here? <a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fshairyar%2F48e0b76a5c590342a288%23file-defaultcontroller-php-L19%3AW0xdUucsjnjMj0t8aL-Hsl7UpZs&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/shairy...</a>. I think this is at the root of your problem, specifically the line where you set the creditCards field: <a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fshairyar%2F48e0b76a5c590342a288%23file-defaultcontroller-php-L23%3A5LMDCe4LtTlERxaZKiYJOgcR9sY&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/shairy...</a>.</p><p>When you have a collectionType, it looks for an addCreditCard method and calls that for all the new credit cards added. You *do* have this method, and so it's being called. But then you're immediately re-setting this whole property in the controller, but you're now skipping the addCreditCard method by saying getCreditCards()-&gt;add(...);. That may or may not be part if the problem, but I'd get rid of that: you *do* want to use your adder* function :).</p><p>The real problem is that the "owning" side (a concept I talk about about here <a href="https://disq.us/url?url=https%3A%2F%2Fknpuniversity.com%2Fscreencast%2Fsymfony2-ep3%2Fdoctrine-inverse-relation%23owning-versus-inverse-side%3AeutOXLb7rEqVi6E3jO2bi6CtNq0&amp;cuid=1175718" rel="nofollow noopener">https://knpuniversity.com/scre...</a> - because it *is* tricky) if your relationship is never set, which directly leads to your first error. Your "adder" function would need to look like this:</p><p></p><pre><code><br>public function addCreditCard(CreditCard $card)<br>{<br>    if (!$this-&gt;creditcards-&gt;contains($card)) {<br>        $this-&gt;creditcards-&gt;add($card);<br>    }<br><br><br>    // THIS IS THE KEY PART<br>    $card-&gt;setSurvey($this);<br>}<br></code></pre><p></p><p>That sets the owning side, and is likely the key to your issue. This stuff is hard: only setting the "owning" side (e.g. CreditCard::setSurvey) does anything for saving to Doctrine.</p><p>Good luck!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2265225740" id="dsq-comment-2265225740">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/shairyarbaig/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/10592/9062/avatar92.jpg?1469787361">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2265225740">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-09-21</span>
	                            <span class="dsq-commenter-name">Shairyar Baig</span>
	                        </div>

	                        <div id="dsq-comment-message-2265225740" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2265225740" class="dsq-comment-text">
	                                <p>Hi Ryan,</p><p>I am working with oneToMany bidirectional Entity and I am having problem saving the data</p><p>I have an entity called survey and I have an entity called Creditcards</p><p>Creditcard is linked with survey using manyToOne</p><p>survey is linked with Creditcard using oneToMany</p><p>The survey has bunch of financial related questions which gets saved in survey table and it also asks user for their creditcard related details which then gets saved in Creditcard table, since user can have more than 1 card so they can add multiple card details and this is where the manyToOne andoneToMany comes into play.</p><p>There are two errors that I run into and I just cant seem to get past them, its probably my lack of Symfony knowledge,</p><p>The first error I see is</p><p></p><pre><code><br>A new entity was found through the relationship 'ExampleBundle\Entity\survey#creditcards' that was not configured to cascade persist operations for entity: ExampleBundle\Entity\Creditcards@000000001bbd76da000000008bbf1e28. To solve this issue: Either explicitly call EntityManager#persist() on this unknown entity or configure cascade persist this association in the mapping for example @ManyToOne(..,cascade={"persist"}). If you cannot find out which entity causes the problem implement 'ExampleBundle\Entity\Creditcards#__toString()' to get a clue.<br>500 Internal Server Error - ORMInvalidArgumentException<br></code></pre><p><code><br></code></p><p>So while trying to fix this I then run into</p><p></p><pre><code><br>The class 'Doctrine\ORM\PersistentCollection' was not found in the chain configured namespaces ExampleBundle\Entity, UserBundle\Entity<br></code></pre><p><code><br></code></p><p>At this stage I am pretty cluelss what to do and I am hoping if you can help me figure this out.</p><p>This the code is too long, rather than pasting it here I have created a gist.</p><p>This is my Creditcard.orm.yml</p><p><a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fshairyar%2F48e0b76a5c590342a288%23file-creditcards-orm-yml%3AgSw8-fxwHmGZ-AlLJcydUuL-qHI&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/shairy...</a></p><p>This is my This is my Creditcard Entity</p><p><a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fshairyar%2F48e0b76a5c590342a288%23file-creditcards-php%3AHqOPd1m-FyEx8XCaJk26LM7AJ3k&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/shairy...</a></p><p>This is my survey.orm.yml</p><p><a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fshairyar%2F48e0b76a5c590342a288%23file-survey-orm-yml%3A3kh8OCsuKuU80FOAWM-5c90QmuA&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/shairy...</a></p><p>This is my survey Entity</p><p><a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fshairyar%2F48e0b76a5c590342a288%23file-survey-php%3ACPhxz3m-leK5T4grBuY-70hLxh4&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/shairy...</a></p><p>The Form that gets called in controller and passed to the twig</p><p><a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fshairyar%2F48e0b76a5c590342a288%23file-debttype-php%3AFjxi0A8P3Z7eVRmlj_ipWyO92B0&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/shairy...</a></p><p>Finally my debtAction that processes the form and tries to save the data</p><p><a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fshairyar%2F48e0b76a5c590342a288%23file-defaultcontroller-php%3AxFuqVuCAm4Zzxy8WHu5vGBYjYY0&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/shairy...</a></p><p>I have gone through the following step by step article but I just cant get the save to work</p><p><a href="http://disq.us/url?url=http%3A%2F%2Fsymfony.com%2Fdoc%2Fcurrent%2Fcookbook%2Fform%2Fform_collections.html%3A7L-_QiRfnefswycPQPzfJhaUo_w&amp;cuid=1175718" rel="nofollow noopener">http://symfony.com/doc/current...</a></p><p>I will really appreciate if you can help me understand what am i doing wrong?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2165097352" id="dsq-comment-2165097352">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2165097352">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-30</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2165097352" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2165097352" class="dsq-comment-text">
	                                <p>In PhpStorm, goto the "Code" menu on top and then select "Generate". I'm using the Mac shortcut for this - which is cmd+n.</p><p>Yea, having this is HUGE for productivity. We're releasing a screencast all about being super fast in PhpStorm - <a href="http://disq.us/url?url=http%3A%2F%2Fknpuniversity.com%2Fscreencast%2Fphpstorm%3AltmbPy8XBvpyfjTN7_Ta2ASenzM&amp;cuid=1175718" rel="nofollow noopener">http://knpuniversity.com/scree...</a></p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2164384333" id="dsq-comment-2164384333">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/scarlettpratt/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/16741/1930/avatar92.jpg?1467857161">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2164384333">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-30</span>
	                            <span class="dsq-commenter-name">Scarlett Pratt</span>
	                        </div>

	                        <div id="dsq-comment-message-2164384333" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2164384333" class="dsq-comment-text">
	                                <p>How did you automatically create the getter and setter in your text editor? Thanks!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="1619261406" id="dsq-comment-1619261406">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="doctrine-relationship">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-1619261406">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2014-10-04</span>
	                            <span class="dsq-commenter-name">Arno</span>
	                        </div>

	                        <div id="dsq-comment-message-1619261406" class="dsq-comment-message">
	                            <div id="dsq-comment-text-1619261406" class="dsq-comment-text">
	                                <p>Doh! Had an error in the UserRepository:refreshUser() function: I was returning the old $user not the new $refreshedUser obect.<br>Well, at least I learned something about the inner workings of Symfony &amp; Doctrine while debugging this :o) With this fix my "solution" from the previous comment is no longer necessary (basically it is what refreshUser() does).</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="1619226659" id="dsq-comment-1619226659">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="doctrine-relationship">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-1619226659">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2014-10-04</span>
	                            <span class="dsq-commenter-name">Arno</span>
	                        </div>

	                        <div id="dsq-comment-message-1619226659" class="dsq-comment-message">
	                            <div id="dsq-comment-text-1619226659" class="dsq-comment-text">
	                                <p>When I try this tutorial, I get an error about "A new entity was found through the relationship". I finally tracked down the cause: the $user-object from $this-&gt;getUser() is reconstructed from the security.context (unserialized from the token). The entity manager does not know about this object and thus fails.</p><p>I tried various ways (e.g. $em-&gt;merge() instead of $em-&gt;persist, or adding cascade=PERSIST to the relationship), but none worked, partly because (a) as part of a former episode we don't serialize the complete $user-object - and even if we did (I tried it) - we would create another user of the same name &amp; email address.</p><p>Conclusio: The entity manager does not know about the $user-object which is unserialized from the token. Instead I modified the code like this:</p><p>$user = $this-&gt;getUser();   // user reconstructed from token<br>$em = $this-&gt;getDoctrine()-&gt;getManager();<br>$user = $em-&gt;getRepository('UserBundle:User')-&gt;find($user-&gt;getId());</p><p>This way we get the complete user object (e.g. including isActive &amp; email address). The entity manager knows about it and persisting the event object finally works.</p><p>Versions:<br>doctrine/common: v2.4.2<br>symfony/symfony: v2.5.4</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	        </ul>
	    </div>
            </div>

    <script type="text/javascript">
    var disqus_shortname = 'knpuniversity';
    var disqus_container_id = 'disqus_thread';var disqus_developer = 1;var disqus_identifier = 'course_video_doctrine-relationship';var disqus_url = 'https://knpuniversity.com/screencast/symfony2-ep3/doctrine-relationship';var disqus_config = function () {};

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

                                            </div>
                    <div class="pull-left-xs pull-right-md">
                                        <a class="btn btn-success"
           href="sharing-data-fixtures#play">
            Next Chapter <i class="fa fa-caret-right"></i>
        </a>
    
                    </div>
                    <div class="pull-left addthis-module">
                        
    <div class="addthis_toolbox addthis_default_style js-analytics-addthis-wrapper addthis_32x32_style" addthis:url="http://knpuniversity.com/screencast/symfony2-ep3/doctrine-relationship" addthis:title="Starting in Symfony2: Course 3 (2.4+)">
        <a class="addthis_button_preferred_1"></a>
        <a class="addthis_button_preferred_2"></a>
        <a class="addthis_button_preferred_3"></a>
        <a class="addthis_button_preferred_4"></a>
        <a class="addthis_button_compact"></a>
        <a class="addthis_counter addthis_bubble_style"></a>
    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<footer class="footer footer-styling">
    <div class="container">
        <div class="row">
                        <div class="col-xs-7 col-sm-4">
                <div class="row">
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../courses/all">All Courses</a></li>
                                                            <li><a class="knp-color-black" href="../../pricing.1">Pricing</a></li>
                                                        <li><a class="knp-color-black" href="../../faq">FAQ</a></li>
                            <li><a class="knp-color-black" href="../../training">Training</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../about">About</a></li>
                            <li><a class="knp-color-black" href="../../blog">Blog</a></li>
                            <li><a class="knp-color-black" href="../../contact">Contact Us</a></li>
                            <li>
                                <a class="knp-color-black" href="../../terms">Terms</a>
                                <span class="knp-color-black">&amp;</span>
                                <a class="knp-color-black" href="../../privacy">Privacy</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="hidden-xs col-sm-4">
                <p class="disclaimer">Symfony is a registered trademark of Fabien Potencier in the United States and/or other countries.
                This product is not endorsed or sponsored by Fabien Potencier.
                </p>
            </div>
            <div class="col-xs-5 col-sm-4">
                <div class="social-icons">
                    <a class="btn btn-social-icon btn-twitter" href="https://twitter.com/KnpUniversity">
                        <i class="fa fa-twitter"></i>
                    </a>
                    <a class="btn btn-social-icon btn-facebook" href="https://www.facebook.com/KnpLabs/">
                        <i class="fa fa-facebook"></i>
                    </a>
                    <a class="btn btn-social-icon btn-github" href="https://github.com/knpuniversity">
                        <i class="fa fa-github"></i>
                    </a>
                </div>
            </div>
                    </div>
    </div>
</footer>

<!-- JS -->
            <script>
        Core.analyticsVideoStatsUrl = '/api/analytics/video/duration';
    </script>

            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-7062980-20']);
        _gaq.push(['_trackPageview']);
    </script>
    <script>
    
    </script>
    
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
    
                <script type="text/javascript">
      (function() {
        var uv = document.createElement('script'); uv.type = 'text/javascript'; uv.async = true;
        uv.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'widget.uservoice.com/pOay2WLVabhXiEffbarO6Q.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(uv, s);
      })();

      UserVoice = window.UserVoice || [];
      UserVoice.push(['showTab', 'classic_widget', {
          tab_position: 'bottom-right',
          tab_label: 'Ideas or Feedback?',
          tab_color: '#005E8E'
      }]);
    </script>
        
            
        <script type="text/javascript">
    var _sf_async_config={uid:54262,domain:"knpuniversity.com",useCanonical:true};
    (function(){
      function loadChartbeat() {
        window._sf_endpt=(new Date()).getTime();
        var e = document.createElement('script');
        e.setAttribute('language', 'javascript');
        e.setAttribute('type', 'text/javascript');
        e.setAttribute('src', '//static.chartbeat.com/js/chartbeat.js');
        document.body.appendChild(e);
      }
      var oldonload = window.onload;
      window.onload = (typeof window.onload != 'function') ?
         loadChartbeat : function() { oldonload(); loadChartbeat(); };
    })();
    </script>
    
            <script>
            (function(){
                var t,i,e,n=window,o=document,a=arguments,s="script",r=["config","track","identify","visit","push","call"],c=function(){var t,i=this;for(i._e=[],t=0;r.length>t;t++)(function(t){i[t]=function(){return i._e.push([t].concat(Array.prototype.slice.call(arguments,0))),i}})(r[t])};for(n._w=n._w||{},t=0;a.length>t;t++)n._w[a[t]]=n[a[t]]=n[a[t]]||new c;i=o.createElement(s),i.async=1,i.src="//static.woopra.com/js/w.js",e=o.getElementsByTagName(s)[0],e.parentNode.insertBefore(i,e)
            })("woopra");

            woopra.config({
                domain: 'knpuniversity.com',
                download_tracking: true,
                outgoing_tracking: true
            });

                            woopra.identify({
                    userType: 'anonymous',
                    hasSubscription: 'no'
                });
                    </script>

        <script>
            woopra.track(
            'course_view_chapter',
            {"course":"symfony2-ep3","courseIsOwned":false,"chapter":"ManyToOne Doctrine Relationships","chapterNumber":2,"chapterIsFree":true}
        );
    </script>

        <script>
            woopra.track();
        </script>
     
        <script type="text/javascript">
    var _qevents = _qevents || [];

    (function() {
    var elem = document.createElement('script');
    elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";
    elem.async = true;
    elem.type = "text/javascript";
    var scpt = document.getElementsByTagName('script')[0];
    scpt.parentNode.insertBefore(elem, scpt);
    })();

    _qevents.push({
    qacct:"p-8-SEHS37bhSQ0"
    });
    </script>

    <noscript>
    <div style="display:none;">
    <img src="http://pixel.quantserve.com/pixel/p-8-SEHS37bhSQ0.gif" border="0" height="1" width="1" alt="Quantcast"/>
    </div>
    </noscript>
    


    <script type="text/javascript" src="../../assets/vendor/jquery-sticky/jquery.sticky.js"></script>
    <script type="text/javascript" src="../../assets/vendor/zeroclipboard/dist/ZeroClipboard.min.js"></script>
    <script type="text/javascript" src="../../js/CodeBlocks.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/underscore.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/doctools.js"></script>

    <script>
        Core.courseTitle = 'Starting in Symfony2: Course 3 (2.4+)';
        Core.courseId = 41
        Core.courseIsOwned = false;
        Core.courseSlug = 'symfony2-ep3';
                    Core.chapterTitle = 'ManyToOne Doctrine Relationships';
            Core.chapterNumber = 2;
            Core.chapterIsFree = true;
            Core.chapterSlug = 'doctrine-relationship';
        
                var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '1.0.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
        };

        jQuery(document).ready(function() {
            // Stick left sidebar menu
            $('.js-sticker').sticky();

            var $scriptWrapper = $('.js-script-content-wrapper');
            var codeBlocks = new Core.CodeBlocks($scriptWrapper);

            var expandList = $('.js-expand-list');

            expandList.on('click', function(){
                var target = $(this).data('target');
                var $expandArea = $('#' + target);
                $expandArea.toggleClass('expanded');

                // http://stackoverflow.com/questions/2868582/click-outside-menu-to-close-in-jquery
                $(document).one('click', function closeExpandList (e){
                    if($expandArea.has(e.target).length === 0){
                        $expandArea.removeClass('expanded');
                    } else {
                        $(document).one('click', closeExpandList);
                    }
                });
            });
        });
    </script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>



    <script type="text/javascript">
    var addthis_share = {
        templates: {
            twitter: '{{title}} - {{url}} | via @KnpUniversity'
        }
    }
</script>
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=weaverryan"></script>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","licenseKey":"b4d8035b34","applicationID":"3720092","transactionName":"MgEBMkZVXBFXBRENWwtLIgVAXV0MGQ0LFGsQCgoQUUZBC0IfOgdbEBYQA2tHWg1B","queueTime":0,"applicationTime":531,"atts":"HkYCRA5PTx8=","errorBeacon":"bam.nr-data.net","agent":""}</script></body>
</html>
