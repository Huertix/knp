<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
            <script src="https://cdn.optimizely.com/js/421270022.js"></script>
    
                    <script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Start Securing the App! > Symfony RESTful API: Authentication with JWT (Course 4) | KnpUniversity</title>

                    <link href="../../builds/main-db6835bf19d99bcc09032789f3bd39e4.css" rel="stylesheet">

        <link href='https://fonts.googleapis.com/css?family=Rokkitt' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Cedarville+Cursive' rel='stylesheet' type='text/css'>
    

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/tomorrow-night.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/tomorrow-night.min.css">


        <link rel="stylesheet" href="../../builds/code_block_styles-2d783e385d9dbb1ef88d9053d1b8d675.css">



    <link href="../../builds/video-6b5fa6dfb768239b226d39d08bd4867e.css" rel="stylesheet">

                        <script src="../../bundles/fosjsrouting/js/router.js"></script>

        <script src="../../builds/main-1dfa89b76a105f9c2d98.js"></script>
        <script src="../../js/routing?callback=fos.Router.setData"></script>
            

    <script>
        // video settings
        window.video = {
            isCourseChapterPaid: false,
            courseChapterId: 39609
        };

                window.video.nextDetails = {
            'type': 'video',
            'title': 'Up Next: JSON\x20Web\x20Tokens\x20\x28are\x20awesome\x29 <i class="fa fa-play"></i>',
            'url': '/screencast/symfony-rest4/json-web-token#play'
        };
            </script>

    <script src="../../builds/video-1dfa89b76a105f9c2d98.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            var hashValue = window.location.hash.substr(1);
            if (hashValue.substr(0, 7) == 'comment') {
                // this is a #comment link - open up the comment tab!
                $('.nav-tabs a[href="#tab-comment"]').click();
            }
        });
    </script>

    <link rel="alternate" type="application/rss+xml" title="Blog feed with technical articles around PHP and screencast and tutorial updates from KnpUniversity.com" href="http://feeds.feedburner.com/knpuniversity" />

    <meta name="description" content="After 3 tutorials, we&#039;ve got a nice API, But we&#039;ve been completely ignoring
authentication. Thanks to some modern tools, this will be *such* a treat:

* Understanding JSON web tokens (JWT)
* Creating, signing &amp; returning JWT&#039;s
* Using Guard for a custom JWT authentication system
* Sending tokens on the Authorization header
* Proper API errors for invalid credentials and missing credentials
* Choosing to split into 2 firewalls
">

    <meta property="og:site_name" content="KnpUniversity - PHP and Symfony Video Tutorial Screencasts">
    <meta name="twitter:site" content="@KnpUniversity"><link rel="shortcut icon" href="../../assets/images/favicon.ico">
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->    <meta property="og:title" content="Start Securing the App!">
<meta property="og:description" content="After 3 tutorials, we&amp;#039;ve got a nice API, But we&amp;#039;ve been completely ignoring
authentication. Thanks to some modern tools, this will be *such* a treat:

* Understanding JSON web tokens (JWT)
* Creating, signing &amp;amp; returning JWT&amp;#039;s
* Using Guard for a custom JWT authentication system
* Sending tokens on the Authorization header
* Proper API errors for invalid credentials and missing credentials
* Choosing to split into 2 firewalls
">
<meta property="og:url" content="http://knpuniversity.com/screencast/symfony-rest4/deny-access">
    <meta property="og:image" content="http://knpuniversity.com/imagine/course_video_poster_large/uploads/screencast/symfony-rest4:a02aa0586187260128f0fe96d5d73ee470f3684c/rest-sf-4.png">

<meta name="twitter:card" content="summary">


                            
    </head>
<body data-user-id="" >
<nav class="navbar navbar-inverse nav-margin navbar-learning-layout">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle toggle-button collapsed" data-toggle="collapse" data-target="#js-navbar" aria-expanded="false" aria-controls="js-navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../logout" class="navbar-brand">
                <span class="knp-color-blue">Knp</span>
                <span class="knp-color-white">University</span>
            </a>
        </div>
        <form class="navbar-form navbar-left navbar-form-border" role="search" method="GET" action="http://knpuniversity.com/search">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search Tutorials" value="" name="q">

                <div class="input-group-btn">
                    <button class="btn btn-default" type="submit">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </div>
        </form>
        <div id="js-navbar" class="collapse-fix collapse navbar-right navbar-collapse">
            

<ul class="nav navbar-nav nav-narrowerOnSmall">
            <li><a href="../../checkout/subscription/team_yearly/5" title="Cart"><i class="fa fa-shopping-cart"></i></a></li>
        <li class="dropdown"><a href="deny-access#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <i class="fa fa-angle-down"></i></a>
        <ul class="dropdown-menu">
          <li><a href="../../tracks.1">Tracks</a></li>
          <li><a href="../../courses/all">All Courses</a></li>
        </ul>
    </li>
            <li><a href="../../pricing.1">Pricing</a></li>
        <li><a href="../../training">Training</a></li>
                <li class="visible-xs"><a href="../../logout">My Profile</a></li>
        <li class="visible-xs"><a href="../../logout">Sign Out</a></li>

            <li><a href="../../login.1">Log In</a></li>
        <li class="btn btn-sm btn-warning signup-btn"><a class="signup" href="../../signup/index.html">Sign Up</a></li>
    </ul>

        </div>
    </div>
</nav>


    




<div class="table-contents-container">
  <div class="container expandList" id="js-chapter-list">
      <button class="table-contents-container-button js-expand-list" data-target="js-chapter-list" title="Chapter List">
          <i class="fa fa-bars"></i>
                        1.
                            Start Securing the App!
                </button>
      <div class="expandList-body">
          <div class="expandList-bodyInner">
              <h3 class="expandList-header">
                  <a class="course-title-expand" href="resume">Symfony RESTful API: Authentication with JWT (Course 4)</a>
              </h3>

                                <div class="watched-tut-progress-container watched-tut-progress-container-overview">
        <div class="watched-tut-progress-overview" style="width: 0%; margin-right: 100%;" title="0% complete"><span class="profile-progress-title">0%</span></div>
    </div>


              
              <div class="expand-chapter-list">
                      
    
    <!-- Table of contents -->
    <div class="chapter-list">
        <ul class="list-unstyled">
            
                
                                <li class="title chapter-list-item chapter-list-item-active">
            <a href="deny-access" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                1.
                        Start Securing the App!
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:20</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="json-web-token" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                2.
                        JSON Web Tokens (are awesome)
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:35</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="lexikjwt-authentication-bundle" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                3.
                        LexikJWTAuthenticationBundle
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:54</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="token-test" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                4.
                        The &quot;Fetch a Token&quot; Endpoint Test
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:09</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="create-json-web-token" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                5.
                        Create a Shiny JSON Web Token
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:53</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="send-token-in-request" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                6.
                        Authenticate a Request with JWT
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:18</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="jwt-guard-authenticator" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                7.
                        JWT Guard Authenticator (Part 1)
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 5:39</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="authenticator-comes-to-life" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                8.
                        Registering the Authenticator (Part 2)
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:12</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="always-require-auth" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                9.
                        Lock down: Require Authentication Everywhere
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 3:09</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="entry-point-multiple-firewalls" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                10.
                        The &quot;Entry Point&quot; &amp; Multiple Firewalls
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:16</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="auth-api-problem" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                11.
                        JSON Errors in your API
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:15</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="centralize-error-response" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                12.
                        ResponseFactory: Centralize Error Responses
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 3:36</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="handling-invalid-token" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                13.
                        Graceful Errors for an Invalid JWT
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 3:20</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="jwt-other-things" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                14.
                        JWT: Other Things to Think about
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:40</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


                    </ul>
    </div>

    
              </div>
          </div>
      </div>
  </div>
  <div>
                <a href="../../pricing/symfony-rest4" class="btn btn-success pull-right-md download-buy-buttons">Buy <span class="hidden-xs">Access to Course</span></a>
              </div>
</div>


        <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-9 col-lg-10">
                <h1 class="account-header account-header-low-margin-top">Start Securing the App!</h1>
                
                                    <p class="hidden-xs">
                        Course:
                        <a class="knp-color-black" href="resume"><em>Symfony RESTful API: Authentication with JWT (Course 4) Tutorial</em></a>                    </p>
                            </div>
        </div>

                <div class="row">
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <div class="full-block-container">
                    <div class="frame-padding">
                        <div id="player">
                                                                                <div>
                                                                <div class="row">
                                    <div class="end-show">
                                        <div class="xs-col-12">
                                            <p class="end-show-header">Keep learning!</p>
                                        </div>
                                        <div class="col-xs-12">
                                            <p class="end-show-link"><a href="../../pricing.1" class="btn btn-success btn-md">Start your All Access Pass</a></p>
                                        </div>
                                        <div class="col-xs-12">
                                            <p class="end-show-link text-center"><a href="../buy/collections" class="knp-color-white">Buy just this tutorial for $10.00</a></p>
                                        </div>
                                    </div>
                                </div>
                                                            </div>
                                                </div>
                    </div>
                </div>
            </div>
        </div>
         
        <div class="row">
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <div class="pull-right">
                                    <a class="btn btn-success"
           href="json-web-token#play">
            Next Chapter <i class="fa fa-caret-right"></i>
        </a>
    
                </div>

                <ul class="nav nav-tabs" role="tablist">
                    <li class="active"><a data-toggle="tab" href="deny-access#tab-script">Script</a></li>
                    <li><a data-toggle="tab" href="deny-access#tab-comment">
                        <i class="fa fa-comment-o"></i>
                                                    
                                                        Conversation
                                            </a></li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="tab-script">
                        <div class="js-script-content-wrapper top-margin-script markdown-content">
                                                                                        <a href="https://github.com/knpuniversity/symfony2-rest/edit/master/knpu/episode4/deny-access.md" target="_blank" class="btn btn-default btn-circle pull-right js-tooltip" title="Edit on GitHub"><span class="fa fa-pencil"></span></a>
                                                                    <p>You again? Get outta here.... punk... is what <em>we</em> will be saying soon to API clients
in this tutorial that don't have valid credentials! Yep, welcome back guys, this
time to a tutorial that's making security exciting again! Seriously, I'm <em>pumped</em>
to talk about authentication in an API... and in particular, a really powerful tool
called <em>JSON web tokens</em>.</p>
<p>To make sure your JSON web tokens are the envy of all your friends, code
along with me by downloading the code from any of the tutorial pages. Then, just
unzip it and move into the <code>start/</code> directory. I already have that <code>start</code> code
in <code>symfony-rest</code>.</p>
<p>I also upgraded our project to Symfony 3! Woohoo! Almost everything we'll do will
work for Symfony 2 or 3, but there are a few differences in the directory structure.
We have a tutorial on upgrading to Symfony 3 if you want to see those.</p>
<p>Let's start the built-in web server with:</p>
<pre><code class="language-bash"><div class="line">bin/console server:run</div></code></pre>
<p>And if you just downloaded the code, open the README and follow a few other steps
there.</p>
<h2 id="the-sad-state-of-our-app-s-security">The (sad) State of our App's Security <a class="headerlink" href="deny-access#the-sad-state-of-our-app-s-security" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Ok, our app is Code Battles! It has a cool web interface and you can login with
<code>weaverryan</code> and password <code>foo</code>: super secure! Here, we can create programmers and
start battles. And our API already supports <em>a lot</em> of this stuff.</p>
<p>Open up <code>ProgrammerController</code> inside the <code>Controller/Api</code> directory:</p>
<p><div class="code-block-wrapper" data-code-block-guid="ceddfdae2f">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-191" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            191 lines <span class="meta-divider"></span> <span title="src/AppBundle/Controller/Api/ProgrammerController.php">src/AppBundle/Controller/Api/ProgrammerController.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-18" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 18
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProgrammerController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseController</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="21-24" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 21 - 24
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newAction</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="26-54" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 26 - 54
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="55"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showAction</span><span class="hljs-params">($nickname)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="56-76" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 56 - 76
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listAction</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="78-95" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 78 - 95
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="96"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateAction</span><span class="hljs-params">($nickname, Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="97-128" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 97 - 128
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="129"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteAction</span><span class="hljs-params">($nickname)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="130-189" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 130 - 189
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="190"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Awesome! We can already create, fetch and update programmers. AND, we've got
a pretty sweet test:</p>
<p><div class="code-block-wrapper" data-code-block-guid="81c58527f3">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-248" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            248 lines <span class="meta-divider"></span> <span title="tests/AppBundle/Controller/Api/ProgrammerControllerTest.php">tests/AppBundle/Controller/Api/ProgrammerControllerTest.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-6" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 6
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProgrammerControllerTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ApiTestCase</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="9-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 9 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testPOST</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="17-36" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 17 - 36
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="37"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testGETProgrammer</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="38-59" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 38 - 59
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="60"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testGETProgrammerDeep</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="61-73" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 61 - 73
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="74"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testGETProgrammersCollection</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="75-91" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 75 - 91
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="92"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testGETProgrammersCollectionPagination</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="93-142" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 93 - 142
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="143"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testPUTProgrammer</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="144-164" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 144 - 164
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="165"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testPATCHProgrammer</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="166-183" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 166 - 183
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="184"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testDELETEProgrammer</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="185-246" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 185 - 246
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="247"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>um, suite... that checks these endpoints.</p>
<p>Ready for the problem? Our API has <em>no</em> security! The horror! Anonymous users are
able to create programmers and then change the avatar on other programmers. It's
chaos!</p>
<p>On the web interface, you need to be logged in to do any of these things. Let's make
the API work the same way.</p>
<h2 id="testing-for-security">Testing for Security <a class="headerlink" href="deny-access#testing-for-security" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>As always: we need to start by writing a test. In <code>ProgrammerControllerTest</code>, add
a new <code>public function testRequiresAuthentication()</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="947c2229d9">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-256" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            256 lines <span class="meta-divider"></span> <span title="tests/AppBundle/Controller/Api/ProgrammerControllerTest.php">tests/AppBundle/Controller/Api/ProgrammerControllerTest.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-6" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 6
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProgrammerControllerTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ApiTestCase</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="9-247" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 9 - 247
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="248"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testRequiresAuthentication</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="249"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="250-253" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 250 - 253
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="254"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="255"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Let's make an API request to an endpoint that <em>should</em> be secured and then assert
some things. Start with <code>$response = $this-&gt;client-&gt;post('/api/programmers')</code>.
Send this a valid JSON body:</p>
<p><div class="code-block-wrapper" data-code-block-guid="5b47d0e635">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-256" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            256 lines <span class="meta-divider"></span> <span title="tests/AppBundle/Controller/Api/ProgrammerControllerTest.php">tests/AppBundle/Controller/Api/ProgrammerControllerTest.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-6" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 6
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProgrammerControllerTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ApiTestCase</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="9-247" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 9 - 247
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="248"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testRequiresAuthentication</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="249"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="250"></td>
            <td class="blob-code">        $response = <span class="hljs-keyword">$this</span>-&gt;client-&gt;post(<span class="hljs-string">'/api/programmers'</span>, [</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="251"></td>
            <td class="blob-code">            <span class="hljs-string">'body'</span> =&gt; <span class="hljs-string">'[]'</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="252"></td>
            <td class="blob-code">        ]);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="253-253" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... line 253
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="254"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="255"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Ok, if our API client tries to anonymously access a secured endpoint, what should
be returned? Well, at the very least, assert that the response status code is 401,
meaning "Unauthorized":</p>
<p><div class="code-block-wrapper" data-code-block-guid="e338dd7fc4">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-256" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            256 lines <span class="meta-divider"></span> <span title="tests/AppBundle/Controller/Api/ProgrammerControllerTest.php">tests/AppBundle/Controller/Api/ProgrammerControllerTest.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-249" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 249
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="250"></td>
            <td class="blob-code">        $response = <span class="hljs-keyword">$this</span>-&gt;client-&gt;post(<span class="hljs-string">'/api/programmers'</span>, [</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="251"></td>
            <td class="blob-code">            <span class="hljs-string">'body'</span> =&gt; <span class="hljs-string">'[]'</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="252"></td>
            <td class="blob-code">        ]);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="253"></td>
            <td class="blob-code">        <span class="hljs-keyword">$this</span>-&gt;assertEquals(<span class="hljs-number">401</span>, $response-&gt;getStatusCode());</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="254-256" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 254 - 256
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Ok! Let's go make sure this fails! Copy the method name and find the terminal. Run:</p>
<pre><code class="language-bash"><div class="line">./vendor/bin/phpunit --filter testRequiresAuthentication</div></code></pre>
<p>It fails with a validation error: it <em>is</em> getting beyond the security layer and executing
our controller. Time to lock that down!</p>
<h2 id="securing-a-controller">Securing a Controller <a class="headerlink" href="deny-access#securing-a-controller" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Open <code>ProgrammerController</code>. How can we require the API client to be authenticated?
The <em>exact</em> same way you do in a web application. Add <code>$this-&gt;denyAccessUnlessGranted('ROLE_USER')</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="80fa26f8df">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-193" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            193 lines <span class="meta-divider"></span> <span title="src/AppBundle/Controller/Api/ProgrammerController.php">src/AppBundle/Controller/Api/ProgrammerController.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-18" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 18
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProgrammerController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseController</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="21-24" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 21 - 24
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newAction</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="27"></td>
            <td class="blob-code">        <span class="hljs-keyword">$this</span>-&gt;denyAccessUnlessGranted(<span class="hljs-string">'ROLE_USER'</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="28-50" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 28 - 50
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="51"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="52-191" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 52 - 191
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="192"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>That's it. I'm using <code>ROLE_USER</code> because <em>all</em> of my users have this role - you could
also use <code>IS_AUTHENTICATED_FULLY</code>.</p>
<p>Ok, back to the test! Run it!</p>
<pre><code class="language-bash"><div class="line">./vendor/bin/phpunit --filter testRequiresAuthentication</div></code></pre>
<p>Oh, <em>interesting</em> - it's a <em>200</em> status code instead of 401. Look closely: it redirected
us to the login page. So, it's <em>kind</em> of working... you can't add programmers anonymously
anymore. But clearly, we've got some work to do.</p>

    
                        </div>
                    </div>
                    <div class="tab-pane" id="tab-comment">
                        <h3>Leave a comment!</h3>
                                                        <div id="disqus_thread">
                <style type="text/css">
            #dsq-comments {padding: 10px 0 0}
            .dsq-comment {position: relative;clear: both;margin: 0 0 1.5em;}
            .dsq-avatar {left: 0;position: absolute;}
            .dsq-avatar img {border: 0 none;border-radius: 3px;height: 36px;width: 36px;}
            .dsq-comment-body {padding: 0 0 0 46px;}
            .dsq-comment-header {border: 1px solid rgba(0, 0, 0, 0.15);border-radius: 3px;font-size: 13px;line-height: 14px;margin: 0 0 1em;max-height: 36px;overflow: hidden;padding: 10px;position: relative;text-overflow: ellipsis;white-space: nowrap;}
            .dsq-comment-message {word-wrap: break-word;}
            .dsq-comment-message {line-height: 1.5em;margin: 0 0 1em;}
            .dsq-comment-text {display: inline;}
            .dsq-comment-date {float: right;font-size: 90%;margin: 0 12px 0 0;}
        </style>

	    <div id="dsq-content">
	        <ul id="dsq-comments">
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2980660885" id="dsq-comment-2980660885">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/bocharsky25/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/11445/2822/avatar92.jpg?1482506193">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2980660885">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-11-02</span>
	                            <span class="dsq-commenter-name">Victor Bocharsky</span>
	                        </div>

	                        <div id="dsq-comment-message-2980660885" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2980660885" class="dsq-comment-text">
	                                <p>Hey Ruslan,</p><p>Actually, yes, the application uses another DB in test environment - you can see it in app/config/config_test.yml file.</p><p>It depends, in most cases you will be enough to create a DB and create its schema, i.e. run "bin/console doctrine:database:create --env=test" and "bin/console doctrine:schema:create --env=test" commands at the first time, then you can just do "bin/console doctrine:schema:update --force --env=test" after any Doctrine mapping changes. But if your tests depend of some fixtures data - then you also need to load data fixtures too for test environment using the same "--env=test" option.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2979760634" id="dsq-comment-2979760634">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_1j0deVJRso/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2979760634">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-11-01</span>
	                            <span class="dsq-commenter-name">Ruslan</span>
	                        </div>

	                        <div id="dsq-comment-message-2979760634" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2979760634" class="dsq-comment-text">
	                                <p>Hi!<br>I'm trying to run unit test on the end, but get an error:</p><p>/var/www/knp/tests/AppBundle/Controller/Api/ProgrammerControllerTest.php:11<br>Caused by PDOException: SQLSTATE[HY000] [1049] Unknown database 'knp_api_token_test'</p><p>My database name is knp_api_token, and it works correctly (I can log in with user credentials).</p><p>However, if I create another database and call it 'knp_api_token_test' the above error disappears.</p><p>So is it true, that for unit tests we use apart database which is a full clone of the dev database?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2749104214" id="dsq-comment-2749104214">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_fvhM6qCQNy/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/19657/3705/avatar92.jpg?1467706588">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2749104214">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-06-24</span>
	                            <span class="dsq-commenter-name">Mihail</span>
	                        </div>

	                        <div id="dsq-comment-message-2749104214" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2749104214" class="dsq-comment-text">
	                                <p>Thanks Ryan for advice! Just removing the type-hint 'Exeption' in onNotSuccessfulTest helped to work with this code! With ResponseAsserter methods also evth is ok, I just noticed the comment "this will blow up if the property doesn't exist" so if no problem the tests pass, but assertion of this type is just not added to the total number of the assertions in console info when tests were run, I just thought it didn't work, but they worked as expected on 'wrong' data. Thanks again, this weekend I am going to explore the fifth chapter :)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2743394415" id="dsq-comment-2743394415">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2743394415">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-06-21</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2743394415" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2743394415" class="dsq-comment-text">
	                                <p>Hey Mihail!</p><p>Hmm - what problems are you having with each method?</p><p>I *do* know that in more recent version of PHPUnit, that the argument to onNotSuccessfulTest changed (in newer versions, the type-hint was removed). You'll get a pretty clear error about the argument type mis-match in this case, which you can easily fix by removing the type-hint on the argument. But if there's a different issue, I haven't hit it yet. I haven't had any issues with assertResponsePropertiesExists/s() yet - and I *have* run this on Sf 3.0 and Guzzle 6.* (But not on PHP7).</p><p>If there is a problem and we can solve it, we can commit the fix to the code download for others :).</p><p>Thanks!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2740269559" id="dsq-comment-2740269559">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_fvhM6qCQNy/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/19657/3705/avatar92.jpg?1467706588">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2740269559">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-06-20</span>
	                            <span class="dsq-commenter-name">Mihail</span>
	                        </div>

	                        <div id="dsq-comment-message-2740269559" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2740269559" class="dsq-comment-text">
	                                <p>Hi Ryan,</p><p>After the complete rewriting of the project with SF3.1, Guzzle6.2, PHPUnit5.4, ResponseAsserter::assertResponsePropertiesExist/s() methods stopped working as expected as well as ApiTestCase::onNotSuccessfulTest with other debugging methods. For the latter, probably smth connected to PHP7 problem, but for the first it just passes without even considering it as an assertion.</p><p>Could you advise on the way how to fix it?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2723149623" id="dsq-comment-2723149623">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2723149623">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-06-10</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2723149623" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2723149623" class="dsq-comment-text">
	                                <p>Haha, well done :)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2722889030" id="dsq-comment-2722889030">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_0Ksag17Pj1/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2722889030">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-06-10</span>
	                            <span class="dsq-commenter-name">Chuck Norris</span>
	                        </div>

	                        <div id="dsq-comment-message-2722889030" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2722889030" class="dsq-comment-text">
	                                <p>Hi Ryan,</p><p>yes I upgraded to latest version and started upgrading following guzzle recommendations but I got stuck in how to handle history.<br>So thanks to you, now I can get a closer look at what you did.</p><p>P.S. No, unfortunately, I'm just usurping his identity,  "cos you know, the real Chuck don't ask for help :)<br>I just hope he never find out.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2721983262" id="dsq-comment-2721983262">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2721983262">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-06-09</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2721983262" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2721983262" class="dsq-comment-text">
	                                <p>Hey Chuck!</p><p>Did you also upgrade Guzzle to the latest version (6)? I did for this tutorial (as you probably already know). And upgrading Guzzle actually took some work - specifically in ApiTestCase - several things changed. So, here's a copy of the ApiTestCase after the Guzzle upgrade: <a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fweaverryan%2F72d529bac4fb5c4892d98b6c57e45ca5%3AKflelq22FWh-x5UPem8Y2zNKhQQ&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/weaver...</a> - I hope it's helpful :).</p><p>Cheers!</p><p>P.S. Is your name really Chuck Norris? That would be awesome :)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2720532548" id="dsq-comment-2720532548">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_0Ksag17Pj1/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2720532548">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-06-09</span>
	                            <span class="dsq-commenter-name">Chuck Norris</span>
	                        </div>

	                        <div id="dsq-comment-message-2720532548" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2720532548" class="dsq-comment-text">
	                                <p>Hello KnpTeam,</p><p>I'm trying to update the project to Symfony3 (and I don't have access to current project download, so I cant see how you do it) but I cant see how to import some guzzle class (ResponseInterface, BeforeEvent, ...).<br>I've installed guzzle/guzzle bundle using the symfony3 requirements (<a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Fnullziu%2Fguzzle-bundle%2Ftree%2Fsymfony3-compatible%29%3A93_6pvWsCyCYsB1JNRDnY_yTh7k&amp;cuid=1175718" rel="nofollow noopener">https://github.com/nullziu/guz...</a><br>But theses classes seems missing.</p><p>Can you help?<br>Thanks.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	        </ul>
	    </div>
            </div>

    <script type="text/javascript">
    var disqus_shortname = 'knpuniversity';
    var disqus_container_id = 'disqus_thread';var disqus_developer = 1;var disqus_identifier = 'course_video_deny-access';var disqus_url = 'https://knpuniversity.com/screencast/symfony-rest4/deny-access';var disqus_config = function () {};

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

                                            </div>
                    <div class="pull-left-xs pull-right-md">
                                        <a class="btn btn-success"
           href="json-web-token#play">
            Next Chapter <i class="fa fa-caret-right"></i>
        </a>
    
                    </div>
                    <div class="pull-left addthis-module">
                        
    <div class="addthis_toolbox addthis_default_style js-analytics-addthis-wrapper addthis_32x32_style" addthis:url="http://knpuniversity.com/screencast/symfony-rest4/deny-access" addthis:title="Symfony RESTful API: Authentication with JWT (Course 4)">
        <a class="addthis_button_preferred_1"></a>
        <a class="addthis_button_preferred_2"></a>
        <a class="addthis_button_preferred_3"></a>
        <a class="addthis_button_preferred_4"></a>
        <a class="addthis_button_compact"></a>
        <a class="addthis_counter addthis_bubble_style"></a>
    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<footer class="footer footer-styling">
    <div class="container">
        <div class="row">
                        <div class="col-xs-7 col-sm-4">
                <div class="row">
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../courses/all">All Courses</a></li>
                                                            <li><a class="knp-color-black" href="../../pricing.1">Pricing</a></li>
                                                        <li><a class="knp-color-black" href="../../faq">FAQ</a></li>
                            <li><a class="knp-color-black" href="../../training">Training</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../about">About</a></li>
                            <li><a class="knp-color-black" href="../../blog">Blog</a></li>
                            <li><a class="knp-color-black" href="../../contact">Contact Us</a></li>
                            <li>
                                <a class="knp-color-black" href="../../terms">Terms</a>
                                <span class="knp-color-black">&amp;</span>
                                <a class="knp-color-black" href="../../privacy">Privacy</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="hidden-xs col-sm-4">
                <p class="disclaimer">Symfony is a registered trademark of Fabien Potencier in the United States and/or other countries.
                This product is not endorsed or sponsored by Fabien Potencier.
                </p>
            </div>
            <div class="col-xs-5 col-sm-4">
                <div class="social-icons">
                    <a class="btn btn-social-icon btn-twitter" href="https://twitter.com/KnpUniversity">
                        <i class="fa fa-twitter"></i>
                    </a>
                    <a class="btn btn-social-icon btn-facebook" href="https://www.facebook.com/KnpLabs/">
                        <i class="fa fa-facebook"></i>
                    </a>
                    <a class="btn btn-social-icon btn-github" href="https://github.com/knpuniversity">
                        <i class="fa fa-github"></i>
                    </a>
                </div>
            </div>
                    </div>
    </div>
</footer>

<!-- JS -->
            <script>
        Core.analyticsVideoStatsUrl = '/api/analytics/video/duration';
    </script>

            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-7062980-20']);
        _gaq.push(['_trackPageview']);
    </script>
    <script>
    
    </script>
    
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
    
                <script type="text/javascript">
      (function() {
        var uv = document.createElement('script'); uv.type = 'text/javascript'; uv.async = true;
        uv.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'widget.uservoice.com/pOay2WLVabhXiEffbarO6Q.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(uv, s);
      })();

      UserVoice = window.UserVoice || [];
      UserVoice.push(['showTab', 'classic_widget', {
          tab_position: 'bottom-right',
          tab_label: 'Ideas or Feedback?',
          tab_color: '#005E8E'
      }]);
    </script>
        
            
        <script type="text/javascript">
    var _sf_async_config={uid:54262,domain:"knpuniversity.com",useCanonical:true};
    (function(){
      function loadChartbeat() {
        window._sf_endpt=(new Date()).getTime();
        var e = document.createElement('script');
        e.setAttribute('language', 'javascript');
        e.setAttribute('type', 'text/javascript');
        e.setAttribute('src', '//static.chartbeat.com/js/chartbeat.js');
        document.body.appendChild(e);
      }
      var oldonload = window.onload;
      window.onload = (typeof window.onload != 'function') ?
         loadChartbeat : function() { oldonload(); loadChartbeat(); };
    })();
    </script>
    
            <script>
            (function(){
                var t,i,e,n=window,o=document,a=arguments,s="script",r=["config","track","identify","visit","push","call"],c=function(){var t,i=this;for(i._e=[],t=0;r.length>t;t++)(function(t){i[t]=function(){return i._e.push([t].concat(Array.prototype.slice.call(arguments,0))),i}})(r[t])};for(n._w=n._w||{},t=0;a.length>t;t++)n._w[a[t]]=n[a[t]]=n[a[t]]||new c;i=o.createElement(s),i.async=1,i.src="//static.woopra.com/js/w.js",e=o.getElementsByTagName(s)[0],e.parentNode.insertBefore(i,e)
            })("woopra");

            woopra.config({
                domain: 'knpuniversity.com',
                download_tracking: true,
                outgoing_tracking: true
            });

                            woopra.identify({
                    userType: 'anonymous',
                    hasSubscription: 'no'
                });
                    </script>

        <script>
            woopra.track(
            'course_view_chapter',
            {"course":"symfony-rest4","courseIsOwned":false,"chapter":"Start Securing the App!","chapterNumber":1,"chapterIsFree":false}
        );
    </script>

        <script>
            woopra.track();
        </script>
     
        <script type="text/javascript">
    var _qevents = _qevents || [];

    (function() {
    var elem = document.createElement('script');
    elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";
    elem.async = true;
    elem.type = "text/javascript";
    var scpt = document.getElementsByTagName('script')[0];
    scpt.parentNode.insertBefore(elem, scpt);
    })();

    _qevents.push({
    qacct:"p-8-SEHS37bhSQ0"
    });
    </script>

    <noscript>
    <div style="display:none;">
    <img src="http://pixel.quantserve.com/pixel/p-8-SEHS37bhSQ0.gif" border="0" height="1" width="1" alt="Quantcast"/>
    </div>
    </noscript>
    


    <script type="text/javascript" src="../../assets/vendor/jquery-sticky/jquery.sticky.js"></script>
    <script type="text/javascript" src="../../assets/vendor/zeroclipboard/dist/ZeroClipboard.min.js"></script>
    <script type="text/javascript" src="../../js/CodeBlocks.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/underscore.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/doctools.js"></script>

    <script>
        Core.courseTitle = 'Symfony RESTful API: Authentication with JWT (Course 4)';
        Core.courseId = 62
        Core.courseIsOwned = false;
        Core.courseSlug = 'symfony-rest4';
                    Core.chapterTitle = 'Start Securing the App!';
            Core.chapterNumber = 1;
            Core.chapterIsFree = false;
            Core.chapterSlug = 'deny-access';
        
                var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '1.0.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
        };

        jQuery(document).ready(function() {
            // Stick left sidebar menu
            $('.js-sticker').sticky();

            var $scriptWrapper = $('.js-script-content-wrapper');
            var codeBlocks = new Core.CodeBlocks($scriptWrapper);

            var expandList = $('.js-expand-list');

            expandList.on('click', function(){
                var target = $(this).data('target');
                var $expandArea = $('#' + target);
                $expandArea.toggleClass('expanded');

                // http://stackoverflow.com/questions/2868582/click-outside-menu-to-close-in-jquery
                $(document).one('click', function closeExpandList (e){
                    if($expandArea.has(e.target).length === 0){
                        $expandArea.removeClass('expanded');
                    } else {
                        $(document).one('click', closeExpandList);
                    }
                });
            });
        });
    </script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>



    <script type="text/javascript">
    var addthis_share = {
        templates: {
            twitter: '{{title}} - {{url}} | via @KnpUniversity'
        }
    }
</script>
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=weaverryan"></script>

</body>
</html>
