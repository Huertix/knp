<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
            <script src="https://cdn.optimizely.com/js/421270022.js"></script>
    
                    <script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Guard: Joyful Authentication > The new Awesome of Symfony 3.0 | KnpUniversity</title>

                    <link href="../../builds/main-db6835bf19d99bcc09032789f3bd39e4.css" rel="stylesheet">

        <link href='https://fonts.googleapis.com/css?family=Rokkitt' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Cedarville+Cursive' rel='stylesheet' type='text/css'>
    

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/tomorrow-night.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/tomorrow-night.min.css">


        <link rel="stylesheet" href="../../builds/code_block_styles-2d783e385d9dbb1ef88d9053d1b8d675.css">



    <link href="../../builds/video-6b5fa6dfb768239b226d39d08bd4867e.css" rel="stylesheet">

                        <script src="../../bundles/fosjsrouting/js/router.js"></script>

        <script src="../../builds/main-1dfa89b76a105f9c2d98.js"></script>
        <script src="../../js/routing?callback=fos.Router.setData"></script>
            

    <script>
        // video settings
        window.video = {
            isCourseChapterPaid: false,
            courseChapterId: 11443
        };

                window.video.nextDetails = {
            'type': 'video',
            'title': 'Up Next: Micro\x20Symfony\x20via\x20MicroKernelTrait <i class="fa fa-play"></i>',
            'url': '/screencast/new-in-symfony3/micro-kernel#play'
        };
            </script>

    <script src="../../builds/video-1dfa89b76a105f9c2d98.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            var hashValue = window.location.hash.substr(1);
            if (hashValue.substr(0, 7) == 'comment') {
                // this is a #comment link - open up the comment tab!
                $('.nav-tabs a[href="#tab-comment"]').click();
            }
        });
    </script>

    <link rel="alternate" type="application/rss+xml" title="Blog feed with technical articles around PHP and screencast and tutorial updates from KnpUniversity.com" href="http://feeds.feedburner.com/knpuniversity" />

    <meta name="description" content="HELLLOOO Symfony3!!!

Symfony 3, ahem, Symfony 2.8, comes with *a lot* of sweet new stuff. Hey, we
should totally take a tour through all the best stuff.
">

    <meta property="og:site_name" content="KnpUniversity - PHP and Symfony Video Tutorial Screencasts">
    <meta name="twitter:site" content="@KnpUniversity"><link rel="shortcut icon" href="../../assets/images/favicon.ico">
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->    <meta property="og:title" content="Guard: Joyful Authentication">
<meta property="og:description" content="HELLLOOO Symfony3!!!

Symfony 3, ahem, Symfony 2.8, comes with *a lot* of sweet new stuff">
<meta property="og:url" content="http://knpuniversity.com/screencast/new-in-symfony3/guard-authentication">
    <meta property="og:image" content="http://knpuniversity.com/imagine/course_video_poster_large/uploads/screencast/new-in-symfony3:db3a3117e34e87b57d8e1b1332e760760fcc2692/new-sf3.png">

<meta name="twitter:card" content="summary">


                            
    </head>
<body data-user-id="" >
<nav class="navbar navbar-inverse nav-margin navbar-learning-layout">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle toggle-button collapsed" data-toggle="collapse" data-target="#js-navbar" aria-expanded="false" aria-controls="js-navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../logout" class="navbar-brand">
                <span class="knp-color-blue">Knp</span>
                <span class="knp-color-white">University</span>
            </a>
        </div>
        <form class="navbar-form navbar-left navbar-form-border" role="search" method="GET" action="http://knpuniversity.com/search">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search Tutorials" value="" name="q">

                <div class="input-group-btn">
                    <button class="btn btn-default" type="submit">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </div>
        </form>
        <div id="js-navbar" class="collapse-fix collapse navbar-right navbar-collapse">
            

<ul class="nav navbar-nav nav-narrowerOnSmall">
            <li><a href="../../checkout/subscription/team_yearly/5" title="Cart"><i class="fa fa-shopping-cart"></i></a></li>
        <li class="dropdown"><a href="guard-authentication#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <i class="fa fa-angle-down"></i></a>
        <ul class="dropdown-menu">
          <li><a href="../../tracks.1">Tracks</a></li>
          <li><a href="../../courses/all">All Courses</a></li>
        </ul>
    </li>
            <li><a href="../../pricing.1">Pricing</a></li>
        <li><a href="../../training">Training</a></li>
                <li class="visible-xs"><a href="../../logout">My Profile</a></li>
        <li class="visible-xs"><a href="../../logout">Sign Out</a></li>

            <li><a href="../../login.1">Log In</a></li>
        <li class="btn btn-sm btn-warning signup-btn"><a class="signup" href="../../signup/index.html">Sign Up</a></li>
    </ul>

        </div>
    </div>
</nav>


    




<div class="table-contents-container">
  <div class="container expandList" id="js-chapter-list">
      <button class="table-contents-container-button js-expand-list" data-target="js-chapter-list" title="Chapter List">
          <i class="fa fa-bars"></i>
                        2.
                            Guard: Joyful Authentication
                </button>
      <div class="expandList-body">
          <div class="expandList-bodyInner">
              <h3 class="expandList-header">
                  <a class="course-title-expand" href="../new-in-symfony3.1">The new Awesome of Symfony 3.0</a>
              </h3>

                                <div class="watched-tut-progress-container watched-tut-progress-container-overview">
        <div class="watched-tut-progress-overview" style="width: 0%; margin-right: 100%;" title="0% complete"><span class="profile-progress-title">0%</span></div>
    </div>


              
              <div class="expand-chapter-list">
                      
    
    <!-- Table of contents -->
    <div class="chapter-list">
        <ul class="list-unstyled">
            
                
                                <li class="title chapter-list-item ">
            <a href="new-dir-structure" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                1.
                        Shiny new Directory Structure
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 3:21</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item chapter-list-item-active">
            <a href="guard-authentication" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                2.
                        Guard: Joyful Authentication
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 10:53</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="micro-kernel" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                3.
                        Micro Symfony via MicroKernelTrait
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 9:06</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="profiler" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                4.
                        New Profiler
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 3:06</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="autowiring" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                5.
                        Service Autowiring
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:52</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="form-updates" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                6.
                        Form Updates
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 5:35</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="console-styling" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                7.
                        Console Styling
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 6:28</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="voter" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                8.
                        The new Voter Class
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 5:54</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


                    </ul>
    </div>

    
              </div>
          </div>
      </div>
  </div>
  <div>
                <a href="../../pricing/new-in-symfony3" class="btn btn-success pull-right-md download-buy-buttons">Buy <span class="hidden-xs">Access to Course</span></a>
              </div>
</div>


        <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-9 col-lg-10">
                <h1 class="account-header account-header-low-margin-top">Guard: Joyful Authentication</h1>
                
                                    <p class="hidden-xs">
                        Course:
                        <a class="knp-color-black" href="../new-in-symfony3.1"><em>The new Awesome of Symfony 3.0 Tutorial</em></a>                    </p>
                            </div>
        </div>

                <div class="row">
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <div class="full-block-container">
                    <div class="frame-padding">
                        <div id="player">
                                                                                <div>
                                                                <div class="row">
                                    <div class="end-show">
                                        <div class="xs-col-12">
                                            <p class="end-show-header">Keep learning!</p>
                                        </div>
                                        <div class="col-xs-12">
                                            <p class="end-show-link"><a href="../../pricing.1" class="btn btn-success btn-md">Start your All Access Pass</a></p>
                                        </div>
                                        <div class="col-xs-12">
                                            <p class="end-show-link text-center"><a href="../buy/collections" class="knp-color-white">Buy just this tutorial for $6.00</a></p>
                                        </div>
                                    </div>
                                </div>
                                                            </div>
                                                </div>
                    </div>
                </div>
            </div>
        </div>
         
        <div class="row">
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <div class="pull-right">
                                    <a class="btn btn-success"
           href="micro-kernel#play">
            Next Chapter <i class="fa fa-caret-right"></i>
        </a>
    
                </div>

                <ul class="nav nav-tabs" role="tablist">
                    <li class="active"><a data-toggle="tab" href="guard-authentication#tab-script">Script</a></li>
                    <li><a data-toggle="tab" href="guard-authentication#tab-comment">
                        <i class="fa fa-comment-o"></i>
                                                    
                                                                                                (25+)
                                                                                        Conversation
                                            </a></li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="tab-script">
                        <div class="js-script-content-wrapper top-margin-script markdown-content">
                                                                                        <a href="https://github.com/knpuniversity/whats-new-symfony3/edit/master/knpu/guard-authentication.md" target="_blank" class="btn btn-default btn-circle pull-right js-tooltip" title="Edit on GitHub"><span class="fa fa-pencil"></span></a>
                                                                    <p>My favorite new feature for Symfony 2.8 is Guard. It makes creating custom and crazy
authentication systems really really easy. I'm a bit biased: Guard was my creation,
inspired by a lot of people and projects.</p>
<h2 id="the-weirdest-login-form-ever">The Weirdest Login Form Ever <a class="headerlink" href="guard-authentication#the-weirdest-login-form-ever" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Later, I'll do some in-depth screencasts about Guard, but I want to give you a taste
of what's possible. In this project, I have a tradition login system:</p>
<p><div class="code-block-wrapper" data-code-block-guid="67f98fbfec">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-42" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            42 lines <span class="meta-divider"></span> <span title="src/AppBundle/Controller/DefaultController.php">src/AppBundle/Controller/DefaultController.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-21" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 21
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">    <span class="hljs-comment">/**</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code">     * <span class="hljs-doctag">@Route</span>("/login", name="login")</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code">     */</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sillyLoginAction</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="27"></td>
            <td class="blob-code">        $error = <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-string">'security.authentication_utils'</span>)</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="28"></td>
            <td class="blob-code">            -&gt;getLastAuthenticationError();</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="29"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="30"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;render(<span class="hljs-string">'default/login.html.twig'</span>, [</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="31"></td>
            <td class="blob-code">            <span class="hljs-string">'error'</span> =&gt; $error</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="32"></td>
            <td class="blob-code">        ]);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="33"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="34-42" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 34 - 42
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>The <code>/login</code> controller renders a login template and this template builds a form
that POSTs right back to that same <code>loginAction</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="06b3bd593d">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-32" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            32 lines <span class="meta-divider"></span> <span title="app/Resources/views/default/login.html.twig">app/Resources/views/default/login.html.twig</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-9" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 9
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="10"></td>
            <td class="blob-code">    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ path('login') }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span>&gt;</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="11-11" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... line 11
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code">            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"exampleInputEmail1"</span>&gt;</span>Username<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"_username"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"exampleInputEmail1"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Username"</span>&gt;</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="14-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 14 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"exampleInputPassword1"</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"_password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">                   <span class="hljs-attr">id</span>=<span class="hljs-string">"exampleInputPassword1"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Password"</span>&gt;</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="19-20" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 19 - 20
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"the-answer"</span>&gt;</span>The answer to life the universe and everything<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"the_answer"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"the-answer"</span>&gt;</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="23-25" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 23 - 25
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code">                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"terms"</span>&gt;</span> I agree to want to be logged in</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="27-28" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 27 - 28
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="29"></td>
            <td class="blob-code">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="30"></td>
            <td class="blob-code">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="31-32" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 31 - 32
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>It has a username field, a password field and then a couple of extra fields. One of
them is "the answer to life the universe and everything", which of course must be
set to 42. The user also needs to check this "agreement" checkbox.</p>
<p>So how can we make a login system that checks <em>four</em> fields instead of just the usual
username and password? Hello Guard.</p>
<p>Before coding, start the built-in web server, which is now <code>bin/console server:run</code>:</p>
<pre><code class="language-bash"><div class="line">bin/console server:run</div></code></pre>
<p>Try out <code>/login</code>.</p>
<h2 id="creating-the-authenticator-class">Creating the Authenticator Class <a class="headerlink" href="guard-authentication#creating-the-authenticator-class" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>To use guard, we need a new class. I'll create a new directory called <code>Security</code>,
but that's not important. Call the class <code>WeirdFormAuthenticator</code>.Next, make
this class implement <code>GuardAuthenticatorInterface</code> or extend the slightly easier
<code>AbstractGuardAuthenticator</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="37e8e4c775">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-44" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            44 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-2" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 2
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="3"></td>
            <td class="blob-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">AppBundle</span>\<span class="hljs-title">Security</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="4-10" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 4 - 10
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="11"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Guard</span>\<span class="hljs-title">AbstractGuardAuthenticator</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeirdFormAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="14"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="15-42" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 15 - 42
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="43"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>In PhpStorm, I'll open the <a href="../phpstorm/doctrine">generate menu</a>
and select "Implement Methods". Select <em>all</em> of them, including <code>start()</code>, which is
hiding at the bottom. Also move the <code>start()</code> method to the bottom of the class:
it'll fit more thematically down there:</p>
<p><div class="code-block-wrapper" data-code-block-guid="e248d645b5">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-44" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            44 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-4" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 4
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="5"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="6-6" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... line 6
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Authentication</span>\<span class="hljs-title">Token</span>\<span class="hljs-title">TokenInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">AuthenticationException</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="10"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserProviderInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="11-12" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 11 - 12
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeirdFormAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="14"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="15"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCredentials</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span><span class="hljs-params">($credentials, UserProviderInterface $userProvider)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkCredentials</span><span class="hljs-params">($credentials, UserInterface $user)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="27"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(Request $request, AuthenticationException $exception)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="28"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="29"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="30"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="31"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(Request $request, TokenInterface $token, $providerKey)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="32"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="33"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="34"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="35"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">supportsRememberMe</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="36"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="37"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="38"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="39"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span><span class="hljs-params">(Request $request, AuthenticationException $authException = null)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="40"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="41"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="42"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="43"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Your job is simple: fill in each of these methods. </p>
<h2 id="getcredentials">getCredentials() <a class="headerlink" href="guard-authentication#getcredentials" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Once we hook it up, the <code>getCredentials()</code> method will be called on the authenticator
on <em>every single request</em>. This is your opportunity to collect the username, password,
API token or whatever "credentials" the user is sending in the request.</p>
<p>For this system, we don't need to bother looking for the credentials unless the user
is submitting the login form. Add an if statement: if <code>$request-&gt;getPathInfo()</code> - that's
the current, cleaned URL - <code>!= /login</code> or <code>!$request-&gt;isMethod('POST')</code>, then return
<code>null</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="4cfff2117f">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-28" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 28
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="29"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCredentials</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="30"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="31"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> ($request-&gt;getPathInfo() != <span class="hljs-string">'/login'</span> || !$request-&gt;isMethod(<span class="hljs-string">'POST'</span>)) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="32"></td>
            <td class="blob-code">            <span class="hljs-keyword">return</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="33"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="34-40" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 34 - 40
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="41"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="42-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 42 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>When you return <code>null</code> from <code>getCredentials()</code>, no other methods will be called on
the authenticator.</p>
<p>Below that, return an array that contains any credential information we need. Add
a <code>username</code> key set to <code>$request-&gt;request-&gt;get('_username')</code>: that's the name of
the field in the form:</p>
<p><div class="code-block-wrapper" data-code-block-guid="9cff45d30f">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-28" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 28
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="29"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCredentials</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="30"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="31-34" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 31 - 34
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="35"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> [</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="36"></td>
            <td class="blob-code">            <span class="hljs-string">'username'</span> =&gt; $request-&gt;request-&gt;get(<span class="hljs-string">'_username'</span>),</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="37-39" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 37 - 39
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="40"></td>
            <td class="blob-code">        ];</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="41"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="42-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 42 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Repeat that for password and <code>answer</code>. In the form, answer's
name is <code>the_answer</code> and the last is named <code>terms</code>. Finish the array by fetching
<code>the_answer</code> and <code>terms</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="e60348b4ab">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-28" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 28
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="29"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCredentials</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="30"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="31-34" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 31 - 34
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="35"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> [</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="36"></td>
            <td class="blob-code">            <span class="hljs-string">'username'</span> =&gt; $request-&gt;request-&gt;get(<span class="hljs-string">'_username'</span>),</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="37"></td>
            <td class="blob-code">            <span class="hljs-string">'password'</span> =&gt; $request-&gt;request-&gt;get(<span class="hljs-string">'_password'</span>),</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="38"></td>
            <td class="blob-code">            <span class="hljs-string">'answer'</span>   =&gt; $request-&gt;request-&gt;get(<span class="hljs-string">'the_answer'</span>),</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="39"></td>
            <td class="blob-code">            <span class="hljs-string">'terms'</span>    =&gt; $request-&gt;request-&gt;get(<span class="hljs-string">'terms'</span>),</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="40"></td>
            <td class="blob-code">        ];</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="41"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="42-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 42 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>The keys on the right are obviously the names of the submitted form fields. The keys
on the left can be anything: you'll see how to use them soon.</p>
<h2 id="getuser">getUser() <a class="headerlink" href="guard-authentication#getuser" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>If <code>getCredentials()</code> returns a non-null value, then <code>getUser()</code> is called next.
I have a really simple <code>User</code> entity that has basically just one field: <code>username</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="3553a068d4">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-56" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            56 lines <span class="meta-divider"></span> <span title="src/AppBundle/Entity/User.php">src/AppBundle/Entity/User.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-11" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 11
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserInterface</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="14-20" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 14 - 20
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">    <span class="hljs-comment">/**</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">     * <span class="hljs-doctag">@ORM</span>\Column(type="string")</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code">     */</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code">    <span class="hljs-keyword">private</span> $username;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="25-54" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 25 - 54
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="55"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>I'm not even storing a password. Whatever your situation, just make sure you have
a <code>User</code> class that implements <code>UserInterface</code> <em>and</em> a "user provider" for it that's
configured in <code>security.yml</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="b1ad015509">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-31" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            31 lines <span class="meta-divider"></span> <span title="app/config/security.yml">app/config/security.yml</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-2" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 2
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="3"></td>
            <td class="blob-code"><span class="hljs-attr">security:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="4-5" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 4 - 5
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="6"></td>
            <td class="blob-code"><span class="hljs-attr">    providers:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"><span class="hljs-attr">        my_entity_users:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-attr">            entity:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"><span class="hljs-attr">                class:</span> AppBundle:User</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="10-31" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 10 - 31
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>See the <code>$credentials</code> variable? That's equal to whatever you returned from <code>getCredentials()</code>.
Set a new <code>$username</code> variable by grabbing the <code>username</code> key from it:</p>
<p><div class="code-block-wrapper" data-code-block-guid="bfc54673a9">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-17" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 17
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeirdFormAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="20-42" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 20 - 42
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="43"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span><span class="hljs-params">($credentials, UserProviderInterface $userProvider)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="44"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="45"></td>
            <td class="blob-code">        $username = $credentials[<span class="hljs-string">'username'</span>];</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="46-53" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 46 - 53
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="54"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="55-99" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 55 - 99
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="100"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Let's get crazy and say: "Hey, if you have a username that starts with an <code>@</code> symbol,
that's not okay and you can't login". To fail authentication, return null:</p>
<p><div class="code-block-wrapper" data-code-block-guid="08bcb04c02">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-42" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 42
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="43"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span><span class="hljs-params">($credentials, UserProviderInterface $userProvider)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="44"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="45"></td>
            <td class="blob-code">        $username = $credentials[<span class="hljs-string">'username'</span>];</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="46"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="47"></td>
            <td class="blob-code">        <span class="hljs-comment">// this looks like a weird username</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="48"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> (substr($username, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>) == <span class="hljs-string">'@'</span>) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="49"></td>
            <td class="blob-code">            <span class="hljs-keyword">return</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="50"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="51-53" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 51 - 53
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="54"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="55-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 55 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Now, query for the User! We need the entity manager, so add a <code>private $em</code> property
and generate the constructor. Type-hint it with <code>EntityManager</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="e7adb0e11e">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-5" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 5
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="6"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ORM</span>\<span class="hljs-title">EntityManager</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="7-17" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 7 - 17
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeirdFormAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">    <span class="hljs-keyword">private</span> $em;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="21-22" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 21 - 22
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(EntityManager $em, RouterInterface $router)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">        <span class="hljs-keyword">$this</span>-&gt;em = $em;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="26-26" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... line 26
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="27"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="28-99" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 28 - 99
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="100"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Back in <code>getUser()</code>, this is easy: return <code>$this-&gt;em-&gt;getRepository('AppBundle:User')-&gt;findOneBy()</code>
with <code>username</code> equals <code>$username</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="2cb18dc889">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-42" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 42
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="43"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span><span class="hljs-params">($credentials, UserProviderInterface $userProvider)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="44"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="45"></td>
            <td class="blob-code">        $username = $credentials[<span class="hljs-string">'username'</span>];</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="46-51" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 46 - 51
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="52"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;em-&gt;getRepository(<span class="hljs-string">'AppBundle:User'</span>)</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="53"></td>
            <td class="blob-code">            -&gt;findOneBy([<span class="hljs-string">'username'</span> =&gt; $username]);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="54"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="55-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 55 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>The job of <code>getUser()</code> is to return a User object or null to fail authentication.
It's perfect.</p>
<h2 id="checkcredentials">checkCredentials() <a class="headerlink" href="guard-authentication#checkcredentials" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>If <code>getUser()</code> <em>does</em> return a User, <code>checkCredentials()</code> is called. This is where
you check if the password is valid or anything else to determine that the authentication
request is legitimate.</p>
<p>And surprise! The <code>$credentials</code> argument is once again what you returned from <code>getCredentials()</code>.</p>
<p>Let's check a few things. First, the user doesn't have a password stored in the database.
In my system, the password for everybody is the same: <code>symfony3</code>. If it doesn't equal
<code>symfony3</code>, return <code>null</code> and authentication will fail:</p>
<p><div class="code-block-wrapper" data-code-block-guid="7e25b199e0">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-55" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 55
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="56"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkCredentials</span><span class="hljs-params">($credentials, UserInterface $user)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="57"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="58"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> ($credentials[<span class="hljs-string">'password'</span>] != <span class="hljs-string">'symfony3'</span>) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="59"></td>
            <td class="blob-code">            <span class="hljs-keyword">return</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="60"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="61-70" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 61 - 70
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="71"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="72-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 72 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Second, if the <code>answer</code> does not equal 42, return <code>null</code>. And finally, if the <code>terms</code>
weren't checked, you guessed it, return <code>null</code>. Authentication will fail unless <code>checkCredentials()</code>
exactly returns <code>true</code>. So return that at the bottom:</p>
<p><div class="code-block-wrapper" data-code-block-guid="1aa4542af8">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-55" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 55
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="56"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkCredentials</span><span class="hljs-params">($credentials, UserInterface $user)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="57"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="58-61" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 58 - 61
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="62"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> ($credentials[<span class="hljs-string">'answer'</span>] != <span class="hljs-number">42</span>) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="63"></td>
            <td class="blob-code">            <span class="hljs-keyword">return</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="64"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="65"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="66"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> (!$credentials[<span class="hljs-string">'terms'</span>]) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="67"></td>
            <td class="blob-code">            <span class="hljs-keyword">return</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="68"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="69"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="70"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="71"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="72-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 72 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<h2 id="handling-authentication-success-and-failure">Handling Authentication Success and Failure <a class="headerlink" href="guard-authentication#handling-authentication-success-and-failure" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>That's it! The last few methods handle what happens on authentication failure and
success. Both should return a <code>Response</code> object, or null to do nothing and let the
request continue.</p>
<h3 id="onauthenticationfailure">onAuthenticationFailure() <a class="headerlink" href="guard-authentication#onauthenticationfailure" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>The <code>$exception</code> passed to <code>onAuthenticationFailure</code> holds details about <em>what</em> went
wrong:</p>
<p><div class="code-block-wrapper" data-code-block-guid="a3f7494b36">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-72" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 72
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="73"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(Request $request, AuthenticationException $exception)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="74"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="75-79" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 75 - 79
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="80"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="81-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 81 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Was the user not found? Were the credentials wrong? Store this in the session
so we can show it to the user. For the key, use the constant: <code>Security::AUTHENTICATION_ERROR</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="b1a368d2cd">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-72" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 72
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="73"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(Request $request, AuthenticationException $exception)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="74"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="75"></td>
            <td class="blob-code">        $request-&gt;getSession()-&gt;set(Security::AUTHENTICATION_ERROR, $exception);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="76-79" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 76 - 79
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="80"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="81-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 81 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>This is <em>exactly</em> what the normal form login system does: it adds an error to this
same key on the session. </p>
<p>In the controller, the <code>security.authentication.utils</code> service reads this key from the session
when you call <code>getLastAuthenticationError()</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="f190a111f8">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-42" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            42 lines <span class="meta-divider"></span> <span title="src/AppBundle/Controller/DefaultController.php">src/AppBundle/Controller/DefaultController.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-8" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 8
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="10"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="11-21" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 11 - 21
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">    <span class="hljs-comment">/**</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code">     * <span class="hljs-doctag">@Route</span>("/login", name="login")</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code">     */</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sillyLoginAction</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="27"></td>
            <td class="blob-code">        $error = <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-string">'security.authentication_utils'</span>)</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="28"></td>
            <td class="blob-code">            -&gt;getLastAuthenticationError();</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="29-32" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 29 - 32
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="33"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="34-40" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 34 - 40
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="41"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Other than storing the error, what we <em>really</em> want to do when authentication fails
is redirect back to the login page. To do this, add the <code>Router</code> as an argument to
the constructor and use that to set a new property. I'll do that with a
<a href="../phpstorm/service-shortcuts#generating-constructor-properties">shortcut</a>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="9b2abd6d4e">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-9" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 9
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="10"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Routing</span>\<span class="hljs-title">RouterInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="11-17" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 11 - 17
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeirdFormAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="20-20" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... line 20
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">    <span class="hljs-keyword">private</span> $router;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(EntityManager $em, RouterInterface $router)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="25-25" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... line 25
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code">        <span class="hljs-keyword">$this</span>-&gt;router = $router;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="27"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="28-99" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 28 - 99
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="100"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Now it's simple: <code>$url = $this-&gt;router-&gt;generate()</code> and pass it <code>login</code> - that's the
route name to my login page. Then, return a <code>new RedirectResponse</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="c2b4569933">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-72" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 72
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="73"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(Request $request, AuthenticationException $exception)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="74"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="75-76" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 75 - 76
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">        $url = <span class="hljs-keyword">$this</span>-&gt;router-&gt;generate(<span class="hljs-string">'login'</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="78"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="79"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RedirectResponse($url);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="80"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="81-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 81 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<h3 id="onauthenticationsuccess">onAuthenticationSuccess() <a class="headerlink" href="guard-authentication#onauthenticationsuccess" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>When authentication works, keep it simple and redirect back to the homepage. In a
real app, you'll want to redirect them back to the previous page:</p>
<p><div class="code-block-wrapper" data-code-block-guid="74e2a6429d">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-81" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 81
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="82"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(Request $request, TokenInterface $token, $providerKey)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="83"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="84"></td>
            <td class="blob-code">        $url = <span class="hljs-keyword">$this</span>-&gt;router-&gt;generate(<span class="hljs-string">'homepage'</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="85"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="86"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RedirectResponse($url);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="87"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="88-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 88 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>There's a base class called <code>AbstractFormLoginAuthenticator</code> that can help with this.</p>
<h3 id="start-inviting-the-user-to-authentication">start() - Inviting the User to Authentication <a class="headerlink" href="guard-authentication#start-inviting-the-user-to-authentication" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>The <code>start()</code> method is called when the user tries to access a page that requires
login as an anonymous user. For this situation, redirect them to the login page:</p>
<p><div class="code-block-wrapper" data-code-block-guid="2609556690">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-88" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 88
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="89"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span><span class="hljs-params">(Request $request, AuthenticationException $authException = null)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="90"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="91"></td>
            <td class="blob-code">        $url = <span class="hljs-keyword">$this</span>-&gt;router-&gt;generate(<span class="hljs-string">'login'</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="92"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="93"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RedirectResponse($url);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="94"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="95-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 95 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<h3 id="supportsrememberme">supportsRememberMe() <a class="headerlink" href="guard-authentication#supportsrememberme" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>Finally, if you want to be able to support remember me functionality, return true
from <code>supportsRememberMe()</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="5bead0c372">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-101" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            101 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-95" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 95
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="96"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">supportsRememberMe</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="97"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="98"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="99"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="100-101" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 100 - 101
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>You'll still need to configure the <code>remember_me</code> key in the firewall.</p>
<h2 id="configuring-the-authenticator">Configuring the Authenticator <a class="headerlink" href="guard-authentication#configuring-the-authenticator" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>That's it! Now we need to tell Symfony about the authentication with two steps. The
first shouldn't surprise you: register this as a service. In <code>services.yml</code> create
a new service - how about <code>weird_authenticator</code>. The class is <code>WeirdFormLoginAuthenticator</code>
and there are two arguments: the entity manager and the router:</p>
<p><div class="code-block-wrapper" data-code-block-guid="3c9f54bf74">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-10" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            10 lines <span class="meta-divider"></span> <span title="app/config/services.yml">app/config/services.yml</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-5" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 5
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="6"></td>
            <td class="blob-code"><span class="hljs-attr">services:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"><span class="hljs-attr">    weird_authenticator:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-attr">        class:</span> AppBundle\Security\WeirdFormAuthenticator</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"><span class="hljs-attr">        arguments:</span> [<span class="hljs-string">'@doctrine.orm.entity_manager'</span>, <span class="hljs-string">'@router'</span>]</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Finally, hook this up in security.yml. Under your firewall, add a <code>guard</code> key and
an <code>authenticators</code> key below that. Add one authenticator - <code>weird_authenticator</code> -
the service name:</p>
<p><div class="code-block-wrapper" data-code-block-guid="0afece19a6">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-31" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            31 lines <span class="meta-divider"></span> <span title="app/config/security.yml">app/config/security.yml</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-2" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 2
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="3"></td>
            <td class="blob-code"><span class="hljs-attr">security:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="4-10" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 4 - 10
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="11"></td>
            <td class="blob-code"><span class="hljs-attr">    firewalls:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="12-16" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 12 - 16
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code"><span class="hljs-attr">        main:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code"><span class="hljs-attr">            anonymous:</span> ~</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="19-21" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 19 - 21
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code"><span class="hljs-attr">            guard:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code"><span class="hljs-attr">                authenticators:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code"><span class="hljs-bullet">                    -</span> weird_authenticator</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="25-31" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 25 - 31
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Now, <code>getCredentials()</code> will be called on every request. If it returns something
other than <code>null</code>, <code>getUser()</code> will be called. If this returns a <code>User</code>, then
<code>checkCredentials()</code> will be called. And if this returns <code>true</code>, authentication
will pass.</p>
<h2 id="test-the-login">Test the Login <a class="headerlink" href="guard-authentication#test-the-login" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Try it out! With a blank form, it says <code>Username could not be found</code>. It <em>is</em> looking
for the credentials on the request, but it fails on the <code>getUser()</code> method. I do
have one user in the database: <code>weaverryan</code>.  Put <code>symfony3</code> for the password but
set the answer to 50. This fails with "Invalid Credential". Finally, fill in everything
correctly. And it works! The web debug toolbar congratulates us: logged in as weaverryan.</p>
<h2 id="customize-the-error-messages">Customize the Error Messages <a class="headerlink" href="guard-authentication#customize-the-error-messages" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>We saw two different error messages, depending on whether authentication failed in
<code>getUser()</code> or <code>checkCredentials()</code>. But you can <em>completely</em> control these messages
by throwing a <code>CustomUserMessageAuthenticationException()</code>. I know, it has a long name,
but it's job is clear: pass it the message you want want to show the user, like:</p>
<p><div class="code-block-wrapper" data-code-block-guid="0ca2c8d66a">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-108" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            108 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-12" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 12
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">CustomUserMessageAuthenticationException</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="14-43" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 14 - 43
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="44"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span><span class="hljs-params">($credentials, UserProviderInterface $userProvider)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="45"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="46-48" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 46 - 48
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="49"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> (substr($username, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>) == <span class="hljs-string">'@'</span>) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="50"></td>
            <td class="blob-code">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomUserMessageAuthenticationException(</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="51"></td>
            <td class="blob-code">                <span class="hljs-string">'Starting a username with @ is weird, don\'t you think?'</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="52"></td>
            <td class="blob-code">            );</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="53"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="54-56" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 54 - 56
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="57"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="58-108" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 58 - 108
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Below if the <code>answer</code> is wrong, do the same thing: <code>throw new CustomUserMessageAuthenticationException()</code>
with:</p>
<p><div class="code-block-wrapper" data-code-block-guid="9376281293">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-108" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            108 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-58" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 58
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="59"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkCredentials</span><span class="hljs-params">($credentials, UserInterface $user)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="60"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="61-64" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 61 - 64
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="65"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> ($credentials[<span class="hljs-string">'answer'</span>] != <span class="hljs-number">42</span>) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="66"></td>
            <td class="blob-code">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomUserMessageAuthenticationException(</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="67"></td>
            <td class="blob-code">                <span class="hljs-string">'Don\'t you read any books?'</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="68"></td>
            <td class="blob-code">            );</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="69"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="70-77" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 70 - 77
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="78"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="79-108" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 79 - 108
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>And in case the terms checkbox isn't checked, throw a new <code>CustomUserMessageAuthenticationException</code>
and threaten them to agree to our terms!</p>
<p><div class="code-block-wrapper" data-code-block-guid="687e1802b9">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-108" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            108 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/WeirdFormAuthenticator.php">src/AppBundle/Security/WeirdFormAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-58" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 58
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="59"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkCredentials</span><span class="hljs-params">($credentials, UserInterface $user)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="60"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="61-70" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 61 - 70
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="71"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> (!$credentials[<span class="hljs-string">'terms'</span>]) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="72"></td>
            <td class="blob-code">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomUserMessageAuthenticationException(</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="73"></td>
            <td class="blob-code">                <span class="hljs-string">'Agree to our terms!!!'</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="74"></td>
            <td class="blob-code">            );</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="75"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="76"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="78"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="79-108" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 79 - 108
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Try it out with <code>@weaverryan</code>. There's the first message! Try 50 for the answer:
there's the second message. And if you fill in everything right but have no checkbox,
you see the final message.</p>
<p>That's Guard authentication: create one class and do whatever the heck that you want.
I showed a login form, but it's even easier to use for API authentication. Basically,
authentication is not hard anymore. Invent whatever insane system you want and give
the user exactly the message you want. If you want to return <code>JSON</code> on authentication
failure and success instead of redirecting, awesome, do it. </p>

    
                        </div>
                    </div>
                    <div class="tab-pane" id="tab-comment">
                        <h3>Leave a comment!</h3>
                                                        <div id="disqus_thread">
                <style type="text/css">
            #dsq-comments {padding: 10px 0 0}
            .dsq-comment {position: relative;clear: both;margin: 0 0 1.5em;}
            .dsq-avatar {left: 0;position: absolute;}
            .dsq-avatar img {border: 0 none;border-radius: 3px;height: 36px;width: 36px;}
            .dsq-comment-body {padding: 0 0 0 46px;}
            .dsq-comment-header {border: 1px solid rgba(0, 0, 0, 0.15);border-radius: 3px;font-size: 13px;line-height: 14px;margin: 0 0 1em;max-height: 36px;overflow: hidden;padding: 10px;position: relative;text-overflow: ellipsis;white-space: nowrap;}
            .dsq-comment-message {word-wrap: break-word;}
            .dsq-comment-message {line-height: 1.5em;margin: 0 0 1em;}
            .dsq-comment-text {display: inline;}
            .dsq-comment-date {float: right;font-size: 90%;margin: 0 12px 0 0;}
        </style>

	    <div id="dsq-content">
	        <ul id="dsq-comments">
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="3029473775" id="dsq-comment-3029473775">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-3029473775">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-12-01</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-3029473775" class="dsq-comment-message">
	                            <div id="dsq-comment-text-3029473775" class="dsq-comment-text">
	                                <p>Great find and fix Thomas! Yes, multiple firewalls don't share *anything*... unless you find that nice context property :). Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="3028628996" id="dsq-comment-3028628996">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_8IeBKOiBBs/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-3028628996">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-11-30</span>
	                            <span class="dsq-commenter-name">Thomas Baumgartner</span>
	                        </div>

	                        <div id="dsq-comment-message-3028628996" class="dsq-comment-message">
	                            <div id="dsq-comment-text-3028628996" class="dsq-comment-text">
	                                <p>Thank you Ryan! <br>I'm sorry to have bothered you with that. Turned out that it's not an impersonation problem, but has rather something to do with firewalls / access_control / role_hierarchy. I also have different routes for admin_login / employee_login, same with login_check and logout, but I am using the same UserProvider and database table for both. Now the strange thing is that I am able to log in into both araeas of the site with the same admin user (as for the role_hierarchy is granting me this), but I am not automatically logged in as employee, when I log into the admin area. (and I think thats the reason why impersonation cannot work either). So the question is, what makes the tokenStorage to be restricted to one area/acl-path only? (Interestingly, if I log out from one of the areas, I am logged out from both). Below my security.yml:</p><p></p><pre><code><br>    firewalls:<br>        admin:<br>            pattern: ^/admin/<br>            anonymous: ~<br>            guard:<br>                authenticators:<br>                    - app.admin_login_authenticator<br>            logout:<br>                path: admin_logout<br>                target: admin_login<br>        employee:<br>            pattern: ^/employee/<br>            anonymous: ~<br>            guard:<br>                authenticators:<br>                    - app.employee_login_authenticator<br>            logout:<br>                path: employee_logout<br>                target: employee_login<br>            switch_user: ~<br><br>    access_control:<br>        - { path: "^/admin/login", roles: IS_AUTHENTICATED_ANONYMOUSLY }<br>        - { path: "^/employee/login", roles: IS_AUTHENTICATED_ANONYMOUSLY }<br>        - { path: "^/admin/", roles: [ROLE_ADMIN, ROLE_PROJECT_MANAGER] } <br>        - { path: "^/employee/", roles: [ROLE_EMPLOYEE] }<br><br>    role_hierarchy:<br>        ROLE_DEVELOPER: [ROLE_ADMIN, ROLE_ALLOWED_TO_SWITCH]<br>        ROLE_ADMIN: [ROLE_PROJECT_MANAGER, ROLE_ALLOWED_TO_SWITCH]<br>        ROLE_PROJECT_MANAGER: [ROLE_EMPLOYEE]<br>        ROLE_EMPLOYEE: []<br></code></pre><p></p><p>UPDATE: hah, got it! It's the firewall configuration. Not sharing the token between firewalls totally makes sense, just not in my case. I only had to add a context property containing the same string to each of my firewall configuartions and I'm done. Token shared, impersonation works. Thank you so much again Ryan, feel free to delete this post, if you consider it too much off topic in this place.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="3028190911" id="dsq-comment-3028190911">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-3028190911">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-11-30</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-3028190911" class="dsq-comment-message">
	                            <div id="dsq-comment-text-3028190911" class="dsq-comment-text">
	                                <p>Hey <a data-dsq-mention="disqus_8iebkoibbs:disqus" href="https://disqus.com/by/disqus_8IeBKOiBBs/" rel="nofollow noopener">Thomas Baumgartner</a>!</p><p>Ah, awesome! Thanks for sharing this solution - it's very clever!</p><p>About the impersonation, it should just work - it's independent of whether you're using Guard or some other authentication system. There are two things you should look at: (A) Make sure you have the <code>switch_user</code> key configured under your firewall and (B) make sure you "user provider" is setup correctly (since the <code>loadUserByUsername</code> method is used to actually find and load the new user when you switch).</p><p>If that doesn't help, let me know the error - it may spark another idea :).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="3027743537" id="dsq-comment-3027743537">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_8IeBKOiBBs/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-3027743537">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-11-30</span>
	                            <span class="dsq-commenter-name">Thomas Baumgartner</span>
	                        </div>

	                        <div id="dsq-comment-message-3027743537" class="dsq-comment-message">
	                            <div id="dsq-comment-text-3027743537" class="dsq-comment-text">
	                                <p>Hi Ryan,<br>Guard was super helpful with one of my legacy projects. I never managed to do a "silent" migration from old md5 hashed passwords to bcrypt encoded passwords. Maybe I have not tried hard enough - anyway: With Guard it was a piece of cake. In the checkCredentials I  did just this:</p><p><code></code></p><pre><code>$plainPassword = $credentials['password'];<br>if(null === $user-&gt;getPassword()) {<br>    if($user-&gt;getOldPassword() === md5($plainPassword.$user-&gt;getOldSalt())) {<br>        $user<br>            -&gt;setPassword($this-&gt;encoder-&gt;encodePassword($user, $plainPassword))<br>            -&gt;setOldPassword(null);<br>        ;<br>        $this-&gt;em-&gt;persist($user);<br>        $this-&gt;em-&gt;flush();<br>    }<br>}<br>if (!$this-&gt;encoder-&gt;isPasswordValid($user, $plainPassword)) {<br>    throw new BadCredentialsException();<br>}<br>return true;<br></code></pre><p></p><p>Thought that might be helpful for others having the same problem.</p><p>I have also a question: I tried to use the impersonation featured as described in another tutorial <a href="https://disq.us/url?url=https%3A%2F%2Fknpuniversity.com%2Fscreencast%2Fsymfony-security%2Fimpersonation-switch-user%3Awp_jJMudE4nUB4GzX1t80om-sls&amp;cuid=1175718" rel="nofollow noopener">https://knpuniversity.com/scre...</a> , but it does not work. I am trying to impersonate an admin (logged in behind admin firewall) as employee (behind an employee firewall). Is impersonation supposed to work the way as described in this other screencast mentioned above? Am I doing it wrong usinge different firewalls for that? Or something else?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2959794342" id="dsq-comment-2959794342">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_idpJQYpFjJ/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/20654/9029/avatar92.jpg?1478365637">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2959794342">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-20</span>
	                            <span class="dsq-commenter-name">Thierno Diop</span>
	                        </div>

	                        <div id="dsq-comment-message-2959794342" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2959794342" class="dsq-comment-text">
	                                <p>No its actually calling logout url if i comment the settoken to null in the controller of logout url the user is not logged out i will look in my viejs and will talk you back thx a lot</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2958682368" id="dsq-comment-2958682368">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2958682368">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-19</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2958682368" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2958682368" class="dsq-comment-text">
	                                <p>Hey Thierno!</p><p>Hmm, that is weird! If you look at the logs, and you can actually see something calling /logout, then the problem may be with vuejs. What I mean is, if you have a failure somewhere in your Symfony security system, then you might ultimately become logged out, but Symfony will not actually make a request to /logout. If something is making a request to this URL, it's gotta be something on the frontend.</p><p>Let me know if that's the case, or if you just mean that you see something else in the logs (not a request to /logout, but some details about the user being logged out).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2958583308" id="dsq-comment-2958583308">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_idpJQYpFjJ/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/20654/9029/avatar92.jpg?1478365637">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2958583308">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-19</span>
	                            <span class="dsq-commenter-name">Thierno Diop</span>
	                        </div>

	                        <div id="dsq-comment-message-2958583308" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2958583308" class="dsq-comment-text">
	                                <p>Thx ryan I have read the log and the url logout is called and thats weired cause i look at the my service for using guard authentication and there is no call to the uri and my app is hybrid i mean som vuejs and traditional website </p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2954873643" id="dsq-comment-2954873643">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2954873643">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-17</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2954873643" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2954873643" class="dsq-comment-text">
	                                <p>Hey Thierno!</p><p>Hmm... What do you mean by "the logout URL is called"? Is something on the frontend actually making a request to /logout? Or do you just mean that you are being logged out somehow? Is your frontend pure JS or a traditional web app? Usually, when stuff happens like this, it's because there's a problem with your user provider... but I'm not totally sure in your case, since it *was* working before. Give me some more information, and I'm sure we can get to the bottom of it :).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2953930571" id="dsq-comment-2953930571">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_idpJQYpFjJ/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/20654/9029/avatar92.jpg?1478365637">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2953930571">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-17</span>
	                            <span class="dsq-commenter-name">Thierno Diop</span>
	                        </div>

	                        <div id="dsq-comment-message-2953930571" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2953930571" class="dsq-comment-text">
	                                <p>Hi Ryan i have a probleme with my authentication it worked perfectly but today i make some modification in the front end and now when i login its working but immediately after connexion the logout url is called automatically and i am logged out.<br>I am very confused!!!!<br>Help please</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2948700486" id="dsq-comment-2948700486">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2948700486">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-13</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2948700486" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2948700486" class="dsq-comment-text">
	                                <p>Ah, you're right! What a bummer! Well, hopefully you can find something else or build off of its ideas at least!</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2946488931" id="dsq-comment-2946488931">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_2PuHM4Cl8d/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2946488931">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-12</span>
	                            <span class="dsq-commenter-name">Abou</span>
	                        </div>

	                        <div id="dsq-comment-message-2946488931" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2946488931" class="dsq-comment-text">
	                                <p>Thank's a lot for the answer !</p><p>I've tried to use that bundle but composer complains for some incompatibility with my symfony version (3.1.4) ... :(</p><p>Anyway thank you so much for beeing so envolved and so kind to answer all ower questions !</p><p>Abou.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2944925524" id="dsq-comment-2944925524">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2944925524">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-11</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2944925524" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2944925524" class="dsq-comment-text">
	                                <p>Hi <a data-dsq-mention="disqus_2puhm4cl8d:disqus" href="https://disqus.com/by/disqus_2PuHM4Cl8d/" rel="nofollow noopener">Abou</a>!</p><p>Absolutely! But, it might even be easier to use this bundle without guard: <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2FBeSimple%2FBeSimpleSsoAuthBundle%3ADL0KPtitB537cc3JBmjsBn86NLw&amp;cuid=1175718" rel="nofollow noopener">https://github.com/BeSimple/Be...</a>. You can see an example project created by a friend of mine here that uses this for CAS: <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Frlbaltha%2Fcert%3AfKFfjCXaWc42oZZkNptXZAYaUSo&amp;cuid=1175718" rel="nofollow noopener">https://github.com/rlbaltha/ce...</a>.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2944435038" id="dsq-comment-2944435038">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_2PuHM4Cl8d/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2944435038">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-11</span>
	                            <span class="dsq-commenter-name">Abou</span>
	                        </div>

	                        <div id="dsq-comment-message-2944435038" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2944435038" class="dsq-comment-text">
	                                <p>Very cool tut' !<br>Is it possible to use Guard with a CAS Server ?... Is there a ressource on the net I can read ?...</p><p>Thank you</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2851250241" id="dsq-comment-2851250241">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/bocharsky25/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/11445/2822/avatar92.jpg?1482485806">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2851250241">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-08-22</span>
	                            <span class="dsq-commenter-name">Victor Bocharsky</span>
	                        </div>

	                        <div id="dsq-comment-message-2851250241" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2851250241" class="dsq-comment-text">
	                                <p>Hey Nicolas,</p><p>This's difficult to answer without some debugging :). The most common error here is that you could missed return statement in your FormLoginAuthenticator, i.e. you get an User object from DB but forget to *return* it. So, first of all, check all necessary return statements in FormLoginAuthenticator methods. If everything is find, well, debug your code step by step starts from the fist method. I'd recommend to simply use "dump(); die;", dump the result which every method should return and compare this actual result with an expected result.You'll figure out some cases, i.e. you forget to return valid credentials or your DB query is invalid and don't return an User object etc. In this way you can realize on what method you stuck.</p><p>If this didn't help you - provide a bit more information for us like what method wasn't called, etc. and we try to help you with it.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2848016261" id="dsq-comment-2848016261">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="guard-authentication">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2848016261">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-08-20</span>
	                            <span class="dsq-commenter-name">Nicolas</span>
	                        </div>

	                        <div id="dsq-comment-message-2848016261" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2848016261" class="dsq-comment-text">
	                                <p>Hi,<br>Thanks for the tutorial.<br>I did the tutorial but i can't login in, i am everything look great but when i am going back to "homepage" i am still log as anonymous. No error message.</p><p>Any Suggestion ?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2785778271" id="dsq-comment-2785778271">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2785778271">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-07-15</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2785778271" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2785778271" class="dsq-comment-text">
	                                <p>Yes, this is a really important detail - one that we use here on our site!</p><p>Here's the trick: use the TargetPathTrait and call the getTargetPath() method: <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Fsymfony%2Fsymfony%2Fblob%2Fmaster%2Fsrc%2FSymfony%2FComponent%2FSecurity%2FHttp%2FUtil%2FTargetPathTrait.php%3AghDwhfQsNP1kCoAC10PnOQJwKq0&amp;cuid=1175718" rel="nofollow noopener">https://github.com/symfony/sym...</a>. This is new in Symfony 3.1 - but no problem: if you're on an earlier version, simply copy that small function into your code.</p><p>Here's what's going on:</p><p>A) When you try to access some secure page (e.g. /admin) and are redirected to the login page (or more accurately, the start() method in one of your authenticators redirects the user to the login page), Symfony automatically stores this URL (/admin) in the session under a very specific key.</p><p>B) The TargetPathTrait::getTargetPath() function is just a helper for you to read this key from the session.</p><p>Let me know if it works! We also do this same thing after registration - since the user might choose to register instead of logging in ;).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2782823626" id="dsq-comment-2782823626">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/dlegatt/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2782823626">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-07-14</span>
	                            <span class="dsq-commenter-name">dlegatt</span>
	                        </div>

	                        <div id="dsq-comment-message-2782823626" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2782823626" class="dsq-comment-text">
	                                <p>It didnt work, I just sit at the login page now.  Here is what my main firewall looks like.  I didnt have the form_login section before, i added it so I could have the use_referer option.  Without that, I got an error when the controller returned null.<br></p><pre><code><br>    main:<br>      pattern: ^/<br>      anonymous: ~<br>      logout:<br>        path: /logout<br>        target: /<br>      form_login:<br>        use_referer: true<br>        login_path: /admin/login<br>        check_path: /admin/login_check<br>      guard:<br>        provider: admin_user_provider<br>        authenticators:<br>          - app.authenticator.form<br></code></pre>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2782628645" id="dsq-comment-2782628645">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/bocharsky25/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/11445/2822/avatar92.jpg?1482485806">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2782628645">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-07-14</span>
	                            <span class="dsq-commenter-name">Victor Bocharsky</span>
	                        </div>

	                        <div id="dsq-comment-message-2782628645" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2782628645" class="dsq-comment-text">
	                                <p>Hey <a data-dsq-mention="dlegatt:disqus" href="https://disqus.com/by/dlegatt/" rel="nofollow noopener">dlegatt</a> ,</p><p>If I recall correctly, you should return null in your `onAuthenticationSuccess()` and it will work out of the box. Could you try it? If it still does not work, force it with <a href="http://disq.us/url?url=http%3A%2F%2Fsymfony.com%2Fdoc%2Fcurrent%2Fcookbook%2Fsecurity%2Fform_login.html%23using-the-referring-url%3A8GpNcQkXJWsfCQJKDVJndm-3yZY&amp;cuid=1175718" rel="nofollow noopener">enabling use_referer option</a>. I think it should help.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2780773441" id="dsq-comment-2780773441">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/dlegatt/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2780773441">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-07-13</span>
	                            <span class="dsq-commenter-name">dlegatt</span>
	                        </div>

	                        <div id="dsq-comment-message-2780773441" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2780773441" class="dsq-comment-text">
	                                <p>Hi Ryan!  I really love the guard component, it has helped make security in my app much simpler to set up and maintain.  One of my guard authenticators is a traditional form login.  Right now, when someone is redirected to the login page after trying to reach a secure page, I have the onAuthenticationSuccess method redirect them to the index page of the secured area.  How can I direct them to the page the requested before logging in?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2673900323" id="dsq-comment-2673900323">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2673900323">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-05-13</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2673900323" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2673900323" class="dsq-comment-text">
	                                <p>Hi there!</p><p>If you use - dump($credentials);die; - then you should be able to debug like any normal situation. You likely will need the die, since if you fail authentication, you are probably redirecting the user to another page. If you still don't see the dump, then you are somehow *not* reaching checkCredentials().</p><p>Another thing to look at is to temporarily turn on "intercept_redirects" in config_dev.yml (you should see it there already, commented-out). When you do this, instead of redirecting, Symfony will *stop* and show you a page. On this page, you will see the web debug toolbar for the current request (the one that is redirecting the user). You can see the dump() there, and any other information.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2673685097" id="dsq-comment-2673685097">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/razvandp/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/17005/2574/avatar92.jpg?1481702558">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2673685097">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-05-13</span>
	                            <span class="dsq-commenter-name">rddro</span>
	                        </div>

	                        <div id="dsq-comment-message-2673685097" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2673685097" class="dsq-comment-text">
	                                <p>How can I debug inside these methods ? <br>For example in checkCredentials i want to dump the $credentials but it's not working :(</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2586812399" id="dsq-comment-2586812399">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2586812399">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-24</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2586812399" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2586812399" class="dsq-comment-text">
	                                <p>Hi Andrzej!</p><p>Yes, it *is* good to clear your plan password in eraseCredentials - it just makes sure that the plain password doesn't accidentally get stored anywhere, like the session. Symfony automatically calls this after you login. You just need to make sure that you don't also clear the password field :). In this case, in eraseCredentials(), I would directly set $this-&gt;plainPassword = null - instead of calling setPlainPassword(). That should also fix the problem.</p><p>Cheers and thanks for sharing!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2585073022" id="dsq-comment-2585073022">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/andkog/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2585073022">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-23</span>
	                            <span class="dsq-commenter-name">Andrzej</span>
	                        </div>

	                        <div id="dsq-comment-message-2585073022" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2585073022" class="dsq-comment-text">
	                                <p>I found the reason of this problem, it was cause because of setPlainPassword() and eraseCredentials() methods in User class. I found in Symfony documentation that it is good co clear plainPassword for security reasons. Commenting out $this-&gt;setPlainPassword(null); fixes the problem.</p><p></p><pre><br><code><br><br>  public function setPlainPassword($plainPassword)<br><br>    {<br><br>    $this-&gt;plainPassword = $plainPassword;<br><br>    $this-&gt;setPassword(null);<br><br>    }<br><br> public function eraseCredentials()<br><br>    {<br><br>$this-&gt;setPlainPassword(null);<br><br>    }<br><br></code><br><br></pre>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2583706714" id="dsq-comment-2583706714">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2583706714">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-22</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2583706714" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2583706714" class="dsq-comment-text">
	                                <p>Hmm, curious - that is *not* the problem then. Does your user implement AdvancedUserInterface by chance?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2582840096" id="dsq-comment-2582840096">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/andkog/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2582840096">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-22</span>
	                            <span class="dsq-commenter-name">Andrzej</span>
	                        </div>

	                        <div id="dsq-comment-message-2582840096" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2582840096" class="dsq-comment-text">
	                                <p>Hello, this is my getRoles() method</p><p></p><pre><code><br>public function getRoles()<br><br>{<br><br>$roles = $this-&gt;roles;<br><br>$roles[] = 'ROLE_USER';<br><br>return array_unique($roles);<br><br>}<br></code><br></pre><p></p><p>Here is screen from my toolbar</p><p><a href="http://disq.us/url?url=http%3A%2F%2Fwww.awesomescreenshot.com%2Fimage%2F1101770%2Ff621f2898398db69d11601314f1bd26c%3AANj_7mSFKepOxY0FUcDWJESEIKs&amp;cuid=1175718" rel="nofollow noopener">http://www.awesomescreenshot.c...</a></p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2581425814" id="dsq-comment-2581425814">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2581425814">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-21</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2581425814" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2581425814" class="dsq-comment-text">
	                                <p>Hey Andrzej!</p><p>I'm glad you solved the first problem :). About the second problem, what does your getRoles() method look like in your User class? Make sure that it *always* returns at least *one* role. If you return zero roles from getRoles(), then you will see this behavior. Let me know if that's the problem!</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2580949827" id="dsq-comment-2580949827">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/andkog/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2580949827">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-21</span>
	                            <span class="dsq-commenter-name">Andrzej</span>
	                        </div>

	                        <div id="dsq-comment-message-2580949827" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2580949827" class="dsq-comment-text">
	                                <p>I solved the problem with encoded password, I made mistake in my fixtures and I was encoding password not plain password. But I still can't find out why when i log in  in toolbar I see<br>Loggedin: admin<br>Authenticated: No</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2576618543" id="dsq-comment-2576618543">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/andkog/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2576618543">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-18</span>
	                            <span class="dsq-commenter-name">Andrzej</span>
	                        </div>

	                        <div id="dsq-comment-message-2576618543" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2576618543" class="dsq-comment-text">
	                                <p>Hello,</p><p>I am implementing custom authentication with guard end everything works fine until I create password encoding. To encode password I use doctrine event listeners (I pass @security.password_encoder as a servcie argument) and I encode password this way</p><p></p><pre><br><code><br><br>   $password = $this-&gt;userPasswordEncoder-&gt;encodePassword($user, $user-&gt;getPlainPassword());<br><br>   $user-&gt;setPassword($password);<br><br></code><br><br></pre><p></p><p>And then inside FormLoginAuthenticator I check password in checkCredentials method</p><p></p><pre><br><code><br><br> public function checkCredentials($credentials, UserInterface $user)<br><br>    {<br><br>        if($this-&gt;userPasswordEncoder-&gt;isPasswordValid($user, $credentials['password'])) {<br><br>            return true;<br><br>        }<br><br>        throw new CustomUserMessageAuthenticationException('Wrong password');<br><br>    }<br><br></code><br><br></pre><p></p><p>And here i have the problem becasue it alwys return false. I tried to expermient with password encoding and i did dump() of</p><p>$this-&gt;userPasswordEncoder-&gt;encodePassword($user, 'admin123'); a couple of times and it always returned different string. I wonder what I am doing wrong?</p><p>When I get rid of password encoding and i save plain password in datase authentication works fine, except the fact that in symfony toolbar i see:</p><p>Loggedin: admin</p><p>Authenticated: No</p><p>What might be the reason of this?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2564091088" id="dsq-comment-2564091088">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/tanariel/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/4177/5590/avatar92.jpg?1364295355">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2564091088">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-11</span>
	                            <span class="dsq-commenter-name">Tanariel</span>
	                        </div>

	                        <div id="dsq-comment-message-2564091088" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2564091088" class="dsq-comment-text">
	                                <p>Thanks much for your answer, it does help indeed :)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2562403369" id="dsq-comment-2562403369">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2562403369">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-10</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2562403369" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2562403369" class="dsq-comment-text">
	                                <p>Hi there!</p><p>Really good questions :). Let me try to help:</p><p>1) I don't usually use a Symfony form for a login form - I feel it's overkill. But, it's certainly not wrong.</p><p>2) Yes, I would submit the form in getCredentials(), and then return the array of data from that method (or an object, if you have your form bound to an object).</p><p>3) How to send back the errors, is a little more difficult. If the form is not valid, I would probably save the form into the request object and then fail authentication (all in getCredentials()):</p><p></p><pre><code><br>if (!$form-&gt;isValid()) {<br>    $request-&gt;attributes-&gt;set('login_form', $form);<br>}<br></code></pre><p></p><p>Then, in onAuthenticationFailure(), I would do nothing: allow the request to *continue* to your controller. Make sure that the URL you submit your form to (e.g. /login) is the same URL that *displays* your login form. That way, by doing nothing in onAuthenticationFailure, the request will continue and will call your loginAction (the one that displays your form). Here, look for the Form in the Request and use it:</p><p></p><pre><code><br>public function loginAction(Request $request)<br>{<br>    if ($request-&gt;attributes-&gt;has('login_form')) {<br>        $form = $request-&gt;attributes-&gt;get('login_form');<br>        $request-&gt;attributes-&gt;remove('login_form');<br>    } else {<br>        $form = $this-&gt;createForm(...);<br>    }<br><br>    // ... all your normal logic<br>}<br></code></pre><p></p><p>If authentication fails, you will use the form that was stored (temporarily) on the request: this will have all the normal, bound errors.</p><p>For me - this isn't worth the trouble :). But it certainly will work just fine.</p><p>4) If you have a chain of authenticators, each of them should be authenticating in a different way - e.g. one for form login, one for API key authentication etc. So, think only your "form login" authenticator would have a form - the others would just do whatever *they* need to do.</p><p>I hope that helps!</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2562092881" id="dsq-comment-2562092881">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/tanariel/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/4177/5590/avatar92.jpg?1364295355">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2562092881">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-10</span>
	                            <span class="dsq-commenter-name">Tanariel</span>
	                        </div>

	                        <div id="dsq-comment-message-2562092881" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2562092881" class="dsq-comment-text">
	                                <p>Hi everyone !</p><p>Thanks for guard, it's really a nice way to make authentication simpler.</p><p>I have a question about it though, i'm trying to use a form type as login form, but i can't figure out where the form should be validated ? At start of the guard class in getCredentials() ? If so, how would i be able to send back the error list of the form ?</p><p>Is it a bad practice to go for a form type for login form ?</p><p>If i use a chain of guard authenticators, would the form need to be validated on every getCredential() ?</p><p>Thanks in advance if any of you have answer / advice about this.<br>And thanks again for those nice tutorials :)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2459674991" id="dsq-comment-2459674991">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2459674991">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-01-15</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2459674991" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2459674991" class="dsq-comment-text">
	                                <p>Hi there <a data-dsq-mention="weaverryan:disqus" href="https://disqus.com/by/weaverryan/" rel="nofollow noopener">weaverryan</a>  I think this is already bundle in latest Symfony 2.8 and 3.0 I am right? Also I would like to know if this component could help me to achieve what I am trying to do. Can you take a look to this post: How to create two (chat and admin) or more secured areas with FOSUserBundle (<a href="http://disq.us/url?url=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F34756244%2Fhow-to-create-two-chat-and-admin-or-more-secured-areas-with-fosuserbundle%29%3AhBpLBFiRaaHAqR7mVMxiGUhuB-A&amp;cuid=1175718" rel="nofollow noopener">http://stackoverflow.com/quest...</a> in SO and tell me if this can be achieved with Guard?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2429278879" id="dsq-comment-2429278879">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2429278879">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-12-28</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2429278879" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2429278879" class="dsq-comment-text">
	                                <p>Boom! I love the feedback - thanks for sharing Daniel :)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2428251322" id="dsq-comment-2428251322">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_XvTOyGsPIs/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/12512/3183/avatar92.jpg?1455500375">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2428251322">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-12-27</span>
	                            <span class="dsq-commenter-name">Daniel</span>
	                        </div>

	                        <div id="dsq-comment-message-2428251322" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2428251322" class="dsq-comment-text">
	                                <p>Thanks Ryan! Just use it for an API and it works like a charm!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2416607372" id="dsq-comment-2416607372">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/jovanperovi/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/18817/1109/avatar92.jpg?1470784380">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2416607372">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-12-18</span>
	                            <span class="dsq-commenter-name">Jovan Perovi</span>
	                        </div>

	                        <div id="dsq-comment-message-2416607372" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2416607372" class="dsq-comment-text">
	                                <p>Very nice tutorial! Clean cut :)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2366827212" id="dsq-comment-2366827212">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/leo__li/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/5562/5330/avatar92.jpg?1481145468">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2366827212">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-11-18</span>
	                            <span class="dsq-commenter-name">Lo Li</span>
	                        </div>

	                        <div id="dsq-comment-message-2366827212" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2366827212" class="dsq-comment-text">
	                                <p>Good introduction, that's exactly what I want to use for my project! Thank you!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	        </ul>
	    </div>
            </div>

    <script type="text/javascript">
    var disqus_shortname = 'knpuniversity';
    var disqus_container_id = 'disqus_thread';var disqus_developer = 1;var disqus_identifier = 'course_video_guard-authentication';var disqus_url = 'https://knpuniversity.com/screencast/new-in-symfony3/guard-authentication';var disqus_config = function () {};

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

                                            </div>
                    <div class="pull-left-xs pull-right-md">
                                        <a class="btn btn-success"
           href="micro-kernel#play">
            Next Chapter <i class="fa fa-caret-right"></i>
        </a>
    
                    </div>
                    <div class="pull-left addthis-module">
                        
    <div class="addthis_toolbox addthis_default_style js-analytics-addthis-wrapper addthis_32x32_style" addthis:url="http://knpuniversity.com/screencast/new-in-symfony3/guard-authentication" addthis:title="The new Awesome of Symfony 3.0">
        <a class="addthis_button_preferred_1"></a>
        <a class="addthis_button_preferred_2"></a>
        <a class="addthis_button_preferred_3"></a>
        <a class="addthis_button_preferred_4"></a>
        <a class="addthis_button_compact"></a>
        <a class="addthis_counter addthis_bubble_style"></a>
    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<footer class="footer footer-styling">
    <div class="container">
        <div class="row">
                        <div class="col-xs-7 col-sm-4">
                <div class="row">
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../courses/all">All Courses</a></li>
                                                            <li><a class="knp-color-black" href="../../pricing.1">Pricing</a></li>
                                                        <li><a class="knp-color-black" href="../../faq">FAQ</a></li>
                            <li><a class="knp-color-black" href="../../training">Training</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../about">About</a></li>
                            <li><a class="knp-color-black" href="../../blog">Blog</a></li>
                            <li><a class="knp-color-black" href="../../contact">Contact Us</a></li>
                            <li>
                                <a class="knp-color-black" href="../../terms">Terms</a>
                                <span class="knp-color-black">&amp;</span>
                                <a class="knp-color-black" href="../../privacy">Privacy</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="hidden-xs col-sm-4">
                <p class="disclaimer">Symfony is a registered trademark of Fabien Potencier in the United States and/or other countries.
                This product is not endorsed or sponsored by Fabien Potencier.
                </p>
            </div>
            <div class="col-xs-5 col-sm-4">
                <div class="social-icons">
                    <a class="btn btn-social-icon btn-twitter" href="https://twitter.com/KnpUniversity">
                        <i class="fa fa-twitter"></i>
                    </a>
                    <a class="btn btn-social-icon btn-facebook" href="https://www.facebook.com/KnpLabs/">
                        <i class="fa fa-facebook"></i>
                    </a>
                    <a class="btn btn-social-icon btn-github" href="https://github.com/knpuniversity">
                        <i class="fa fa-github"></i>
                    </a>
                </div>
            </div>
                    </div>
    </div>
</footer>

<!-- JS -->
            <script>
        Core.analyticsVideoStatsUrl = '/api/analytics/video/duration';
    </script>

            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-7062980-20']);
        _gaq.push(['_trackPageview']);
    </script>
    <script>
    
    </script>
    
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
    
                <script type="text/javascript">
      (function() {
        var uv = document.createElement('script'); uv.type = 'text/javascript'; uv.async = true;
        uv.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'widget.uservoice.com/pOay2WLVabhXiEffbarO6Q.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(uv, s);
      })();

      UserVoice = window.UserVoice || [];
      UserVoice.push(['showTab', 'classic_widget', {
          tab_position: 'bottom-right',
          tab_label: 'Ideas or Feedback?',
          tab_color: '#005E8E'
      }]);
    </script>
        
            
        <script type="text/javascript">
    var _sf_async_config={uid:54262,domain:"knpuniversity.com",useCanonical:true};
    (function(){
      function loadChartbeat() {
        window._sf_endpt=(new Date()).getTime();
        var e = document.createElement('script');
        e.setAttribute('language', 'javascript');
        e.setAttribute('type', 'text/javascript');
        e.setAttribute('src', '//static.chartbeat.com/js/chartbeat.js');
        document.body.appendChild(e);
      }
      var oldonload = window.onload;
      window.onload = (typeof window.onload != 'function') ?
         loadChartbeat : function() { oldonload(); loadChartbeat(); };
    })();
    </script>
    
            <script>
            (function(){
                var t,i,e,n=window,o=document,a=arguments,s="script",r=["config","track","identify","visit","push","call"],c=function(){var t,i=this;for(i._e=[],t=0;r.length>t;t++)(function(t){i[t]=function(){return i._e.push([t].concat(Array.prototype.slice.call(arguments,0))),i}})(r[t])};for(n._w=n._w||{},t=0;a.length>t;t++)n._w[a[t]]=n[a[t]]=n[a[t]]||new c;i=o.createElement(s),i.async=1,i.src="//static.woopra.com/js/w.js",e=o.getElementsByTagName(s)[0],e.parentNode.insertBefore(i,e)
            })("woopra");

            woopra.config({
                domain: 'knpuniversity.com',
                download_tracking: true,
                outgoing_tracking: true
            });

                            woopra.identify({
                    userType: 'anonymous',
                    hasSubscription: 'no'
                });
                    </script>

        <script>
            woopra.track(
            'course_view_chapter',
            {"course":"new-in-symfony3","courseIsOwned":false,"chapter":"Guard: Joyful Authentication","chapterNumber":2,"chapterIsFree":false}
        );
    </script>

        <script>
            woopra.track();
        </script>
     
        <script type="text/javascript">
    var _qevents = _qevents || [];

    (function() {
    var elem = document.createElement('script');
    elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";
    elem.async = true;
    elem.type = "text/javascript";
    var scpt = document.getElementsByTagName('script')[0];
    scpt.parentNode.insertBefore(elem, scpt);
    })();

    _qevents.push({
    qacct:"p-8-SEHS37bhSQ0"
    });
    </script>

    <noscript>
    <div style="display:none;">
    <img src="http://pixel.quantserve.com/pixel/p-8-SEHS37bhSQ0.gif" border="0" height="1" width="1" alt="Quantcast"/>
    </div>
    </noscript>
    


    <script type="text/javascript" src="../../assets/vendor/jquery-sticky/jquery.sticky.js"></script>
    <script type="text/javascript" src="../../assets/vendor/zeroclipboard/dist/ZeroClipboard.min.js"></script>
    <script type="text/javascript" src="../../js/CodeBlocks.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/underscore.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/doctools.js"></script>

    <script>
        Core.courseTitle = 'The new Awesome of Symfony 3.0';
        Core.courseId = 72
        Core.courseIsOwned = false;
        Core.courseSlug = 'new-in-symfony3';
                    Core.chapterTitle = 'Guard: Joyful Authentication';
            Core.chapterNumber = 2;
            Core.chapterIsFree = false;
            Core.chapterSlug = 'guard-authentication';
        
                var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '1.0.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
        };

        jQuery(document).ready(function() {
            // Stick left sidebar menu
            $('.js-sticker').sticky();

            var $scriptWrapper = $('.js-script-content-wrapper');
            var codeBlocks = new Core.CodeBlocks($scriptWrapper);

            var expandList = $('.js-expand-list');

            expandList.on('click', function(){
                var target = $(this).data('target');
                var $expandArea = $('#' + target);
                $expandArea.toggleClass('expanded');

                // http://stackoverflow.com/questions/2868582/click-outside-menu-to-close-in-jquery
                $(document).one('click', function closeExpandList (e){
                    if($expandArea.has(e.target).length === 0){
                        $expandArea.removeClass('expanded');
                    } else {
                        $(document).one('click', closeExpandList);
                    }
                });
            });
        });
    </script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>



    <script type="text/javascript">
    var addthis_share = {
        templates: {
            twitter: '{{title}} - {{url}} | via @KnpUniversity'
        }
    }
</script>
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=weaverryan"></script>

</body>
</html>
