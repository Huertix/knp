<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
            <script src="https://cdn.optimizely.com/js/421270022.js"></script>
    
                    <script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>How to Authenticate via an API Token > KnpUGuard: Symfony Authentication with a Smile | KnpUniversity</title>

                    <link href="../../builds/main-db6835bf19d99bcc09032789f3bd39e4.css" rel="stylesheet">

        <link href='https://fonts.googleapis.com/css?family=Rokkitt' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Cedarville+Cursive' rel='stylesheet' type='text/css'>
    

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/tomorrow-night.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/tomorrow-night.min.css">


        <link rel="stylesheet" href="../../builds/code_block_styles-2d783e385d9dbb1ef88d9053d1b8d675.css">



    <link href="../../builds/video-6b5fa6dfb768239b226d39d08bd4867e.css" rel="stylesheet">

                        <script src="../../bundles/fosjsrouting/js/router.js"></script>

        <script src="../../builds/main-1dfa89b76a105f9c2d98.js"></script>
        <script src="../../js/routing?callback=fos.Router.setData"></script>
            

    <script>
        // video settings
        window.video = {
            isCourseChapterPaid: true,
            courseChapterId: 5299
        };

                window.video.nextDetails = {
            'type': 'video',
            'title': 'Up Next: Social\x20Login\x20with\x20Facebook <i class="fa fa-play"></i>',
            'url': '/screencast/guard/social-login#play'
        };
            </script>

    <script src="../../builds/video-1dfa89b76a105f9c2d98.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            var hashValue = window.location.hash.substr(1);
            if (hashValue.substr(0, 7) == 'comment') {
                // this is a #comment link - open up the comment tab!
                $('.nav-tabs a[href="#tab-comment"]').click();
            }
        });
    </script>

    <link rel="alternate" type="application/rss+xml" title="Blog feed with technical articles around PHP and screencast and tutorial updates from KnpUniversity.com" href="http://feeds.feedburner.com/knpuniversity" />

    <meta name="description" content="Symfony&#039;s authentication is definitely powerful, but if you
need to do something complex, you might pull your hair out.

Introducing KnpUGuard authentication, which puts all the complexities of any
authentication scheme right at your finger-tips. The code you right will be
easy to understand and customizing things to any whim will be simple:

* Authentication via an API token
* &quot;Social login&quot; / OAuth authentication
* Creating a traditional login form
* Customizing success/failure behavior
* Customizing error messages
* Loading users in complex ways
* ... probably anything else

If all goes well, Guard will become a core part of Symfony. If you like it, let
people know it worked for you at [symfony/symfony#14673](https://github.com/symfony/symfony/pull/14673).
And if it doesn&#039;t cover a use-case, [open an issue](https://github.com/knpuniversity/KnpUGuard)
and let me know!
">

    <meta property="og:site_name" content="KnpUniversity - PHP and Symfony Video Tutorial Screencasts">
    <meta name="twitter:site" content="@KnpUniversity"><link rel="shortcut icon" href="../../assets/images/favicon.ico">
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->    <meta property="og:title" content="How to Authenticate via an API Token">
<meta property="og:description" content="Symfony&amp;#039;s authentication is definitely powerful, but if you
need to do something complex, you might pull your hair out.

Introducing KnpUGuard authentication, which puts all the complexities of any
authentication scheme right at your finger-tips">
<meta property="og:url" content="http://knpuniversity.com/screencast/guard/api-token">
    <meta property="og:image" content="http://knpuniversity.com/imagine/course_video_poster_large/uploads/screencast/guard:a326b83b22fcc1c6da3b2fdda75ead60b37c0c4f/guard-auth.png">

<meta name="twitter:card" content="summary">


                            
    </head>
<body data-user-id="" >
<nav class="navbar navbar-inverse nav-margin navbar-learning-layout">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle toggle-button collapsed" data-toggle="collapse" data-target="#js-navbar" aria-expanded="false" aria-controls="js-navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../logout" class="navbar-brand">
                <span class="knp-color-blue">Knp</span>
                <span class="knp-color-white">University</span>
            </a>
        </div>
        <form class="navbar-form navbar-left navbar-form-border" role="search" method="GET" action="http://knpuniversity.com/search">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search Tutorials" value="" name="q">

                <div class="input-group-btn">
                    <button class="btn btn-default" type="submit">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </div>
        </form>
        <div id="js-navbar" class="collapse-fix collapse navbar-right navbar-collapse">
            

<ul class="nav navbar-nav nav-narrowerOnSmall">
            <li><a href="../../checkout/subscription/team_yearly/5" title="Cart"><i class="fa fa-shopping-cart"></i></a></li>
        <li class="dropdown"><a href="api-token#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <i class="fa fa-angle-down"></i></a>
        <ul class="dropdown-menu">
          <li><a href="../../tracks.1">Tracks</a></li>
          <li><a href="../../courses/all">All Courses</a></li>
        </ul>
    </li>
            <li><a href="../../pricing.1">Pricing</a></li>
        <li><a href="../../training">Training</a></li>
                <li class="visible-xs"><a href="../../logout">My Profile</a></li>
        <li class="visible-xs"><a href="../../logout">Sign Out</a></li>

            <li><a href="../../login.1">Log In</a></li>
        <li class="btn btn-sm btn-warning signup-btn"><a class="signup" href="../../signup/index.html">Sign Up</a></li>
    </ul>

        </div>
    </div>
</nav>


    




<div class="table-contents-container">
  <div class="container expandList" id="js-chapter-list">
      <button class="table-contents-container-button js-expand-list" data-target="js-chapter-list" title="Chapter List">
          <i class="fa fa-bars"></i>
                        3.
                            How to Authenticate via an API T...
                </button>
      <div class="expandList-body">
          <div class="expandList-bodyInner">
              <h3 class="expandList-header">
                  <a class="course-title-expand" href="../guard.1">KnpUGuard: Symfony Authentication with a Smile</a>
              </h3>

                                <div class="watched-tut-progress-container watched-tut-progress-container-overview">
        <div class="watched-tut-progress-overview" style="width: 0%; margin-right: 100%;" title="0% complete"><span class="profile-progress-title">0%</span></div>
    </div>


              
              <div class="expand-chapter-list">
                      
    
    <!-- Table of contents -->
    <div class="chapter-list">
        <ul class="list-unstyled">
            
                
                                <li class="title chapter-list-item ">
            <a href="install" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                1.
                        Installation
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="login-form" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                2.
                        How to Create a Login Form
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item chapter-list-item-active">
            <a href="api-token" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                3.
                        How to Authenticate via an API Token
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="api-token#" class="js-no-follow-link">
                <div class="row">
                    <div class="col-xs-9">
                                                4.
                        Social Login with Facebook
                                                    <small><em>(coming soon)</em></small>
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="login-form-customize-user" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                5.
                        How to Login with a username *or* email (or crazier)
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="error-messages" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                6.
                        Customizing Authentication Failure Messages
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="failure-handling" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                7.
                        Customizing Failure Handling
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="success-handling" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                8.
                        Customizing Success Handling
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="api-token#" class="js-no-follow-link">
                <div class="row">
                    <div class="col-xs-9">
                                                9.
                        Login Form: Adding a CSRF Token
                                                    <small><em>(coming soon)</em></small>
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="api-token#" class="js-no-follow-link">
                <div class="row">
                    <div class="col-xs-9">
                                                10.
                        How can I use Multiple Authenticators?
                                                    <small><em>(coming soon)</em></small>
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="api-token#" class="js-no-follow-link">
                <div class="row">
                    <div class="col-xs-9">
                                                11.
                        How can I use this in Silex?
                                                    <small><em>(coming soon)</em></small>
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="api-token#" class="js-no-follow-link">
                <div class="row">
                    <div class="col-xs-9">
                                                12.
                        FOSUserBundle
                                                    <small><em>(coming soon)</em></small>
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="api-token#" class="js-no-follow-link">
                <div class="row">
                    <div class="col-xs-9">
                                                13.
                        How can I Manually Authenticate a User?
                                                    <small><em>(coming soon)</em></small>
                                            </div>

                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


                    </ul>
    </div>

    
              </div>
          </div>
      </div>
  </div>
  <div>
                <div class="dropdown download-buy-buttons">
              <button class="btn btn-success dropdown-toggle" type="button" id="downloadDropdown" data-toggle="dropdown" aria-expanded="true">
                  <span><i class="fa fa-download"></i></span>
                  <span class="hidden-xs">Download</span>
                  <span class="caret"></span>
              </button>
              <ul class="list-unstyled dropdown-menu pull-right" role="menu" aria-labelledby="downloadDropdown">
                  
                  <li><a href="../get/guard/code/a326b83b22fcc1c6da3b2fdda75ead60b37c0c4f" class="js-analytics-download" data-download-type="code"><i class="fa fa-code"></i> Course Code</a></li>

                                        <li><a href="../get/guard/script/a326b83b22fcc1c6da3b2fdda75ead60b37c0c4f" class="js-analytics-download" data-download-type="script"><i class="fa fa-book"></i> Course Script</a></li>              </ul>
          </div>
              </div>
</div>


        <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-9 col-lg-10">
                <h1 class="account-header account-header-low-margin-top">How to Authenticate via an API Token</h1>
                
                                    <p class="hidden-xs">
                        Course:
                        <a class="knp-color-black" href="../guard.1"><em>KnpUGuard: Symfony Authentication with a Smile Tutorial</em></a>                    </p>
                            </div>
        </div>

         
        <div class="row">
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <div class="pull-right">
                                    <a class="btn btn-success"
           href="social-login#play">
            Next Chapter <i class="fa fa-caret-right"></i>
        </a>
    
                </div>

                <ul class="nav nav-tabs" role="tablist">
                    <li class="active"><a data-toggle="tab" href="api-token#tab-script">Script</a></li>
                    <li><a data-toggle="tab" href="api-token#tab-comment">
                        <i class="fa fa-comment-o"></i>
                                                    
                                                                                                (25+)
                                                                                        Conversation
                                            </a></li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="tab-script">
                        <div class="js-script-content-wrapper top-margin-script markdown-content">
                                                                                        <a href="https://github.com/knpuniversity/guard-tutorial/edit/master/knpu/api-token.md" target="_blank" class="btn btn-default btn-circle pull-right js-tooltip" title="Edit on GitHub"><span class="fa fa-pencil"></span></a>
                                                                    <p>Suppose you want to have an API where users authenticate by sending an <code>X-TOKEN</code>
header. With Guard, this is one of the <em>easiest</em> things you can setup.</p>
<p>For this example, we have a <code>User</code> entity that as an <code>$apiToken</code> property that's
auto-generated for every user when they register:</p>
<p><div class="code-block-wrapper" data-code-block-guid="b59c9fbd98">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-135" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            135 lines <span class="meta-divider"></span> <span title="src/AppBundle/Entity/User.php">src/AppBundle/Entity/User.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-19" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 19
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserInterface</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="22-48" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 22 - 48
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="49"></td>
            <td class="blob-code">    <span class="hljs-comment">/**</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="50"></td>
            <td class="blob-code">     * <span class="hljs-doctag">@ORM</span>\Column(type="string", unique=true)</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="51"></td>
            <td class="blob-code">     */</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="52"></td>
            <td class="blob-code">    <span class="hljs-keyword">private</span> $apiToken;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="53-133" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 53 - 133
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="134"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>But your setup can look however you want: an independent <code>ApiToken</code> entity that relates
to your <code>User</code>, no <code>User</code> entity at all, or api tokens that are validated in some
other way entirely.</p>
<h2 id="installing-guard">Installing Guard <a class="headerlink" href="api-token#installing-guard" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Read the short <a href="install">Installation</a> chapter to make sure you've got the
bundle installed and enabled.</p>
<h2 id="creating-an-authenticator">Creating an Authenticator <a class="headerlink" href="api-token#creating-an-authenticator" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>In Guard, the whole authentication process - reading the <code>X-TOKEN</code> header value,
validating it, returning an error response, etc - is handled in a single class called
an "Authenticator". Your authenticator can be as crazy as you want, as long as it
implements <a href="https://github.com/knpuniversity/KnpUGuard/blob/master/src/GuardAuthenticatorInterface.php">KnpU\Guard\GuardAuthenticatorInterface</a>.</p>
<p>Most of the time, you can extend a convenience class called <code>AbstractGuardAuthenticator</code>.
Create a new <code>ApiTokenAuthenticator</code> class, make it extend this class, and add all
the necessary methods:</p>
<p><div class="code-block-wrapper" data-code-block-guid="30cdaf1984">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-49" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            49 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/ApiTokenAuthenticator.php">src/AppBundle/Security/ApiTokenAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-2" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 2
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="3"></td>
            <td class="blob-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">AppBundle</span>\<span class="hljs-title">Security</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="4"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="5"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">KnpU</span>\<span class="hljs-title">Guard</span>\<span class="hljs-title">AbstractGuardAuthenticator</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="6"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Response</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Authentication</span>\<span class="hljs-title">Token</span>\<span class="hljs-title">TokenInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">AuthenticationException</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="10"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="11"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserProviderInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiTokenAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="14"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="15"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCredentials</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code">        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement getCredentials() method.</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span><span class="hljs-params">($credentials, UserProviderInterface $userProvider)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement getUser() method.</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkCredentials</span><span class="hljs-params">($credentials, UserInterface $user)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="27"></td>
            <td class="blob-code">        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement checkCredentials() method.</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="28"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="29"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="30"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(Request $request, AuthenticationException $exception)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="31"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="32"></td>
            <td class="blob-code">        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement onAuthenticationFailure() method.</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="33"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="34"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="35"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(Request $request, TokenInterface $token, $providerKey)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="36"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="37"></td>
            <td class="blob-code">        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement onAuthenticationSuccess() method.</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="38"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="39"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="40"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">supportsRememberMe</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="41"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="42"></td>
            <td class="blob-code">        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement supportsRememberMe() method.</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="43"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="44"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="45"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span><span class="hljs-params">(Request $request, AuthenticationException $authException = null)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="46"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="47"></td>
            <td class="blob-code">        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement start() method.</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="48"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="49"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Your mission: fill in each method. We'll get to that in a second.</p>
<p>But to fill on those methods, we'll need to query the database. Let's pass the Doctrine
<code>EntityManager</code> into our authenticator:</p>
<p><div class="code-block-wrapper" data-code-block-guid="928d547573">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-78" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            78 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/ApiTokenAuthenticator.php">src/AppBundle/Security/ApiTokenAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-4" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 4
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="5"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ORM</span>\<span class="hljs-title">EntityManager</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="6-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 6 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiTokenAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">    <span class="hljs-keyword">private</span> $em;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(EntityManager $em)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">        <span class="hljs-keyword">$this</span>-&gt;em = $em;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="24-76" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 24 - 76
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<h2 id="registering-your-authenticator">Registering your Authenticator <a class="headerlink" href="api-token#registering-your-authenticator" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Before filling in the methods, let's tell Symfony about our fancy new authenticator.
First, register it as a service:</p>
<p><div class="code-block-wrapper" data-code-block-guid="4ea155b7ce">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-14" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            14 lines <span class="meta-divider"></span> <span title="app/config/services.yml">app/config/services.yml</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-5" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 5
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="6"></td>
            <td class="blob-code"><span class="hljs-attr">services:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="7-10" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 7 - 10
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="11"></td>
            <td class="blob-code">    app.api_token_authenticator:</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code"><span class="hljs-attr">        class:</span> AppBundle\Security\ApiTokenAuthenticator</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code"><span class="hljs-attr">        arguments:</span> [<span class="hljs-string">"@doctrine.orm.entity_manager"</span>]</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Next, update your <code>security.yml</code> file to use the new service:</p>
<p><div class="code-block-wrapper" data-code-block-guid="4bf4efdda0">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-27" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            27 lines <span class="meta-divider"></span> <span title="app/config/security.yml">app/config/security.yml</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-18" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 18
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code"><span class="hljs-attr">        main:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="20-20" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... line 20
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code"><span class="hljs-attr">            knpu_guard:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code"><span class="hljs-attr">                authenticators:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code"><span class="hljs-bullet">                    -</span> app.form_login_authenticator</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code"><span class="hljs-bullet">                    -</span> app.api_token_authenticator</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">                <span class="hljs-comment"># by default, use the start() function from FormLoginAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code"><span class="hljs-attr">                entry_point:</span> app.form_login_authenticator</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Your firewall (called <code>main</code> here) can look however you want, as long as it has a
<code>knpu_guard</code> section under it with an <code>authenticators</code> key that includes the service
name that you setup a second ago (<code>app.api_token_authenticator</code> in my example).</p>
<div class="admonition tip"><p class="admonition-title"><span class="fa fa-lightbulb-o"></span> Tip</p><p>The other authenticator - <code>app.form_login_authenticator</code> - is for my login form.
If you don't need to <em>also</em> allow users to login via a form, then you can remove
this. The <code>entry_point</code> option is only needed if you have multiple authenticators.
See <a href="multiple-authenticators">How can I use Multiple Authenticators?</a>.</p>
</div><p><a name="security-providers"></a></p>
<h2 id="filling-in-the-authenticator-methods">Filling in the Authenticator Methods <a class="headerlink" href="api-token#filling-in-the-authenticator-methods" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Your authenticator is now being used by Symfony. So let's fill in each method:</p>
<h3 id="getcredentials">getCredentials() <a class="headerlink" href="api-token#getcredentials" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p><div class="code-block-wrapper" data-code-block-guid="53dcfe88ec">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-78" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            78 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/ApiTokenAuthenticator.php">src/AppBundle/Security/ApiTokenAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-7" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 7
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="9-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 9 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiTokenAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="18-24" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 18 - 24
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCredentials</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="27"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> $request-&gt;headers-&gt;get(<span class="hljs-string">'X-TOKEN'</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="28"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="29-76" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 29 - 76
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>The <code>getCredentials()</code> method is called on <strong>every single request</strong> and its job is
to fetch the API token and return it.</p>
<p>Well, that's pretty simple. From here, there are 3 possibilities:</p>
<table class="table table-striped">
<thead>
<tr><th>&#35; </th><th>Conditions                                  </th><th>Result                     </th><th>Next Step</th></tr>
</thead>
<tbody>
<tr><td>A)    </td><td>Return non-null value                       </td><td>Authentication continues   </td><td><a href="api-token#getUser">getUser()</a></td></tr>
<tr><td>B)    </td><td>Return null + endpoint requires auth        </td><td>Auth skipped, 401 response </td><td><a href="api-token#start">start()</a></td></tr>
<tr><td>C)    </td><td>Return null+ endpoint does not require auth </td><td>Auth skipped, user is anon </td><td>nothing</td></tr>
</tbody>
</table>
<p><strong>A)</strong> The <code>X-TOKEN</code> header exists, so this returns a non-null value. In this case,
<a href="api-token#getUser">getUser()</a> is called next.</p>
<p><strong>B)</strong> The <code>X-TOKEN</code> header is missing, so this returns <code>null</code>. But, your application
<em>does</em> require authentication (e.g. via <code>access_control</code> or an <code>isGranted()</code> call).
In this case, see <a href="api-token#start">start()</a>.</p>
<p><strong>C)</strong> The <code>X-TOKEN</code> header is missing, so this returns <code>null</code>. But the user is accessing
an endpoint that does <em>not</em> require authentication. In this case, the request continues
anonymously - no other methods are called on the authenticator.</p>
<p><a name="getUser"></a></p>
<h3 id="getuser">getUser() <a class="headerlink" href="api-token#getuser" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>If <code>getCredentials()</code> returns a non-null value, then <code>getUser()</code> is called next.
Its job is simple: return a the user (an object implementing <code>UserInterface</code>):</p>
<p><div class="code-block-wrapper" data-code-block-guid="47f86a1c25">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-78" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            78 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/ApiTokenAuthenticator.php">src/AppBundle/Security/ApiTokenAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-10" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 10
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="11"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">AuthenticationCredentialsNotFoundException</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="12-13" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 12 - 13
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="14"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserProviderInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="15-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... line 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiTokenAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="18-29" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 18 - 29
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="30"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span><span class="hljs-params">($credentials, UserProviderInterface $userProvider)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="31"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="32"></td>
            <td class="blob-code">        $user = <span class="hljs-keyword">$this</span>-&gt;em-&gt;getRepository(<span class="hljs-string">'AppBundle:User'</span>)</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="33"></td>
            <td class="blob-code">            -&gt;findOneBy(<span class="hljs-keyword">array</span>(<span class="hljs-string">'apiToken'</span> =&gt; $credentials));</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="34"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="35"></td>
            <td class="blob-code">        <span class="hljs-comment">// we could just return null, but this allows us to control the message a bit more</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="36"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> (!$user) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="37"></td>
            <td class="blob-code">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AuthenticationCredentialsNotFoundException();</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="38"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="39"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="40"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> $user;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="41"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="42-76" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 42 - 76
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>The <code>$credentials</code> argument is whatever you returned from <code>getCredentials()</code>, and
the <code>$userProvider</code> is whatever you've configured in security.yml under the
<a href="api-token#security-providers">providers</a> key.</p>
<p>You can choose to use your provider, or you can do something else entirely to load
the user. In this case, we're doing a simple query on the <code>User</code> entity to see which
User (if any) has this <code>apiToken</code> value.</p>
<p>From here, there are 2 possibilities:</p>
<table class="table table-striped">
<thead>
<tr><th>&#35; </th><th>Conditions                                     </th><th>Result                    </th><th>Next Step</th></tr>
</thead>
<tbody>
<tr><td>A)    </td><td>Return a User                                  </td><td>Authentication continues  </td><td><a href="api-token#checkCredentials">checkCredentials()</a></td></tr>
<tr><td>B)    </td><td>Return null or throw AuthenticationException   </td><td>Authentication fails      </td><td><a href="api-token#onAuthenticationFailure">onAuthenticationFailure()</a></td></tr>
</tbody>
</table>
<p>A) If you successfully return a <code>User</code> object, then, <a href="api-token#checkCredentials">checkCredentials()</a>
is called next.</p>
<p>B) If you return <code>null</code> or throw any <code>Symfony\Component\Security\Core\Exception\AuthenticationException</code>,
authentication will fail and <a href="api-token#onAuthenticationFailure">onAuthenticationFailure()</a>
is called next.</p>
<p><a name="checkCredentials"></a></p>
<h3 id="checkcredentials">checkCredentials() <a class="headerlink" href="api-token#checkcredentials" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>If you return a user from <code>getUser()</code>, then <code>checkCredentials()</code> is called next.
Here, you can do any additional checks for the validity of the token - or anything
else you can think of. In this example, we're doing nothing:</p>
<p><div class="code-block-wrapper" data-code-block-guid="9f38945da4">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-80" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            80 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/ApiTokenAuthenticator.php">src/AppBundle/Security/ApiTokenAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-12" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 12
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">User</span>\<span class="hljs-title">UserInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="14-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 14 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiTokenAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="18-42" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 18 - 42
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="43"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkCredentials</span><span class="hljs-params">($credentials, UserInterface $user)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="44"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="45"></td>
            <td class="blob-code">        <span class="hljs-comment">// the fact that they had a valid token that *was* attached to a user</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="46"></td>
            <td class="blob-code">        <span class="hljs-comment">// means that their credentials are correct. So, there's nothing</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="47"></td>
            <td class="blob-code">        <span class="hljs-comment">// additional (like a password) to check here.</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="48"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="49"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="50-78" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 50 - 78
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="79"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Like before, <code>$credentials</code> is whatever you returned from <code>getCredentials()</code>. And
now, the <code>$user</code> argument is what you just returned from <code>getUser()</code>.</p>
<p>From here, there are 2 possibilities:</p>
<table class="table table-striped">
<thead>
<tr><th>&#35; </th><th>Conditions                                                 </th><th>Result                    </th><th>Next Step</th></tr>
</thead>
<tbody>
<tr><td>A)    </td><td>do anything <em>except</em> throwing an <code>AuthenticationException</code> </td><td>Authentication successful </td><td><a href="api-token#onAuthenticationSuccess">onAuthenticationSuccess()</a></td></tr>
<tr><td>B)    </td><td>Throw any type of <code>AuthenticationException</code>                </td><td>Authentication fails      </td><td><a href="api-token#onAuthenticationFailure">onAuthenticationFailure()</a></td></tr>
</tbody>
</table>
<p>A) If you <em>don't</em> throw an exception, congrats! You're authenticated! In this case,
<a href="api-token#onAuthenticationSuccess">onAuthenticationSuccess()</a> is called next.</p>
<p>B) If you perform extra checks and throw any <code>Symfony\Component\Security\Core\Exception\AuthenticationException</code>,
authentication will fail and <a href="api-token#onAuthenticationFailure">onAuthenticationFailure()</a>
is called next.</p>
<p><a name="onAuthenticationSuccess"></a></p>
<h3 id="onauthenticationsuccess">onAuthenticationSuccess <a class="headerlink" href="api-token#onauthenticationsuccess" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>Your user is authenticated! Amazing! At this point, in an API, you usually want to
simply let the request continue like normal:</p>
<p><div class="code-block-wrapper" data-code-block-guid="1f5d61727e">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-78" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            78 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/ApiTokenAuthenticator.php">src/AppBundle/Security/ApiTokenAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-7" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 7
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="9-9" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... line 9
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="10"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Authentication</span>\<span class="hljs-title">Token</span>\<span class="hljs-title">TokenInterface</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="11-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 11 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiTokenAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="18-57" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 18 - 57
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="58"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(Request $request, TokenInterface $token, $providerKey)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="59"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="60"></td>
            <td class="blob-code">        <span class="hljs-comment">// do nothing - let the request just continue!</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="61"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="62"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="63-76" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 63 - 76
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>If you return <code>null</code> from this method: the request continues to process through Symfony
like normal (only now, the request is authenticated).</p>
<p>Alternatively, you could return a <code>Response</code> object here. If you did, that <code>Response</code>
would be returned to the client directly, without executing the controller for this
request. For an API, that's probably not what you want.</p>
<p><a name="onAuthenticationFailure"></a></p>
<h3 id="onauthenticationfailure">onAuthenticationFailure <a class="headerlink" href="api-token#onauthenticationfailure" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>If you return <code>null</code> from <code>getUser()</code> or throw any <code>AuthenticationException</code> from
<code>getUser()</code> or <code>checkCredentials()</code>, then you'll end up here. Your job is to create
a <code>Response</code> that should be sent back to the user to tell them what went wrong:</p>
<p><div class="code-block-wrapper" data-code-block-guid="e8b49612cd">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-78" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            78 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/ApiTokenAuthenticator.php">src/AppBundle/Security/ApiTokenAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-6" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 6
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">JsonResponse</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="9-11" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 9 - 11
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">AuthenticationException</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="13-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 13 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiTokenAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="18-48" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 18 - 48
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="49"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(Request $request, AuthenticationException $exception)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="50"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="51"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JsonResponse(</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="52"></td>
            <td class="blob-code">            <span class="hljs-comment">// you could translate the message</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="53"></td>
            <td class="blob-code">            <span class="hljs-keyword">array</span>(<span class="hljs-string">'message'</span> =&gt; $exception-&gt;getMessageKey()),</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="54"></td>
            <td class="blob-code">            <span class="hljs-number">403</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="55"></td>
            <td class="blob-code">        );</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="56"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="57-76" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 57 - 76
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>In this case, we'll return a 403 Forbidden JSON response with a message about what
went wrong. The <code>$exception</code> argument is the actual <code>AuthenticationException</code> that
was thrown. It has a <code>getMessageKey()</code> method that contains a safe message about
the authentication problem.</p>
<p>This Response will be sent back to the client - the controller will never be executed
for this request.</p>
<p><a name="start"></a></p>
<h3 id="start">start() <a class="headerlink" href="api-token#start" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>This method is called if an anomymous user accesses en endpoint that requires authentication.
For our example, this would happen if the <code>X-TOKEN</code> header is empty (and so <code>getCredentials()</code>)
returns <code>null</code>. Our job here is to return a Response that instructs the user that
they need to re-send the request with authentication information (i.e. the <code>X-TOKEN</code>
header):</p>
<p><div class="code-block-wrapper" data-code-block-guid="f1899c871e">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-78" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            78 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/ApiTokenAuthenticator.php">src/AppBundle/Security/ApiTokenAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-7" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 7
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">HttpFoundation</span>\<span class="hljs-title">Request</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="9-11" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 9 - 11
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Security</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Exception</span>\<span class="hljs-title">AuthenticationException</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="13-68" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 13 - 68
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="69"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span><span class="hljs-params">(Request $request, AuthenticationException $authException = null)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="70"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="71"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JsonResponse(</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="72"></td>
            <td class="blob-code">            <span class="hljs-comment">// you could translate the message</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="73"></td>
            <td class="blob-code">            <span class="hljs-keyword">array</span>(<span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'Authentication required'</span>),</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="74"></td>
            <td class="blob-code">            <span class="hljs-number">401</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="75"></td>
            <td class="blob-code">        );</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="76"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>In this case, we'll return a 401 Unauthorized JSON response.</p>
<h3 id="supportsrememberme">supportsRememberMe <a class="headerlink" href="api-token#supportsrememberme" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>This method is required for all authenticators. If <code>true</code>, then the authenticator
will work together with the <code>remember_me</code> functionality on your firewall, if you
have it configured. Obviously, for an API, we don't need remember me functionality:</p>
<p><div class="code-block-wrapper" data-code-block-guid="ead9d11584">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-78" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            78 lines <span class="meta-divider"></span> <span title="src/AppBundle/Security/ApiTokenAuthenticator.php">src/AppBundle/Security/ApiTokenAuthenticator.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiTokenAuthenticator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGuardAuthenticator</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="18-63" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 18 - 63
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="64"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">supportsRememberMe</span><span class="hljs-params">()</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="65"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="66"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="67"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="68-76" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 68 - 76
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="77"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<h2 id="testing-your-endpoint">Testing your Endpoint <a class="headerlink" href="api-token#testing-your-endpoint" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Yes! API token authentication is all setup. Let's test it with a simple script.</p>
<p>First, install <a href="http://guzzle.readthedocs.org/en/latest/overview.html#installation">Guzzle</a>:</p>
<pre><code class="language-bash"><div class="line">composer require guzzlehttp/guzzle:~6.0</div></code></pre>
<p>Next, create a little "play" file at the root of your project that will make a request
to our app. This assume your web server is running on <code>localhost:8000</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="6ddb4b8b1b">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-18" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            18 lines <span class="meta-divider"></span> <span title="testAuth.php">testAuth.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-2" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 2
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="3"></td>
            <td class="blob-code"><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">'/vendor/autoload.php'</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="4"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="5"></td>
            <td class="blob-code">$client = <span class="hljs-keyword">new</span> GuzzleHttp\Client();</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="6"></td>
            <td class="blob-code">$res = $client-&gt;get(<span class="hljs-string">'http://localhost:8000/secure'</span>, [</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code">    <span class="hljs-string">'allow_redirects'</span> =&gt; <span class="hljs-keyword">false</span>,</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code">    <span class="hljs-string">'http_errors'</span> =&gt; <span class="hljs-keyword">false</span>,</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code">    <span class="hljs-string">'headers'</span> =&gt; [</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="10"></td>
            <td class="blob-code">        <span class="hljs-comment">// token for anna_admin in LoadUserData fixtures</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="11"></td>
            <td class="blob-code">        <span class="hljs-string">'X-Token'</span> =&gt; <span class="hljs-string">'ABCD1234'</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code">    ]</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code">]);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="14"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="15"></td>
            <td class="blob-code"><span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">"Status Code: %s\n\n"</span>, $res-&gt;getStatusCode());</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code"><span class="hljs-keyword">echo</span> $res-&gt;getBody();</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code"><span class="hljs-keyword">echo</span> <span class="hljs-string">"\n\n"</span>;</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>In our app, the <code>anna_admin</code> user in the database has an <code>apiToken</code> of <code>ABCD1234</code>.
In other words, this <em>should</em> work. Try it out from the command line:</p>
<pre><code class="language-bash"><div class="line">php testAuth.php</div></code></pre>
<p>If you see a 200 status code with response of "It works!"... well, um... it works!
The <code>/secure</code> controller requires authentication. Now try changing the token value
(or removing it entirely) to see our error responses.</p>

    
                        </div>
                    </div>
                    <div class="tab-pane" id="tab-comment">
                        <h3>Leave a comment!</h3>
                                                        <div id="disqus_thread">
                <style type="text/css">
            #dsq-comments {padding: 10px 0 0}
            .dsq-comment {position: relative;clear: both;margin: 0 0 1.5em;}
            .dsq-avatar {left: 0;position: absolute;}
            .dsq-avatar img {border: 0 none;border-radius: 3px;height: 36px;width: 36px;}
            .dsq-comment-body {padding: 0 0 0 46px;}
            .dsq-comment-header {border: 1px solid rgba(0, 0, 0, 0.15);border-radius: 3px;font-size: 13px;line-height: 14px;margin: 0 0 1em;max-height: 36px;overflow: hidden;padding: 10px;position: relative;text-overflow: ellipsis;white-space: nowrap;}
            .dsq-comment-message {word-wrap: break-word;}
            .dsq-comment-message {line-height: 1.5em;margin: 0 0 1em;}
            .dsq-comment-text {display: inline;}
            .dsq-comment-date {float: right;font-size: 90%;margin: 0 12px 0 0;}
        </style>

	    <div id="dsq-content">
	        <ul id="dsq-comments">
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2599477149" id="dsq-comment-2599477149">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/dlegatt/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2599477149">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-31</span>
	                            <span class="dsq-commenter-name">dlegatt</span>
	                        </div>

	                        <div id="dsq-comment-message-2599477149" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2599477149" class="dsq-comment-text">
	                                <p>I was just stripping the characters completely.  I've seen functions to safely encode base64 for URLs by replacing them with - or ., but I don't have any need to ever decode the string, I just needed something unique and random to use as a key.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2598982256" id="dsq-comment-2598982256">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/jonathankeen/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/17476/5806/avatar92.jpg?1466527759">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2598982256">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-31</span>
	                            <span class="dsq-commenter-name">Jonathan Keen</span>
	                        </div>

	                        <div id="dsq-comment-message-2598982256" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2598982256" class="dsq-comment-text">
	                                <p>dlegatt,</p><p>Thanks for that tip. I'm using PHP 7 so it's working wonderfully.</p><p>Curious, are you using anything to replace the +, /, and = characters? Or just stripping them completely?</p><p>I'm creating, checking if unique, and storing the API Token during the prepersist event for Doctrine,  just in case of any collisions. Are you doing something similar?</p><p>Love this little KNP University community that we have here.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2597911377" id="dsq-comment-2597911377">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/disqus_uD5i43kNFA/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2597911377">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-31</span>
	                            <span class="dsq-commenter-name">Jose Ares</span>
	                        </div>

	                        <div id="dsq-comment-message-2597911377" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2597911377" class="dsq-comment-text">
	                                <p>Nice article. I have a basic question:</p><p>When a user register, he/she enter for example mail &amp; password, so how would the token be generated in the first place? If I'm not worng the cycle would be:</p><p>1) User registers<br>2) User log in with username &amp; password<br>3) If credentials are correct, a new token is generated (for that session only?) and saved in the DDBB<br>4) From now on, every single HTTP request will add the "X-TOKEN" header with that value to maintain the user logged in <br>5) User Logs out and the token is deleted from the DDBB</p><p>Is that correct? Also, registering the authenticator in security.yml makes it hook in every request?</p><p>Thanks very much!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2588857872" id="dsq-comment-2588857872">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/dlegatt/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2588857872">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-25</span>
	                            <span class="dsq-commenter-name">dlegatt</span>
	                        </div>

	                        <div id="dsq-comment-message-2588857872" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2588857872" class="dsq-comment-text">
	                                <p>PHP has a Cryptographically Secure Pseudo-Random Number Generator (CSPRNG) as of PHP 7.  This includes two functions, random_int and random_bytes.  Symfony also includes a compatibility library from Paragon that provides compatibility for these functions on PHP 5.</p><p>What I do to generate a token is base64_encode(random_bytes(64)).  Then, just to make sure I don't have any problems sending as a URL or header, I use str_replace to remove any +, /, or = characters that may have been generated by the base64 encoding process.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2515242556" id="dsq-comment-2515242556">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2515242556">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-02-15</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2515242556" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2515242556" class="dsq-comment-text">
	                                <p>That's a "tricky" question in a sense - technically getting a true "random" number should probably include some sort of secret "key" that *you* provide. That always helps things being random. Of course, this is probably "random enough" - but your absolute best bet (as far as I can see) is to use Anthony Ferrara's library: <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Fircmaxell%2FRandomLib%3ACWRmbGGOIt6Aau47LI8MJD-CJyU&amp;cuid=1175718" rel="nofollow noopener">https://github.com/ircmaxell/R...</a>. He's a stickler for security, so using his library is a good way to go.</p><p>And thanks for your kind words - that's really awesome - I love what I do because I get to work with people like you :).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2509981251" id="dsq-comment-2509981251">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/jonathankeen/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/17476/5806/avatar92.jpg?1466527759">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2509981251">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-02-12</span>
	                            <span class="dsq-commenter-name">Jonathan Keen</span>
	                        </div>

	                        <div id="dsq-comment-message-2509981251" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2509981251" class="dsq-comment-text">
	                                <p>Ryan, have a question for you on generating the apiToken, in the course code you're using:</p><p>        $this-&gt;apiToken = base_convert(sha1(uniqid(mt_rand(), true)), 16, 36);</p><p>Would you recommend this as a completely unique apiToken I can use to generate for my user upon creation? Sorry, not sure if my Google-fu is broken, but I can't seem to find a well thought out answer to creating an API token. Especially one that I don't have to check is unique before flushing with Doctrine (and then getting an error that the column is not unique.)</p><p>Thanks very much in advance! It's nice having access to someone as experienced as you are. That alone is worth the subscription fee. The courses are almost a bonus, although I love them and cannot believe how they have skyrocketed my knowledge. You are a fabulous teacher. </p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2509747891" id="dsq-comment-2509747891">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/devdonkey/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/18437/4487/avatar92.jpg?1473928477">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2509747891">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-02-12</span>
	                            <span class="dsq-commenter-name">DevDonkey</span>
	                        </div>

	                        <div id="dsq-comment-message-2509747891" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2509747891" class="dsq-comment-text">
	                                <p>ah awesome, many thanks Ryan.</p><p>Cheers,</p><p>Matt</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2509683589" id="dsq-comment-2509683589">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2509683589">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-02-12</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2509683589" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2509683589" class="dsq-comment-text">
	                                <p>Hey!</p><p>Ah, glad you like it! This tutorial (at this moment) is still about KnpUGuardBundle - the one in core has some slight differences. The big one is that checkCredentials() (in core) must return true. Returning anything else fails auth. We did that so that you really had to "opt-in" to "passing" the credentials check. So yes! Return true and you'll be good. And also, getUser() is called *before* checkCredentials() - so if you fail to return a User object from getUser(), checkCredentials will never be called (the order is getCredentials, getUser, checkCredentials.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2509644642" id="dsq-comment-2509644642">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/devdonkey/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/18437/4487/avatar92.jpg?1473928477">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2509644642">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-02-12</span>
	                            <span class="dsq-commenter-name">DevDonkey</span>
	                        </div>

	                        <div id="dsq-comment-message-2509644642" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2509644642" class="dsq-comment-text">
	                                <p>hi Ryan, great tutorial by the way.  I love guard, it makes life so much simpler.</p><p>Im implementing the api side of things and Ive come up against an issue.</p><p>if checkCredentials() just returns (as in your example) auth fails, but if it returns true then successful auth is then dependent upon the getUser() method, which as far as I can see is desired behaviour?</p><p>Have I got something wrong, or did you typo line 48?</p><p>many thanks.</p><p>Matt</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2253369718" id="dsq-comment-2253369718">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2253369718">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-09-14</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2253369718" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2253369718" class="dsq-comment-text">
	                                <p>Hey Reynier!</p><p>There's 2 things I can tell you :). First, a functional test is probably the best idea - one where you actually send a test HTTP request up to the server and test your authentication. Second, if you want to actually unit test your authenticator, then that should be easy: it's your class, so just test its methods like any normal class. For example, if you wanted to test that the header was being fetched off of the Request correctly in getCredentials(), just create a Request object in your test, give it a header, then call getCredentials() on your authenticator. You can then test that it returns the correct header value. You will need to use mocking for your authenticator's dependencies, but fortunately, this is all just normal testing stuff.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2250155251" id="dsq-comment-2250155251">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2250155251">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-09-12</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2250155251" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2250155251" class="dsq-comment-text">
	                                <p>Hi there <a data-dsq-mention="weaverryan:disqus" href="https://disqus.com/by/weaverryan/" rel="nofollow noopener">weaverryan</a> I am trying to write some unit/functional test for this setup and have not idea at all, could you add to the tutorial how to achieve this using phpunit or any other tool? I would like to have my API fully tested ;)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2207295798" id="dsq-comment-2207295798">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2207295798">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-21</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2207295798" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2207295798" class="dsq-comment-text">
	                                <p>Keep stateless - that turns the session off, that's what you want. I don't know what your issue is, I'm sorry - I can't help this deep into your specific project - that's what my actual day job is :).</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2207202255" id="dsq-comment-2207202255">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2207202255">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-21</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2207202255" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2207202255" class="dsq-comment-text">
	                                <p><a data-dsq-mention="weaverryan:disqus" href="https://disq.us/url?url=https%3A%2F%2Fdisqus.com%2Fby%2Fweaverryan%2F%3APBIAkzK4hlYNCZurh4fY0tD6LIg&amp;cuid=1175718" rel="nofollow noopener">weaverryan</a> please take a look to this post: <a href="http://disq.us/url?url=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F32146021%2Fwhy-i-am-getting-invalid-reptokenid-in-response%3AIsbcqnvThfcPye0Bw-c5CBEpiOY&amp;cuid=1175718" rel="nofollow noopener">http://stackoverflow.com/quest...</a> I don't know what else to do</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2207085874" id="dsq-comment-2207085874">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2207085874">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-21</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2207085874" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2207085874" class="dsq-comment-text">
	                                <p>stateless is true you told me to put that value there ;) should I change it back to false?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2207068618" id="dsq-comment-2207068618">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2207068618">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-21</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2207068618" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2207068618" class="dsq-comment-text">
	                                <p>There's certainly no caching, so the only thing that could be causing anything that looks like caching would be if the user information were stored in the session. But since you have stateless: false on your firewall, I can't think of anything with caching. I'd add debugging code into your authenticator to see what's going on.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2207059577" id="dsq-comment-2207059577">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2207059577">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-21</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2207059577" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2207059577" class="dsq-comment-text">
	                                <p>Hi there <a data-dsq-mention="weaverryan:disqus" href="https://disqus.com/by/weaverryan/" rel="nofollow noopener">weaverryan</a> is there any chance that API token get's cached? I'm running a weird issue related to the <strong>repTokenId</strong> field since when it's value is NULL API still returning a valid value - which turns into invalid one, any advise?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2180053818" id="dsq-comment-2180053818">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2180053818">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-07</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2180053818" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2180053818" class="dsq-comment-text">
	                                <p>Awesome! Thanks for trying it out! I've opened an issue about it here: <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Fknpuniversity%2FKnpUGuard%2Fissues%2F11%3AYlP5OtgeFBPPR0FzEu5-wFqLsrE&amp;cuid=1175718" rel="nofollow noopener">https://github.com/knpuniversi...</a>.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2180031375" id="dsq-comment-2180031375">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2180031375">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-07</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2180031375" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2180031375" class="dsq-comment-text">
	                                <p>Excellent, I don't know what this is but your suggestion fix the issue, if you can add to docs ;) and I didn't found you on IRC :(</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2180015008" id="dsq-comment-2180015008">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2180015008">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-07</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2180015008" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2180015008" class="dsq-comment-text">
	                                <p>Hey Reynier!</p><p>You can find me on IRC Freenode as weaverryan :). Add a "stateless: true" key under your "api_area" firewall (so, at the same level as "pattern" and "knpu_guard") and tell me if you get the same issues. I know what the problem is, and I think this will fix it. Let me know - I'll need to (at least) make some updates to the documentation for this.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2179887673" id="dsq-comment-2179887673">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2179887673">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-07</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2179887673" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2179887673" class="dsq-comment-text">
	                                <p>I'm not using any client at all, those request are being made from an iOs app. For testing purpose I use Postman at Chrome. I've found this topic at SO <a href="http://disq.us/url?url=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F6588133%2Fthere-is-no-user-provider-for-user-symfony-component-security-core-user-user%3AZtUJ85wnfR_X8A03VIVCW-5ND_o&amp;cuid=1175718" rel="nofollow noopener">http://stackoverflow.com/quest...</a> perhaps it will be helpful or doesn't at all. PS: Can we talk over chat? Hangouts? IRC? Or something else in order to get this working and after put the interesting part here or did you prefer still here chatting over question on Discuss?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2179709359" id="dsq-comment-2179709359">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2179709359">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-07</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2179709359" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2179709359" class="dsq-comment-text">
	                                <p>Hey Reynier!</p><p>Actually, this is a good question/issue - and even could relate to a bug or something that's at least not documented yet related to sessions. What client are you using to make these API requests? Is it AJAX from a browser? Or something else?</p><p>The issue appears to be that the user is being stored in the session (which we don't want/need for an API), and then it breaks after that (because of course, we're not coding in a way that expects this).</p><p>Let me know and I should be able to help - and your answer may help the library too :)</p><p>Cheers1</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2179650601" id="dsq-comment-2179650601">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2179650601">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-07</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2179650601" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2179650601" class="dsq-comment-text">
	                                <p>Hi there weaverryan I am still having a little issues here and I'm not able to fix them. Some API calls are failing and I can see this on logs:</p><p></p><pre><code><br>[2015-08-07 11:39:04] request.INFO: Matched route "api_1_get_targets_activity". {"route_parameters":{"_controller":"PDI\\PDOneRestBundle\\Controller\\TargetRestController::getTargetsActivityAction","_format":"json","_route":"api_1_get_targets_activity"},"request_uri":"app_dev.php/api/v1/targets/activity?_format=json&amp;tid=0018000000aFZ9fAAG"} []<br>[2015-08-07 11:39:04] security.DEBUG: Read existing security token from the session. {"key":"_security_api_area"} []<br>[2015-08-07 11:39:04] request.CRITICAL: Uncaught PHP Exception RuntimeException: "There is no user provider for user "PDI\PDOneBundle\Entity\Representative"." at /var/www/html/backendvendor/symfony/symfony/src/Symfony/Component/Security/Http/Firewall/ContextListener.php line 174 {"exception":"[object] (RuntimeException(code: 0): There is no user provider for user \"PDI\\PDOneBundle\\Entity\\Representative\". at /var/www/html/backend/vendor/symfony/symfony/src/Symfony/Component/Security/Http/Firewall/ContextListener.php:174)"} []<br></code></pre><p></p><p>What they means and how to fix it? Any ideas or advice?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2164111221" id="dsq-comment-2164111221">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2164111221">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2164111221" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2164111221" class="dsq-comment-text">
	                                <p>See <a href="https://disq.us/url?url=https%3A%2F%2Fknpuniversity.com%2Fscreencast%2Fguard%2Ferror-messages%3AVQfvrZp35mWes5DfmMyuAwQLT1Q&amp;cuid=1175718" rel="nofollow noopener">https://knpuniversity.com/scre...</a> for how you can cause an authentication failure and control the messages.</p><p>Are there 2 issues now?</p><p>1) If no header is sent, then throw any AuthenticationException() in getCredentials() (except, of course, for the postSessionAction URL). This will require the client to *always* pass this header.</p><p>2) If the credentials are wrong, and you won't want to control exactly which message is sent to your user, see my above link. You'll probably want to throw the same exception in getCredentials (if the header is missing) and getUser (if the token is bad). This will cause the error message to be the same in both cases.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163526286" id="dsq-comment-2163526286">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163526286">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2163526286" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163526286" class="dsq-comment-text">
	                                <p>Ok, that fixes that issue but now another comes out - perhaps not an issue but a miss understood from my side. If I not send </p><pre><code>X-PDONE-SESSION-ID</code></pre><p> request is allowed and end user can see a valid response - this is wrong and shouldn't be allowed -, ff I send an invalid </p><pre><code>X-PDONE-SESSION-ID</code></pre><p> I got </p><pre><code>{<br>    "message": "Authentication credentials could not be found."<br>}</code></pre><p>, how this could be avoid? I don't want unwanted and unauthorized people sniffing API results</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163496194" id="dsq-comment-2163496194">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163496194">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2163496194" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163496194" class="dsq-comment-text">
	                                <p>Hey Reynier!</p><p>Just remove the access_control for ^/api entirely. The authentication (in getCredentials()) is forcing authentication on all /api URLs (except for postSessionAction) by throwing the CredentialsNotFoundException. So, this access_control line is not needed, and in fact is causing our problem now :).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163437240" id="dsq-comment-2163437240">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163437240">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2163437240" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163437240" class="dsq-comment-text">
	                                <p>Yes I've seen your reply and test both ways:</p><p></p><pre><code><br>#using URL<br>if ($request-&gt;getPathInfo() == '/api/v1/sessions') {<br>    return;<br>}<br><br>#or using route<br>if ($request-&gt;attributes-&gt;get('_route') == 'api_1_post_session') {<br>    return;<br>}<br></code></pre><p></p><p>This is how the complete method look likes:</p><p></p><pre><code><br>    public function getCredentials(Request $request)<br>    {<br>	    // skip authentication for this one endpoint<br>            // first way using URL<br>	    if ($request-&gt;getPathInfo() == '/api/v1/sessions') {<br>		    return;<br>	    }<br><br>            // second way using routes<br>	    /*if ($request-&gt;attributes-&gt;get('_route') == 'api_1_post_session') {<br>		    return;<br>	    }*/<br><br>	    return $request-&gt;headers-&gt;get('X-PDONE-SESSION-ID');<br>    }<br></code></pre><p></p><p>In both cases I can't reach postSessionAction() I got an "AccessDeniedHttpException" all the time:</p><p></p><pre><code><br>{<br>  "error": {<br>    "code": 403,<br>    "message": "Forbidden",<br>    "exception": [<br>      {<br>        "message": "You do not have the necessary permissions",<br>        "class": "Symfony\\\\Component\\\\HttpKernel\\\\Exception\\\\AccessDeniedHttpException"<br>      }<br>    ]<br>  }<br>}<br></code></pre><p></p><p>This is a piece of the security.yml file:</p><p></p><pre><code><br>firewalls:<br>    #this is the secured area accessed through web browser and only authenticated reps are allowed to use it<br>    api_area:<br>        pattern:    ^/api<br>        anonymous:    ~<br>        knpu_guard:<br>            authenticators:<br>               - app.api_token_authenticator<br>    <br>    #this looks the same as I show you before<br>    admin_area:<br>        ... <br><br>access_control:<br>    - { path: ^/login, role: IS_AUTHENTICATED_FULLY }<br>    # Also tried the line below, no success<br>    # - { path: ^/api/v1/sessions, role: IS_AUTHENTICATED_FULLY }<br>    - { path: ^/api/.*, role: ROLE_REPRESENTATIVE }<br>    - { path: ^/admin/.*, role: ROLE_ADMIN }<br></code></pre><p></p><p>Any advice? What could be wrong here?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163186518" id="dsq-comment-2163186518">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163186518">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2163186518" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163186518" class="dsq-comment-text">
	                                <p>You've probably seen my reply :). This has nothing to do with any authorization stuff. Instead, we simply need to allow this request to get through the firewall/authenticator anonymously. And yes, you *may* be able to use a route instead of a URL in getCredentials() - it would be if ($request-&gt;attributes-&gt;get('_route') == 'name_of_post_session_route') - that may or may not work, I can't remember the exact ordering of how routing runs (but I think it will work).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163157182" id="dsq-comment-2163157182">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163157182">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2163157182" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163157182" class="dsq-comment-text">
	                                <p>I would leave it in the pattern, but add this in getCredentials()</p><p></p><pre><code><br>public function getCredentials(Request $request)<br>{<br>    if ($request-&gt;getPathInfo() == '/api/v1/sessions') {<br>        // skip authentication for this one endpoint<br>        return;<br>    }<br>}<br></code></pre><p></p><p>Also make sure you have the "anonymous: ~" under your api_area firewall, to allow for anonymous requests.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163156212" id="dsq-comment-2163156212">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163156212">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2163156212" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163156212" class="dsq-comment-text">
	                                <p>That is exactly what I've asked minutes ago, how do I get postSessionAction() out from the pattern, can be achieved using Expression-based Authorization Language from JMSSecurityExtraBundle as shown here <a href="http://disq.us/url?url=http%3A%2F%2Fjmsyst.com%2Fbundles%2FJMSSecurityExtraBundle%2Fmaster%2Fexpressions%23reference%3AuSjxKYv8fk5lbK4OC1uVUmTvkRw&amp;cuid=1175718" rel="nofollow noopener">http://jmsyst.com/bundles/JMSS...</a> by adding isAuthenticated() as an annotation for that method? Or what you mean with "add an if statement in getCredentials and return null if the URL is to the postSessionAction endpoint"? Can I use routes instead of full Url?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163147917" id="dsq-comment-2163147917">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163147917">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2163147917" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163147917" class="dsq-comment-text">
	                                <p>One last question, how do I get out /api/v1/sessions from the pattern? that method is the one that creates a valid repTokenId so in that case I can't check for valid credentials, any advice?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163140722" id="dsq-comment-2163140722">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163140722">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2163140722" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163140722" class="dsq-comment-text">
	                                <p>Hey Reynier!</p><p>Yep, I'm definitely cool with you posting a blog post - I think it would be awesome :). Also, the findOneBy(array()) call does *not* throw an exception itself: it either returns a Representative object or null. But yes, you can definitely raise/throw a AuthenticationCredentialsNotFoundException in getCredentials() - that's a good way of doing it. You'll just need to make sure that your postSessionAction() endpoint is *not* under /api, otherwise people will get this "Authentication credentials could not be found" when they try to get the token. Alternatively, if this *is* under /api, then you could add an if statement in getCredentials and return null if the URL is to the postSessionAction endpoint. Basically, you *do* want to allow anonymous users to this endpoint.</p><p>Good luck!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163127856" id="dsq-comment-2163127856">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163127856">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2163127856" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163127856" class="dsq-comment-text">
	                                <p>Ok, many thanks, apparently is working now, I am raising this AuthenticationCredentialsNotFoundException "{"message":"Authentication credentials could not be found."}" but I think it makes sense since I am forcing a non existent `repTokenId` so this line `$user = $this-&gt;em-&gt;getRepository('PDOneBundle:Representative')-&gt;findOneBy(array('repTokenId' =&gt; $credentials))` will throw the exception because there is not user with that value. I will continue testing this stuff and will let you know if I had any new issue in the near future, great support. Lets be in touch for translation and as I said I will like to write a small post on my blog talking about my experience and adding this things related to security and so on. Are you ok with that?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2163115073" id="dsq-comment-2163115073">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2163115073">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-29</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2163115073" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2163115073" class="dsq-comment-text">
	                                <p>Hi Reynier!</p><p>Yes, this helps - I see the problem immediately - and it *is* indeed in security.yml as you thought. On each request, only *one* firewall is used, and the "pattern" key - which is a regular expression - is used to figure out which one firewall should be used. So right now, if I got to /api/foo, then Symfony looks at your main firewall, sees that it's pattern is ^/ (which matches everything) and selects *this* as the *one* firewall for this request. This means that anything under /api will use form_login - your api_area and the authenticator under it are never used.</p><p>Simple fix:</p><p>1) Add pattern: ^/api to your api_area firewall<br>2) Move your api_area firewall *above* the admin_area firewall. Then, /api/foo will match api_area, and all other non /api URLs will match the admin_area firewall.</p><p>When you do this, your var_dump and die() statements should be executed, and the entire process will probably start making more sense :).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2162156223" id="dsq-comment-2162156223">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2162156223">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-28</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2162156223" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2162156223" class="dsq-comment-text">
	                                <p>Nothing happen, not `var_dump()` is executed at all neither the `die()` so I think is not being used. Sadly I can't share the whole project is not public and copyright doesn't allow me to share, but let me know what you need in order to help me. This is the config.yml (where I define the service): <a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fpaquitodev%2Fcb0a2f7ed65e6d67458f%3ANc7PVDxijCjYMi3CIXJ6PsmFm78&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/paquit...</a> and this is the security.yml file: <a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fpaquitodev%2F2d4eee4a8865af2eef11%3AE9XKA5z7ewbOCQe3d3jVpZCy0PI&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/paquit...</a> , perhaps this is where the problem is and I am not seeing. I've re-read the docs several times, is not the first time I got headaches with authentication/authorization flow but have a few gaps yet. Notice I have changed this `{ path: ^/api/.*, role: ROLE_REPRESENTATIVE }` line since I have a ROLE_REPRESENTATIVE defined on security.yml so no need to add a ROLE_API_REP or so. I have changed also at getRoles() in Representative entity to be the same in both places.</p><p>Cheers</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2162068087" id="dsq-comment-2162068087">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2162068087">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-28</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2162068087" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2162068087" class="dsq-comment-text">
	                                <p>Hey Reynier!</p><p>If you put a var_dump($request);die; inside of your authenticator's getCredentials() method, does that execute? I want to make sure that your authenticator is configured correctly and is being used. I think that you're denying access with access_control (which is correct) but something is wrong with your authenticator. Either you are never being authenticated, or getRoles() is not returning ROLE_API_REP, so it looks like you do not have access.</p><p>Also, I recommend re-reading my documentation about Guard, and maybe also the introduction to Symfony's security chapter. You have a lot of pieces, but I don't think you totally understand how the "flow" of authentication works :). All authentication happens *before* your controller is executed. All you do in your controller (or access_control) is "authorization": i.e. you're checking to see if the current user (who may or may not be anonymous) has a role. And btw, checking for IS_AUTHENTICATED_ANONYMOUSLY actually does nothing - that always returns true - see the description here: <a href="http://disq.us/url?url=http%3A%2F%2Fsymfony.com%2Fdoc%2Fcurrent%2Fbook%2Fsecurity.html%23checking-to-see-if-a-user-is-logged-in-is-authenticated-fully%3AlniR7RmNYMJRp93DeXIAQldna4M&amp;cuid=1175718" rel="nofollow noopener">http://symfony.com/doc/current...</a></p><p>If you're able to post your entire setup somewhere on GitHub (i.e. a working project) - I can be even more helpful :).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2161880519" id="dsq-comment-2161880519">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2161880519">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-28</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2161880519" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2161880519" class="dsq-comment-text">
	                                <p>I'm still having two more issues here, regarding `security.yml`:</p><p></p><pre><code><br>    access_control:<br>        - { path: ^/login, roles: IS_AUTHENTICATED_ANONYMOUSLY }<br>        - { path: ^/api, role: ROLE_API_REP }<br>        - { path: ^/admin/.*, role: ROLE_ADMIN } <br></code></pre><p></p><p>I should allow IS_AUTHENTICATED_ANONYMOUSLY at this method <a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fpaquitodev%2F2dd24e497c88ded271b9%3AVzk-TT9zCzdnnDMPrNx-JjIs50M&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/paquit...</a> since is the one that authenticate reps, how I achieve that?</p><p>I'm getting an 403 forbidden exception even by sending `X-PDONE-SESSION-ID` as a request header, why?</p><p></p><pre><code><br>"error": {<br>    "code": 403,<br>    "message": "Forbidden",<br>    "message": "You do not have the necessary permissions",<br>    "class": "Symfony\\\\Component\\\\HttpKernel\\\\Exception\\\\AccessDeniedHttpException",<br>}<br></code></pre>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2161428083" id="dsq-comment-2161428083">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2161428083">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-28</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2161428083" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2161428083" class="dsq-comment-text">
	                                <p>Hey Reynier!</p><p>You're very close :). Adding the following changes will probably get what you want:</p><p>1) In Representative, change getRoles():</p><p></p><pre><code><br>public function getRoles()<br>{<br>    return array('ROLE_API_REP');<br>}<br></code></pre><p></p><p>2) In security.yml, restrict all calls under `/api` to require this role:</p><p></p><pre><code><br>security:<br>    # ...<br>    access_control:<br>        - { path:  ^/api, roles: ROLE_API_REP }<br></code></pre><p></p><p>The problem is simply that if you pass NO `X-PDONE-SESSION-ID`, then the authenticator does not deny access. Instead - because getCredentials() returns null - it allows the request to continue to your controller. BUT, that request is anonymous - it is not authenticated. So, as long as you have some code - either in access_control as shown here, or by calling isGranted('ROLE_API_REP') in your controller - that requires authentication, then this anonymous user will be denied access. Check out the 3 possibilities for getCredentials() in the table: <a href="https://disq.us/url?url=https%3A%2F%2Fknpuniversity.com%2Fscreencast%2Fguard%2Fapi-token%23getcredentials%3AiF8G6wZB81CM5HAK3Ih-nb8VPfs&amp;cuid=1175718" rel="nofollow noopener">https://knpuniversity.com/scre...</a></p><p>Does that help?</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2161184591" id="dsq-comment-2161184591">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2161184591">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-28</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2161184591" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2161184591" class="dsq-comment-text">
	                                <p>Hi @weaverryan, I think this is not working as should be. Why? Because I can call each method on the API and if I understood the purpose of the article that can't be allowed. Perhaps I am mistaken. What I am trying to do is authenticate the user (reps) before allow them to make any call to API methods. Right now I can call "/api/v1/reps/activity?_format=json&amp;rid=1" without generate, before, a X-PDONE-SESSION-ID and send it through headers on the request, so, what is wrong here?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2161047900" id="dsq-comment-2161047900">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2161047900">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-28</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2161047900" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2161047900" class="dsq-comment-text">
	                                <p>Yep, the entity looks ok to me :).</p><p>About "how do I check for valid token in each API call": You will *not* do this in your controller. The authenticator does this, and your authenticator is called before the controller is executed on every single request. So, by the time your controller is called, your user will already be authenticated or authentication will have already failed, and your controller won't be called. To find out which user (Representative in your case) is authenticated, you'll use the normal: $rep = $this-&gt;getUser(); in your controller.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2159527892" id="dsq-comment-2159527892">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2159527892">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-27</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2159527892" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2159527892" class="dsq-comment-text">
	                                <p>Ok, I think I got this, can you take a look to the entity I just fixed and tell me if that looks good to you and is enough to get Authentication via Api Token done? Here is the link <a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fpaquitodev%2Ffe4b35eeb586adf38399%3A_V7Vj9cqq5-DDE6iV4dWZFIHI_0&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/paquit...</a>. In the other side how do I check for valid token in each API call? By using this piece of code:</p><p></p><pre><code><br>if ($request-&gt;headers-&gt;get('X-PDONE-SESSION-ID') === '' || $request-&gt;headers-&gt;get('X-PDONE-SESSION-ID') === null || $request-&gt;headers-&gt;get('X-PDONE-SESSION-ID') !== $this-&gt;container-&gt;get('session')-&gt;get('X-PDONE-SESSION-ID')) {<br><br>    $view-&gt;setData(array('error' =&gt; 'missing or invalid session id'))-&gt;setStatusCode(400);<br>    return $view;<br>}<br></code></pre><p><br>Or how that part works?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2159501451" id="dsq-comment-2159501451">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2159501451">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-27</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2159501451" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2159501451" class="dsq-comment-text">
	                                <p>Yes, whatever you return from getUser() must implement UserInterface - that's a rule of Symfony's security, not just Guard. For any methods that don't really make sense - like getPassword() - just return `null`. The only one that should be important for you is getRoles() - make sure this returns at least *one* role - like ROLE_USER, or even ROLE_API_REP - whatever you want. Most of the other methods - like getPassword() - are important if you're letting Symfony handle a lot more of the authentication for you. You might also return the Rep's id for getUsername(), but that really shouldn't matter.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2159495394" id="dsq-comment-2159495394">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2159495394">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-27</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2159495394" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2159495394" class="dsq-comment-text">
	                                <p>When you said this " you have a "Representative" instead of a User - but that's no different, as long as your Representative implements UserInterface", Representative is my entity should it implements UserInterface? In that case I would add the following methods to the entity: getRoles(), getPassword(), getSalt(), getUsername(), eraseCredentials(), in that case what them should return? or declare the entity class as abstract, is this fine? This is an advanced topic for me so I am confused. Take a look to this very basic flow - <a href="http://disq.us/url?url=http%3A%2F%2Fimgur.com%2FjmatcEe%3AV-iNytF-OsYNX8AoaqT-qinkJps&amp;cuid=1175718" rel="nofollow noopener">http://imgur.com/jmatcEe</a> - of how things happen on the application and then based on that see if what we're talking is just fine</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2159427418" id="dsq-comment-2159427418">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2159427418">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-27</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2159427418" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2159427418" class="dsq-comment-text">
	                                <p>Hi again!</p><p>Ok, I think we understand each other quite well now :). It seems to me, then, that your situation is very close to the situation in this tutorial, except that you have a "Representative" instead of a User - but that's no different, as long as your Representative implements UserInterface :).</p><p>You posted this gist: <a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fpaquitodev%2F2e863d7d04e42dad34d1%3ARUVA9-tE5GB3ZT26b5b9vuKLNqQ&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/paquit...</a>. I think this - specifically getCredentials() and getUser() - is perfect :). The ApiTokenAuthenticator::getCredentials() is called on EVERY request. And as long as it returns something (a non-null value), then getUser() is also called on EVERY request. This means that your ApiTokenAuthenticator should already do what you need: it checks for a valid X-PDONE-SESSION-ID on every request. If the client sends a *bad* X-PDONE-SESSION-ID, then your getUser() will fail and they will fail authentication. If the client does *not* send an X-PDONE-SESSION-ID, then they will not fail authentication, but they will continue into the system as an anonymous user. As long as you are requiring a valid user on all endpoints (e.g. via access_control or calling isGranted() in your controllers), then those requests will eventually be denied access (this is when the start()) method is called.</p><p>Is that clear?</p><p>And yes, we have wanted the have posts in Spanish for a long time. Y tambin, puedo hablar/escribir en espaol, pero no con la calidad de un hispanohablante verdadero :). Nos gustara tener las traducciones publicados aqu en KnpUniversity, con crdito al traductor. Si tiene inters, me puede mandar un email - ryan@knpunversity.com.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2156587398" id="dsq-comment-2156587398">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2156587398">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-25</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2156587398" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2156587398" class="dsq-comment-text">
	                                <p>Ok, sorry for confuse you with my code, still in development and need a lot of improvement and I am not an expert as you can see ;) anyway, you're on the right path: a User (lets call it Reps from now on since this is not a system - meaning admin or any kind of FOSUser user) login from iOs app against Salesforce and return backs to API the username (the one it uses to login), the veeva token and the instance URL. In the beginning I created a session for check the existence and validity of X-PDONE-SESSION-ID but now using Guard I think I got this covered. Each subsequent API call should check for valid X-PDONE-SESSION-ID value on the headers, how? Again, you tried to explain me but I not  fully understand how to change my code to move to Guard and use Token authentication. Forget about session usage, I can get ride of it, can you provide me with a little set of classes and very basic flow as you did on main post for achieve this? (PS: Also I will like to translate and|or publish this post and other I've found on my site, can I? of course all the credits will goes to you and KnpLabs I am just bringing this to spanish community)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2156554149" id="dsq-comment-2156554149">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2156554149">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-25</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2156554149" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2156554149" class="dsq-comment-text">
	                                <p>Hi again!</p><p>I'm afraid I don't really understand the setup. It looks like this is the goal of your setup:</p><p>A) Allow the user to hit postSessionAction() with a username+veeva token. This is verified against SalesForce and a "representative id" is sent back (returned as a X-PDONE-SESSION-ID response header)</p><p>B) On future requests, the user simply sends this X-PDONE-SESSION-ID as a request header. You'll use it to authenticate the user</p><p>My big question:</p><p>I don't understand at all why you're setting Session data in postSessionAction(). Usually, API's are stateless/sessionless. This means that if I make a request to postSessionAction(), my next request to some other API endpoint will not include a session cookie, and so therefore I'll have a completely new, fresh session. So, what's going on here?</p><p>You have a setup that is *almost* what I'd expect, except for all the session-setting stuff. I don't think you need this. I'm guessing that once the user is authenticated, you'll need to know what "Representative" they are. If so, that is your "User", and you should return it from getUser() (which you are in fact doing). Just make sure that this implements UserInterface. Some methods like getPassword() won't make sense, so just return null - it's no problem.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2156526620" id="dsq-comment-2156526620">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2156526620">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-25</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2156526620" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2156526620" class="dsq-comment-text">
	                                <p>Hi there @weaverryan, I think I get a little bit confused before you try to give me such good explanation. Let me show you what I do in my postSessionAction() method which is the first method I call to create the X-PDONE-SESSION-ID that I will like to use along the current session to allow valid API calls (authenticate ones). This (<a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fpaquitodev%2F2dd24e497c88ded271b9%29%3AAHSyyzhozg3GZi2YSO6XrsDvzlU&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/paquit...</a> is the method and this is how ApiTokenAuthenticator looks (<a href="https://disq.us/url?url=https%3A%2F%2Fgist.github.com%2Fpaquitodev%2F2e863d7d04e42dad34d1%29%3AJ-PAtyuKwDB1AC5UxdNj3UX4bLc&amp;cuid=1175718" rel="nofollow noopener">https://gist.github.com/paquit...</a>, perhaps I am not following you at all but I will be very graceful if you take a look to this piece of code and give me another answer perhaps with some example code to start on.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2156460220" id="dsq-comment-2156460220">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2156460220">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-25</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2156460220" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2156460220" class="dsq-comment-text">
	                                <p>Hey Reynier!</p><p>Ultimately, when a user logs in, a User object will be created by you to represent that user. But this User object can be anything (as long as it implements UserInterface). And also, the "user provider" stuff system is technically optional. For example, you'll notice in this tutorial that I have a user provider configured in security.yml, but ultimately, even though that object is passed to getUser() in my authenticator, I don't use it at all. I believe that a user provider is only important if you're using session-based authentication. Specifically, at the beginning of each request, the User object (technically the token) is deserialized from the session, and UserProviderInterface::refreshUser() is called, in case you want to re-query the database to make sure the user info is up to date (but really, you could just return the User).</p><p>So, this is so far just a mixture of facts. I'm not sure of your exact situation, but here's an idea of what you might do:</p><p>A) Don't worry about the user provider at all. You already have one configured for FOSUserBundle, so let that one be used, but we won't use it for the API authentication.</p><p>B) In your API authenticator, do whatever you need to do to authenticate the user. If these users aren't system users (and so it doesn't really make sense to query the User table for them - I believe this is your case) - then just create some User class that implements UserInterface, put whatever data/methods that you find useful in it, and create a new User() and return it from getUser().</p><p>You may hit some issues, but the point is this: forget about using the user provider and create your own non-persisted User class if you want to. If you hit issues - let me know.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2156349633" id="dsq-comment-2156349633">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/reynierprezmira/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/9409/8076/avatar92.jpg?1479487025">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2156349633">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-25</span>
	                            <span class="dsq-commenter-name">Reynier Prez Mira</span>
	                        </div>

	                        <div id="dsq-comment-message-2156349633" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2156349633" class="dsq-comment-text">
	                                <p>Nice and excellent tutorial, I have a slightly different situation and would like to know and advice from yours guys. I have two types of users on my application: system users that uses FOSUserBundle and API users that login against Salesforce a cURL call from iOs app sending username+password and sending back to Restful API a token, a URL and a username, all that I need to continue from there (I don't need to know and|or handle users passwords at all) and then set a repApiToken in it's table. That last ones are not system users and only needs validate against Salesforce and therefore at any API call. I would like to know how you will handle authenticate via API token for users that hasn't any providers at all because they don't need. Can you give me some advice on this topic? I've started coding based on this tutorial but stopped because of this.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	        </ul>
	    </div>
            </div>

    <script type="text/javascript">
    var disqus_shortname = 'knpuniversity';
    var disqus_container_id = 'disqus_thread';var disqus_developer = 1;var disqus_identifier = 'course_video_api-token';var disqus_url = 'https://knpuniversity.com/screencast/guard/api-token';var disqus_config = function () {};

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

                                            </div>
                    <div class="pull-left-xs pull-right-md">
                                        <a class="btn btn-success"
           href="social-login#play">
            Next Chapter <i class="fa fa-caret-right"></i>
        </a>
    
                    </div>
                    <div class="pull-left addthis-module">
                        
    <div class="addthis_toolbox addthis_default_style js-analytics-addthis-wrapper addthis_32x32_style" addthis:url="http://knpuniversity.com/screencast/guard/api-token" addthis:title="KnpUGuard: Symfony Authentication with a Smile">
        <a class="addthis_button_preferred_1"></a>
        <a class="addthis_button_preferred_2"></a>
        <a class="addthis_button_preferred_3"></a>
        <a class="addthis_button_preferred_4"></a>
        <a class="addthis_button_compact"></a>
        <a class="addthis_counter addthis_bubble_style"></a>
    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<footer class="footer footer-styling">
    <div class="container">
        <div class="row">
                        <div class="col-xs-7 col-sm-4">
                <div class="row">
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../courses/all">All Courses</a></li>
                                                            <li><a class="knp-color-black" href="../../pricing.1">Pricing</a></li>
                                                        <li><a class="knp-color-black" href="../../faq">FAQ</a></li>
                            <li><a class="knp-color-black" href="../../training">Training</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../about">About</a></li>
                            <li><a class="knp-color-black" href="../../blog">Blog</a></li>
                            <li><a class="knp-color-black" href="../../contact">Contact Us</a></li>
                            <li>
                                <a class="knp-color-black" href="../../terms">Terms</a>
                                <span class="knp-color-black">&amp;</span>
                                <a class="knp-color-black" href="../../privacy">Privacy</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="hidden-xs col-sm-4">
                <p class="disclaimer">Symfony is a registered trademark of Fabien Potencier in the United States and/or other countries.
                This product is not endorsed or sponsored by Fabien Potencier.
                </p>
            </div>
            <div class="col-xs-5 col-sm-4">
                <div class="social-icons">
                    <a class="btn btn-social-icon btn-twitter" href="https://twitter.com/KnpUniversity">
                        <i class="fa fa-twitter"></i>
                    </a>
                    <a class="btn btn-social-icon btn-facebook" href="https://www.facebook.com/KnpLabs/">
                        <i class="fa fa-facebook"></i>
                    </a>
                    <a class="btn btn-social-icon btn-github" href="https://github.com/knpuniversity">
                        <i class="fa fa-github"></i>
                    </a>
                </div>
            </div>
                    </div>
    </div>
</footer>

<!-- JS -->
            <script>
        Core.analyticsVideoStatsUrl = '/api/analytics/video/duration';
    </script>

            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-7062980-20']);
        _gaq.push(['_trackPageview']);
    </script>
    <script>
    
    </script>
    
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
    
                <script type="text/javascript">
      (function() {
        var uv = document.createElement('script'); uv.type = 'text/javascript'; uv.async = true;
        uv.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'widget.uservoice.com/pOay2WLVabhXiEffbarO6Q.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(uv, s);
      })();

      UserVoice = window.UserVoice || [];
      UserVoice.push(['showTab', 'classic_widget', {
          tab_position: 'bottom-right',
          tab_label: 'Ideas or Feedback?',
          tab_color: '#005E8E'
      }]);
    </script>
        
            
        <script type="text/javascript">
    var _sf_async_config={uid:54262,domain:"knpuniversity.com",useCanonical:true};
    (function(){
      function loadChartbeat() {
        window._sf_endpt=(new Date()).getTime();
        var e = document.createElement('script');
        e.setAttribute('language', 'javascript');
        e.setAttribute('type', 'text/javascript');
        e.setAttribute('src', '//static.chartbeat.com/js/chartbeat.js');
        document.body.appendChild(e);
      }
      var oldonload = window.onload;
      window.onload = (typeof window.onload != 'function') ?
         loadChartbeat : function() { oldonload(); loadChartbeat(); };
    })();
    </script>
    
            <script>
            (function(){
                var t,i,e,n=window,o=document,a=arguments,s="script",r=["config","track","identify","visit","push","call"],c=function(){var t,i=this;for(i._e=[],t=0;r.length>t;t++)(function(t){i[t]=function(){return i._e.push([t].concat(Array.prototype.slice.call(arguments,0))),i}})(r[t])};for(n._w=n._w||{},t=0;a.length>t;t++)n._w[a[t]]=n[a[t]]=n[a[t]]||new c;i=o.createElement(s),i.async=1,i.src="//static.woopra.com/js/w.js",e=o.getElementsByTagName(s)[0],e.parentNode.insertBefore(i,e)
            })("woopra");

            woopra.config({
                domain: 'knpuniversity.com',
                download_tracking: true,
                outgoing_tracking: true
            });

                            woopra.identify({
                    userType: 'anonymous',
                    hasSubscription: 'no'
                });
                    </script>

        <script>
            woopra.track(
            'course_view_chapter',
            {"course":"guard","courseIsOwned":true,"chapter":"How to Authenticate via an API Token","chapterNumber":3,"chapterIsFree":false}
        );
    </script>

        <script>
            woopra.track();
        </script>
     
        <script type="text/javascript">
    var _qevents = _qevents || [];

    (function() {
    var elem = document.createElement('script');
    elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";
    elem.async = true;
    elem.type = "text/javascript";
    var scpt = document.getElementsByTagName('script')[0];
    scpt.parentNode.insertBefore(elem, scpt);
    })();

    _qevents.push({
    qacct:"p-8-SEHS37bhSQ0"
    });
    </script>

    <noscript>
    <div style="display:none;">
    <img src="http://pixel.quantserve.com/pixel/p-8-SEHS37bhSQ0.gif" border="0" height="1" width="1" alt="Quantcast"/>
    </div>
    </noscript>
    


    <script type="text/javascript" src="../../assets/vendor/jquery-sticky/jquery.sticky.js"></script>
    <script type="text/javascript" src="../../assets/vendor/zeroclipboard/dist/ZeroClipboard.min.js"></script>
    <script type="text/javascript" src="../../js/CodeBlocks.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/underscore.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/doctools.js"></script>

    <script>
        Core.courseTitle = 'KnpUGuard: Symfony Authentication with a Smile';
        Core.courseId = 65
        Core.courseIsOwned = true;
        Core.courseSlug = 'guard';
                    Core.chapterTitle = 'How to Authenticate via an API Token';
            Core.chapterNumber = 3;
            Core.chapterIsFree = false;
            Core.chapterSlug = 'api-token';
        
                var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '1.0.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
        };

        jQuery(document).ready(function() {
            // Stick left sidebar menu
            $('.js-sticker').sticky();

            var $scriptWrapper = $('.js-script-content-wrapper');
            var codeBlocks = new Core.CodeBlocks($scriptWrapper);

            var expandList = $('.js-expand-list');

            expandList.on('click', function(){
                var target = $(this).data('target');
                var $expandArea = $('#' + target);
                $expandArea.toggleClass('expanded');

                // http://stackoverflow.com/questions/2868582/click-outside-menu-to-close-in-jquery
                $(document).one('click', function closeExpandList (e){
                    if($expandArea.has(e.target).length === 0){
                        $expandArea.removeClass('expanded');
                    } else {
                        $(document).one('click', closeExpandList);
                    }
                });
            });
        });
    </script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>



    <script type="text/javascript">
    var addthis_share = {
        templates: {
            twitter: '{{title}} - {{url}} | via @KnpUniversity'
        }
    }
</script>
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=weaverryan"></script>

</body>
</html>
