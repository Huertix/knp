<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
            <script src="https://cdn.optimizely.com/js/421270022.js"></script>
    
                    <script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Filters > Go Pro with Doctrine Queries | KnpUniversity</title>

                    <link href="../../builds/main-db6835bf19d99bcc09032789f3bd39e4.css" rel="stylesheet">

        <link href='https://fonts.googleapis.com/css?family=Rokkitt' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Cedarville+Cursive' rel='stylesheet' type='text/css'>
    

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/tomorrow-night.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/tomorrow-night.min.css">


        <link rel="stylesheet" href="../../builds/code_block_styles-2d783e385d9dbb1ef88d9053d1b8d675.css">



    <link href="../../builds/video-6b5fa6dfb768239b226d39d08bd4867e.css" rel="stylesheet">

                        <script src="../../bundles/fosjsrouting/js/router.js"></script>

        <script src="../../builds/main-1dfa89b76a105f9c2d98.js"></script>
        <script src="../../js/routing?callback=fos.Router.setData"></script>
            

    <script>
        // video settings
        window.video = {
            isCourseChapterPaid: false,
            courseChapterId: 40308
        };

            </script>

    <script src="../../builds/video-1dfa89b76a105f9c2d98.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            var hashValue = window.location.hash.substr(1);
            if (hashValue.substr(0, 7) == 'comment') {
                // this is a #comment link - open up the comment tab!
                $('.nav-tabs a[href="#tab-comment"]').click();
            }
        });
    </script>

    <link rel="alternate" type="application/rss+xml" title="Blog feed with technical articles around PHP and screencast and tutorial updates from KnpUniversity.com" href="http://feeds.feedburner.com/knpuniversity" />

    <meta name="description" content="
You already know how to query with SQL, so learning how to do complex
queries with Doctrine should *not* give you a headache. In this series,
we&#039;ll learn the language Doctrine speaks (DQL), as well as the query
builder object, how to use complex query features and even how to run
good ol&#039; fashioned raw SQL queries with Doctrine. Because hey, sometimes
simplicity rules :).
">

    <meta property="og:site_name" content="KnpUniversity - PHP and Symfony Video Tutorial Screencasts">
    <meta name="twitter:site" content="@KnpUniversity"><link rel="shortcut icon" href="../../assets/images/favicon.ico">
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->    <meta property="og:title" content="Filters">
<meta property="og:description" content="
You already know how to query with SQL, so learning how to do complex
queries with Doctrine should *not* give you a headache. In this series,
we&amp;#039;ll learn the language Doctrine speaks (DQL), as well as the query
builder object, how to use complex query features and even how to run
good ol&amp;#039; fashioned raw SQL queries with Doctrine">
<meta property="og:url" content="http://knpuniversity.com/screencast/doctrine-queries/filters">
    <meta property="og:image" content="http://knpuniversity.com/imagine/course_video_poster_large/uploads/screencast/doctrine-queries:c4c30be78317e26076b8797261ff71d9c4e99033/doctrine-queries.png">

<meta name="twitter:card" content="summary">


                            
    </head>
<body data-user-id="" >
<nav class="navbar navbar-inverse nav-margin navbar-learning-layout">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle toggle-button collapsed" data-toggle="collapse" data-target="#js-navbar" aria-expanded="false" aria-controls="js-navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../logout" class="navbar-brand">
                <span class="knp-color-blue">Knp</span>
                <span class="knp-color-white">University</span>
            </a>
        </div>
        <form class="navbar-form navbar-left navbar-form-border" role="search" method="GET" action="http://knpuniversity.com/search">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search Tutorials" value="" name="q">

                <div class="input-group-btn">
                    <button class="btn btn-default" type="submit">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </div>
        </form>
        <div id="js-navbar" class="collapse-fix collapse navbar-right navbar-collapse">
            

<ul class="nav navbar-nav nav-narrowerOnSmall">
            <li><a href="../../checkout/subscription/team_yearly/5" title="Cart"><i class="fa fa-shopping-cart"></i></a></li>
        <li class="dropdown"><a href="filters#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <i class="fa fa-angle-down"></i></a>
        <ul class="dropdown-menu">
          <li><a href="../../tracks.1">Tracks</a></li>
          <li><a href="../../courses/all">All Courses</a></li>
        </ul>
    </li>
            <li><a href="../../pricing.1">Pricing</a></li>
        <li><a href="../../training">Training</a></li>
                <li class="visible-xs"><a href="../../logout">My Profile</a></li>
        <li class="visible-xs"><a href="../../logout">Sign Out</a></li>

            <li><a href="../../login.1">Log In</a></li>
        <li class="btn btn-sm btn-warning signup-btn"><a class="signup" href="../../signup/index.html">Sign Up</a></li>
    </ul>

        </div>
    </div>
</nav>


    




<div class="table-contents-container">
  <div class="container expandList" id="js-chapter-list">
      <button class="table-contents-container-button js-expand-list" data-target="js-chapter-list" title="Chapter List">
          <i class="fa fa-bars"></i>
                        10.
                            Filters
                </button>
      <div class="expandList-body">
          <div class="expandList-bodyInner">
              <h3 class="expandList-header">
                  <a class="course-title-expand" href="resume">Go Pro with Doctrine Queries</a>
              </h3>

                                <div class="watched-tut-progress-container watched-tut-progress-container-overview">
        <div class="watched-tut-progress-overview" style="width: 0%; margin-right: 100%;" title="0% complete"><span class="profile-progress-title">0%</span></div>
    </div>


              
              <div class="expand-chapter-list">
                      
    
    <!-- Table of contents -->
    <div class="chapter-list">
        <ul class="list-unstyled">
            
                
                                <li class="title chapter-list-item ">
            <a href="dql" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                1.
                        Doctrine DQL
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:58</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="query-builder" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                2.
                        The QueryBuilder
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 2:02</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="and-where-or-where" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                3.
                        And WHERE Or WHERE
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:27</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="joins" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                4.
                        JOINs!
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 3:27</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="joins-reduce-queries" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                5.
                        Joins and addSelect Reduce Queries
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 6:03</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="select-sum" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                6.
                        SELECT the SUM (or COUNT)
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 4:51</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="select-specific-fields" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                7.
                        Selecting Specific Fields
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 5:04</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="raw-sql-queries" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                8.
                        Raw SQL Queries
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 6:29</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item ">
            <a href="reusing-queries-query-builder" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                9.
                        Reusing Queries with the Query Builder
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 3:07</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


            
                
                                <li class="title chapter-list-item chapter-list-item-active">
            <a href="filters" class="">
                <div class="row">
                    <div class="col-xs-9">
                                                10.
                        Filters
                                            </div>

                                    <div class="col-xs-3 text-right">
                        <span> 10:29</span>
                    </div>
                                </div>
            </a>
            <div class="row">
                <div class="col-xs-12">
                                    </div>
            </div>
        </li>


                    </ul>
    </div>

    
              </div>
          </div>
      </div>
  </div>
  <div>
                <a href="../../pricing/doctrine-queries" class="btn btn-success pull-right-md download-buy-buttons">Buy <span class="hidden-xs">Access to Course</span></a>
              </div>
</div>


        <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-9 col-lg-10">
                <h1 class="account-header account-header-low-margin-top">Filters</h1>
                
                                    <p class="hidden-xs">
                        Course:
                        <a class="knp-color-black" href="resume"><em>Go Pro with Doctrine Queries Tutorial</em></a>                    </p>
                            </div>
        </div>

                <div class="row">
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <div class="full-block-container">
                    <div class="frame-padding">
                        <div id="player">
                                                                                <div>
                                                                <div class="row">
                                    <div class="end-show">
                                        <div class="xs-col-12">
                                            <p class="end-show-header">Keep learning!</p>
                                        </div>
                                        <div class="col-xs-12">
                                            <p class="end-show-link"><a href="../../pricing.1" class="btn btn-success btn-md">Start your All Access Pass</a></p>
                                        </div>
                                        <div class="col-xs-12">
                                            <p class="end-show-link text-center"><a href="../buy/collections" class="knp-color-white">Buy just this tutorial for $6.00</a></p>
                                        </div>
                                    </div>
                                </div>
                                                            </div>
                                                </div>
                    </div>
                </div>
            </div>
        </div>
         
        <div class="row">
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <div class="pull-right">
                                    <a class="btn btn-success"
           href="resume">
            Finish Course <i class="fa fa-caret-right"></i>
        </a>
    
                </div>

                <ul class="nav nav-tabs" role="tablist">
                    <li class="active"><a data-toggle="tab" href="filters#tab-script">Script</a></li>
                    <li><a data-toggle="tab" href="filters#tab-comment">
                        <i class="fa fa-comment-o"></i>
                                                    
                                                                                                (25+)
                                                                                        Conversation
                                            </a></li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="tab-script">
                        <div class="js-script-content-wrapper top-margin-script markdown-content">
                                                                                        <a href="https://github.com/knpuniversity/doctrine-queries/edit/master/knpu/filters.md" target="_blank" class="btn btn-default btn-circle pull-right js-tooltip" title="Edit on GitHub"><span class="fa fa-pencil"></span></a>
                                                                    <p>I setup my fixtures so that about half of my FortuneCookies have a "discontinued"
value of true. For our startup fortune cookie company, that means we don't
make them anymore. But we're not showing this information anywhere on the
frontend yet.</p>
<p>But what if we wanted to <em>only</em> show fortune cookies on the site that we're
still making? In other words, where <code>discontinued</code> is false. Yes yes, I know.
This is easy. We could just go into <code>CategoryRepository</code> and add some <code>andWhere()</code>
calls in here for <code>fc.discontinued = true</code>.</p>
<p>But what if we wanted this WHERE clause to be added automatically, and everywhere
across the site? That's possible, and it's called a Doctrine Filter.</p>
<h2 id="creating-the-filter-class">Creating the Filter Class <a class="headerlink" href="filters#creating-the-filter-class" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Let's start by creating the filter class itself. Create a new directory
called <code>Doctrine</code>. There's no real reason for that, just keeping organized.
In there, create a new class called <code>DiscontinuedFilter</code>, and make sure we
put it in the right namespace:</p>
<p><div class="code-block-wrapper" data-code-block-guid="17af1bef9b">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
            
            8 lines <span class="meta-divider"></span> <span title="src/AppBundle/Doctrine/DiscontinuedFilter.php">src/AppBundle/Doctrine/DiscontinuedFilter.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="1"></td>
            <td class="blob-code"><span class="hljs-meta">&lt;?php</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="2"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="3"></td>
            <td class="blob-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">AppBundle</span>\<span class="hljs-title">Doctrine</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="4"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="5"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DiscontinuedFilter</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="6"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>That's a nice blank class. To find out what goes inside, Google for
"Doctrine Filters" to get into their documentation. These filter classes
are simple: just extend the <code>SQLFilter</code> class, and that'll force us to have
one method. So let's do that - <code>extends SQLFilter</code>. My IDE is <em>angry</em> because
<code>SQLFilter</code> has an abstract method we need to add. I'll use PHPStorm's
Code-&gt;Generate shortcut and choose "Implement Methods". It does the work
of adding that <code>addFilterConstraint</code> method for me. And for some reason,
it's extra generous and gives me an extra <code>ClassMetadata</code> use statement,
so I'll take that out.</p>
<p><div class="code-block-wrapper" data-code-block-guid="48e41dda81">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-23" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            23 lines <span class="meta-divider"></span> <span title="src/AppBundle/Doctrine/DiscontinuedFilter.php">src/AppBundle/Doctrine/DiscontinuedFilter.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-2" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 2
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="3"></td>
            <td class="blob-code"><span class="hljs-keyword">namespace</span> <span class="hljs-title">AppBundle</span>\<span class="hljs-title">Doctrine</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="4"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="5"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ORM</span>\<span class="hljs-title">Mapping</span>\<span class="hljs-title">ClassMetadata</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="6"></td>
            <td class="blob-code"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ORM</span>\<span class="hljs-title">Query</span>\<span class="hljs-title">Filter</span>\<span class="hljs-title">SQLFilter</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DiscontinuedFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SQLFilter</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="10"></td>
            <td class="blob-code">    <span class="hljs-comment">/**</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="11"></td>
            <td class="blob-code">     * Gets the SQL query part to add to a query.</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code">     *</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code">     * <span class="hljs-doctag">@param</span> ClassMetaData $targetEntity</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="14"></td>
            <td class="blob-code">     * <span class="hljs-doctag">@param</span> string $targetTableAlias</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="15"></td>
            <td class="blob-code">     *</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">     * <span class="hljs-doctag">@return</span> string The constraint SQL if there is available, empty string otherwise.</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code">     */</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addFilterConstraint</span><span class="hljs-params">(ClassMetadata $targetEntity, $targetTableAlias)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">        <span class="hljs-comment">// ...</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Ok, here's how this works. <em>If</em> this filter is enabled - and we'll talk about
that - the <code>addFilterConstraint()</code> method will be called on every query.
And this is <em>our</em> chance to add a WHERE clause to it. The <code>$targetEntity</code>
argument is information about which entity we're querying for. Let's dump
that to test that the method is called, and to see what that looks like:</p>
<p><div class="code-block-wrapper" data-code-block-guid="9eb0c2c613">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-23" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            23 lines <span class="meta-divider"></span> <span title="src/AppBundle/Doctrine/DiscontinuedFilter.php">src/AppBundle/Doctrine/DiscontinuedFilter.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-7" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 7
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DiscontinuedFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SQLFilter</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="10-17" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 10 - 17
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addFilterConstraint</span><span class="hljs-params">(ClassMetadata $targetEntity, $targetTableAlias)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">        var_dump($targetEntity);<span class="hljs-keyword">die</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<h2 id="adding-the-filter">Adding the Filter <a class="headerlink" href="filters#adding-the-filter" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Next, Doctrine somehow has to know about this class. If you're using Doctrine
outside of Symfony, you'll use its <code>Configuration</code> object and call <code>addFilter</code>
on it:</p>
<pre><code class="language-php">// from http://doctrine-orm.readthedocs.org/en/latest/reference/filters.html#configuration
$config-&gt;addFilter('locale', '\Doctrine\Tests\ORM\Functional\MyLocaleFilter');</code></pre>
<p>You pass it the class name and some "key" - <code>locale</code> in their example.
This becomes its nickname, and we'll refer to the filter later by this key.</p>
<p>In Symfony, we need the same, but it's done with configuration. Open up
<code>app/config/config.yml</code> and find the <code>doctrine</code> spot, and under <code>orm</code>, add
<code>filters:</code>. On the next line, go out four spaces, make up a key for the
filter - I'll say <code>fortune_cookie_discontinued</code> and set that to the class
name: <code>AppBundle\Doctrine\DiscontinuedFilter</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="bd1c91b1b4">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-76" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            76 lines <span class="meta-divider"></span> <span title="app/config/config.yml">app/config/config.yml</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-46" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 46
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="47"></td>
            <td class="blob-code"><span class="hljs-attr">doctrine:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="48-62" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 48 - 62
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="63"></td>
            <td class="blob-code"><span class="hljs-attr">    orm:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="64-65" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 64 - 65
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="66"></td>
            <td class="blob-code"><span class="hljs-attr">        filters:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="67"></td>
            <td class="blob-code"><span class="hljs-attr">            fortune_cookie_discontinued:</span> AppBundle\Doctrine\DiscontinuedFilter</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="68-76" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 68 - 76
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Awesome - now Doctrine knows about our filter.</p>
<h2 id="enabling-a-filter">Enabling a Filter <a class="headerlink" href="filters#enabling-a-filter" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>But if you refresh the homepage, nothing! We do <em>not</em> hit our <code>die</code> statement.
Ok, so adding a filter to Doctrine is 2 steps. First, you say "Hey Doctrine,
this filter exists!" We just did that. Second, you need to <em>enable</em> the filter.
That ends up being nice, because it means you can enable or disable a filter
on different parts of your site.</p>
<p>Open up <code>FortuneController</code>. Let's enable the filter on our homepage. Yes
yes, we <em>are</em> going to enable this filter globally for the site later. Just
stay tuned.</p>
<p>To enable it here, first, get the <code>EntityManager</code>. And I'm going to add a
comment, which will help with auto-completion on the next steps:</p>
<p><div class="code-block-wrapper" data-code-block-guid="f86b84ca04">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-69" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            69 lines <span class="meta-divider"></span> <span title="src/AppBundle/Controller/FortuneController.php">src/AppBundle/Controller/FortuneController.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-10" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 10
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="11"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FortuneController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="13-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 13 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">homepageAction</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">        <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> EntityManager $em */</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">        $em = <span class="hljs-keyword">$this</span>-&gt;getDoctrine()-&gt;getManager();</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="20-36" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 20 - 36
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="37"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="38-67" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 38 - 67
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="68"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Once you have the entity manager, call <code>getFilters()</code> on it, then <code>enable()</code>.
The argument to <code>enable()</code> needs to be whatever nickname you gave the filter
before. Actually, I have a typo in mine - I'll fix that now. Copy the
<code>fortune_cookie_discontinued</code> string and pass it to <code>enable()</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="41148f2439">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-69" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            69 lines <span class="meta-divider"></span> <span title="src/AppBundle/Controller/FortuneController.php">src/AppBundle/Controller/FortuneController.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">homepageAction</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">        <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> EntityManager $em */</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">        $em = <span class="hljs-keyword">$this</span>-&gt;getDoctrine()-&gt;getManager();</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">        $em-&gt;getFilters()</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">            -&gt;enable(<span class="hljs-string">'fortune_cookie_discontinued'</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="22-36" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 22 - 36
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="37"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="38-69" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 38 - 69
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Filter class, check! Filter register, check! Filter enabled, check. Moment
of truth. Refresh! And there's our dumped <code>ClassMetadata</code>.</p>
<h2 id="adding-the-filter-logic">Adding the Filter Logic <a class="headerlink" href="filters#adding-the-filter-logic" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>We haven't put anything in <code>DiscontinuedFilter</code> yet, but most of the work
is done. That <code>ClassMetadata</code> argument is your best friend: this is the Doctrine
object that knows <em>everything</em> about the entity we're querying for. You can
read your annotation mapping config, get details on associations, find out
about the primary key and anything else your heart desires.</p>
<p>Now, this method will be called for <em>every</em> query. But we <em>only</em> want to
add our filtering logic if the query is for a <code>FortuneCookie</code>. To do that,
add: <code>if</code>, <code>$targetEntity-&gt;getReflectionClass()</code> - that's the PHP <code>ReflectionClass</code>
object, <code>-&gt;name() != AppBundle\Entity\FortuneCookie</code>, then we're going to
return an empty string:</p>
<p><div class="code-block-wrapper" data-code-block-guid="f2619c4809">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-27" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            27 lines <span class="meta-divider"></span> <span title="src/AppBundle/Doctrine/DiscontinuedFilter.php">src/AppBundle/Doctrine/DiscontinuedFilter.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-7" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 7
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DiscontinuedFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SQLFilter</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="10-17" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 10 - 17
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addFilterConstraint</span><span class="hljs-params">(ClassMetadata $targetEntity, $targetTableAlias)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> ($targetEntity-&gt;getReflectionClass()-&gt;name != <span class="hljs-string">'AppBundle\Entity\FortuneCookie'</span>) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="23-24" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 23 - 24
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="26"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>It's <em>gotta</em> be an empty string. That tells Doctrine: hey, I don't want to
add any WHERE clauses here - so just leave it alone. If you return null,
it adds the WHERE but doesn't put anything in it.</p>
<p>Below this, it's our time to shine. We're going to return what you want in
the WHERE clause. So we'll use <code>sprintf</code>, then <code>%s</code>. This will be the table
alias - I'll show you in a second. Then, <code>.discontinued = false</code>. This is
the string part of what we normally put in an <code>andWhere()</code> with the query
builder. To fill in the <code>%s</code>, pass in <code>$targetTableAlias</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="c83c7c29f7">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-27" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            27 lines <span class="meta-divider"></span> <span title="src/AppBundle/Doctrine/DiscontinuedFilter.php">src/AppBundle/Doctrine/DiscontinuedFilter.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-17" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 17
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addFilterConstraint</span><span class="hljs-params">(ClassMetadata $targetEntity, $targetTableAlias)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">        <span class="hljs-keyword">if</span> ($targetEntity-&gt;getReflectionClass()-&gt;name != <span class="hljs-string">'AppBundle\Entity\FortuneCookie'</span>) {</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">        }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="23"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> sprintf(<span class="hljs-string">'%s.discontinued = false'</span>, $targetTableAlias);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="26-27" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 26 - 27
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Remember how every entity in a query has an alias? We usually call <code>createQueryBuilder()</code>
and pass it something like <code>fc</code>. That's the alias. In this case, Doctrine
is <em>telling</em> us what the alias is so we can use it.</p>
<p>Alright. Refresh! Um ok, no errors. But it's also not obvious if this is
working. So look at the number of fortune cookies in each category: 1, 2,
3, 3, 3, 4. Go back to <code>FortuneController</code> and delete the <code>enable()</code> call.
Refresh again. Ah hah! All the numbers went <em>up</em> a little. Our filter is
working.</p>
<p>Put the <code>enable()</code> call back and refresh again. Click the database icon on
the web debug toolbar. You can see in the query that when we <code>LEFT JOIN</code>
to <code>fortune_cookie</code>, it added this <code>f1_.discontinued = false</code>. </p>
<p>Woh woh woh. This is more amazing than I've been promising. Even though our
query is for <code>Category</code>'s, it was smart enough to apply the filter when it
joined over to <code>FortuneCookie</code>. Because of this, when we call <code>Category::getFortuneCookies()</code>,
that's <em>only</em> going to have the ones that are <em>not</em> discontinued.
The filter is applied if the fortune cookie shows up <em>anywhere</em> in our query.</p>
<h2 id="passing-values-to-configuring-a-filter">Passing Values to/Configuring a Filter <a class="headerlink" href="filters#passing-values-to-configuring-a-filter" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Sometimes, like in an admin area, we might want to show only <em>discontinued</em>
fortune cookies. So can we control the value we're passing in the filter?
To do this, remove <code>false</code> and add another <code>%s</code>. Add another argument to
<code>sprintf</code>: <code>$this-&gt;getParameter('discontinued')</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="71eba395c1">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-27" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            27 lines <span class="meta-divider"></span> <span title="src/AppBundle/Doctrine/DiscontinuedFilter.php">src/AppBundle/Doctrine/DiscontinuedFilter.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-17" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 17
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addFilterConstraint</span><span class="hljs-params">(ClassMetadata $targetEntity, $targetTableAlias)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="20-23" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 20 - 23
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="24"></td>
            <td class="blob-code">        <span class="hljs-keyword">return</span> sprintf(<span class="hljs-string">'%s.discontinued = %s'</span>, $targetTableAlias, <span class="hljs-keyword">$this</span>-&gt;getParameter(<span class="hljs-string">'discontinued'</span>));</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="25"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="26-27" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 26 - 27
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>This is kind of like the parameters we use in the query builder, except instead
of using <code>:discontinued</code>, we concatenate it into the string. But wait! Won't
this make SQL injection attacks possible! I hope you were yelling that :).
But with filters, it's ok because <code>getParameter()</code> automatically adds the
escaping. So, it's no worry.</p>
<p>If we <em>just</em> did this and refreshed, we've got a great error!</p>
<pre><code>Parameter 'discontinued' does not exist.</code></pre>
<p>This new approach means that when we enable the filter, we need to pass this
value to it. In <code>FortuneController</code>, the <code>enable()</code> method actually
returns an instance of our <code>DiscontinuedFilter</code>. And now we can call <code>setParameter()</code>,
with the parameter name as the first argument and the value we want to set
it to as the second:</p>
<p><div class="code-block-wrapper" data-code-block-guid="9b5cb2f886">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-70" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            70 lines <span class="meta-divider"></span> <span title="src/AppBundle/Controller/FortuneController.php">src/AppBundle/Controller/FortuneController.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-15" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 15
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">homepageAction</span><span class="hljs-params">(Request $request)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">        <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> EntityManager $em */</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">        $em = <span class="hljs-keyword">$this</span>-&gt;getDoctrine()-&gt;getManager();</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">        $filters = $em-&gt;getFilters()</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">            -&gt;enable(<span class="hljs-string">'fortune_cookie_discontinued'</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="22"></td>
            <td class="blob-code">        $filters-&gt;setParameter(<span class="hljs-string">'discontinued'</span>, <span class="hljs-keyword">false</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="23-68" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 23 - 68
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="69"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Refresh! We see the slightly-lower cookie numbers. Change that to <code>true</code>
and we should see <em>really</em> low numbers. We do!</p>
<h2 id="enabling-a-filter-globally">Enabling a Filter Globally <a class="headerlink" href="filters#enabling-a-filter-globally" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Through all of this, you might be asking: "What good is a filter if I need
to enable it all the time." Well first, the nice thing about filters is that
you <em>do</em> have this ability to enable or disable them if you need to.</p>
<p>To enable a filter globally, you just need to follow these same steps in
the bootstrap of your app. To hook into the beginning process of Symfony,
we'll need an event listener.</p>
<p>I did the hard-work already and created a class called <code>BeforeRequestListener</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="8bc2168596">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-19" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            19 lines <span class="meta-divider"></span> <span title="src/AppBundle/EventListener/BeforeRequestListener.php">src/AppBundle/EventListener/BeforeRequestListener.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-7" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 7
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeforeRequestListener</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"></span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="10"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(EntityManager $em)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="11"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="12"></td>
            <td class="blob-code">        <span class="hljs-keyword">$this</span>-&gt;em = $em;</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="13"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="14"></td>
            <td class="blob-code"></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="15"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKernelRequest</span><span class="hljs-params">(GetResponseEvent $event)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code">        <span class="hljs-comment">// ...</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">}</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>For Symfony peeps, you'll recognize the code in my <code>services.yml</code>:</p>
<p><div class="code-block-wrapper" data-code-block-guid="9dd9c6d1b0">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
            
            10 lines <span class="meta-divider"></span> <span title="app/config/services.yml">app/config/services.yml</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="1"></td>
            <td class="blob-code"><span class="hljs-attr">services:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="2"></td>
            <td class="blob-code"><span class="hljs-attr">    before_request_listener:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="3"></td>
            <td class="blob-code"><span class="hljs-attr">        class:</span> AppBundle\EventListener\BeforeRequestListener</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="4"></td>
            <td class="blob-code"><span class="hljs-attr">        arguments:</span> [<span class="hljs-string">"@doctrine.orm.entity_manager"</span>]</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="5"></td>
            <td class="blob-code"><span class="hljs-attr">        tags:</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="6"></td>
            <td class="blob-code"><span class="hljs-bullet">            -</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="7"></td>
            <td class="blob-code"><span class="hljs-attr">                name:</span> kernel.event_listener</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="8"></td>
            <td class="blob-code"><span class="hljs-attr">                event:</span> kernel.request</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="9"></td>
            <td class="blob-code"><span class="hljs-attr">                method:</span> onKernelRequest</td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>It registers this as a service and the <code>tags</code> at the bottom says, "Hey, when
Symfony boots, like right at the very beginning, call the <code>onKernelRequest</code>
method." I'm also passing the <code>EntityManager</code> as the first argument to the
<code>__construct()</code> function. Because, ya know, we need that to enable filters.</p>
<p>Let's go steal the enabling code from <code>FortuneController</code>, take it all out
and paste it into <code>onKernelRequest</code>. Instead of simply <code>$em</code>, we have <code>$this-&gt;em</code>,
since it's set on a property:</p>
<p><div class="code-block-wrapper" data-code-block-guid="6602c00eaf">
    <div class="meta">
        <div class="actions">
            <span class="fa fa-clipboard js-activate-clipboard" data-toggle="tooltip" title="Copy Code" data-placement="top"></span>
        </div>
        <div class="info">
                        <span class="js-expand-all" data-range="1-23" data-toggle="tooltip" title="Show All Lines" data-placement="top">
                <i class="fa fa-expand js-icon-load-more"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </span>
            
            23 lines <span class="meta-divider"></span> <span title="src/AppBundle/EventListener/BeforeRequestListener.php">src/AppBundle/EventListener/BeforeRequestListener.php</span>
        </div>
    </div>
    <table class="hljs code-block-table">
        <tbody class="js-tr-container">
                <tr>
                    <td class="line-number line-number-expandable" data-range="1-14" data-last="0">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 1 - 14
                            </td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="15"></td>
            <td class="blob-code">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKernelRequest</span><span class="hljs-params">(GetResponseEvent $event)</span></td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="16"></td>
            <td class="blob-code">    </span>{</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="17"></td>
            <td class="blob-code">        $filter = <span class="hljs-keyword">$this</span>-&gt;em</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="18"></td>
            <td class="blob-code">            -&gt;getFilters()</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="19"></td>
            <td class="blob-code">            -&gt;enable(<span class="hljs-string">'fortune_cookie_discontinued'</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="20"></td>
            <td class="blob-code">        $filter-&gt;setParameter(<span class="hljs-string">'discontinued'</span>, <span class="hljs-keyword">false</span>);</td>
            </tr>
    <tr>
                    <td class="line-number line-number-displayed" data-line-number-displayed="21"></td>
            <td class="blob-code">    }</td>
            </tr>
    <tr>
                    <td class="line-number line-number-expandable" data-range="22-23" data-last="1">
                <i class="fa fa-arrows-v js-icon-load-more" data-toggle="tooltip" title="Show Lines" data-placement="left"></i>
                <i class="fa fa-spinner fa-spin js-icon-loading"></i>
            </td>
            <td class="gap-line">
                                                    ... lines 22 - 23
                            </td>
            </tr>

        </tbody>
    </table>
</div>
</p>
<p>Let's try it! Even though we took the <code>enable()</code> code out of the controller,
the numbers don't change: our filter is still working. If we click into
"Proverbs", we see only 1. But if I disable the filter, we see all 3.</p>
<p>That's it! You're dangerous. If you've ever built a multi-tenant site where
almost <em>every</em> query has a filter, life just got easy.</p>

    
                        </div>
                    </div>
                    <div class="tab-pane" id="tab-comment">
                        <h3>Leave a comment!</h3>
                                                        <div id="disqus_thread">
                <style type="text/css">
            #dsq-comments {padding: 10px 0 0}
            .dsq-comment {position: relative;clear: both;margin: 0 0 1.5em;}
            .dsq-avatar {left: 0;position: absolute;}
            .dsq-avatar img {border: 0 none;border-radius: 3px;height: 36px;width: 36px;}
            .dsq-comment-body {padding: 0 0 0 46px;}
            .dsq-comment-header {border: 1px solid rgba(0, 0, 0, 0.15);border-radius: 3px;font-size: 13px;line-height: 14px;margin: 0 0 1em;max-height: 36px;overflow: hidden;padding: 10px;position: relative;text-overflow: ellipsis;white-space: nowrap;}
            .dsq-comment-message {word-wrap: break-word;}
            .dsq-comment-message {line-height: 1.5em;margin: 0 0 1em;}
            .dsq-comment-text {display: inline;}
            .dsq-comment-date {float: right;font-size: 90%;margin: 0 12px 0 0;}
        </style>

	    <div id="dsq-content">
	        <ul id="dsq-comments">
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2952655299" id="dsq-comment-2952655299">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/avknor/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/7357/7352/avatar92.jpg?1476585650">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2952655299">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-16</span>
	                            <span class="dsq-commenter-name">avknor</span>
	                        </div>

	                        <div id="dsq-comment-message-2952655299" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2952655299" class="dsq-comment-text">
	                                <p>Thanks for your help <a data-dsq-mention="weaverryan:disqus" href="https://disq.us/url?url=https%3A%2F%2Fdisqus.com%2Fby%2Fweaverryan%2F%3APBIAkzK4hlYNCZurh4fY0tD6LIg&amp;cuid=1175718" rel="nofollow noopener">weaverryan</a> !</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2952091280" id="dsq-comment-2952091280">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2952091280">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-15</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2952091280" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2952091280" class="dsq-comment-text">
	                                <p>Hey <a data-dsq-mention="avknor:disqus" href="https://disqus.com/by/avknor/" rel="nofollow noopener">avknor</a>!</p><p>Ok, let's see if we can work this out :).</p><p>First, some background - which I'm pretty sure you understand - but in case it's useful for others in the future :)</p><p>When you use a filter, what you're actually doing is writing raw SQL that will be applied to your query - i.e. you are *not* writing the same type of code that you might put into a query builder (where we're building DQL, which is a little friendlier). For example, in DQL, you can set a parameter to an array for a WHERE IN statement, and when Doctrine translates this to the SQL string, it properly takes that array and implodes it as expected. But, that won't happen in a filter: ultimately what we need to return from addFilterConstraint() is a raw SQL string.</p><p>In fact, if you dig into the core of Doctrine, here's what the (summarized) code looks like that calls your filter:</p><p></p><pre><code><br>$filterClauses = array();<br>foreach ($filters as $filter) {<br>    if ($filterExpr = $filter-&gt;addFilterConstraint($targetEntity, $targetTableAlias)) {<br>        $filterClauses[] = '(' . $filterExpr . ')';<br>   }<br>}<br><br>// this is ultimately added to the raw SQL string, after the WHERE<br>return implode(' AND ', $filterClauses);<br></code></pre><p></p><p>Now, you tried to setParameter() and pass it an array... which makes perfect sense. The reason this doesn't work is simply because Doctrine apparently doesn't support this - you're not doing anything wrong. Here's the related issue: <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Fdoctrine%2Fdoctrine2%2Fissues%2F2624%3A_9RrqlvEGmqqKAbR6q-Se6SbHkY&amp;cuid=1175718" rel="nofollow noopener">https://github.com/doctrine/do...</a> and pull request to add the feature that was never merged (<a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Fdoctrine%2Fdoctrine2%2Fpull%2F1168%29%3AXnn4hNqks_TM2fIG-uzRGN8jZuA&amp;cuid=1175718" rel="nofollow noopener">https://github.com/doctrine/do...</a>. So, hopefully that at least makes you feel better - you *will* need some sort of a hack to make this happen.</p><p>About the relational field comment, in that case, since we're ultimately building raw SQL, you'd just set the id of the related entity via setParameter() (not the entire object) or an array of ids, via the hack - or "crutches" as you call it - I like that term... but don't like that it's necessary :).</p><p>Let me know if this helps! This was a shortcoming of Doctrine filters that I honestly wasn't aware of - the use-case makes perfect sense, but I had never hit it myself.</p><p>Oh, and by the way, the Gedmo DoctrineExtensions library has an interesting SoftDeletableFilter for 2 reasons:</p><p>1) They don't use getParameter(), and instead use some low-level methods to do some quoting. They don't use it here, but they could also manually quote a value by using $conn-&gt;quote().</p><p>2) They have a `$disabled` array property (which is not meant to be a parameter, but is still configuration) and they allow you to set this via a few public methods. What I mean is, in your case, you could actually avoid setParameter() and instead call your own public method on your filter to set the array of ids. This is still a little bit of a "crutch" but less than needing to json_encode and then remove quotes afterwards.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2951963890" id="dsq-comment-2951963890">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/avknor/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/7357/7352/avatar92.jpg?1476585650">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2951963890">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-15</span>
	                            <span class="dsq-commenter-name">avknor</span>
	                        </div>

	                        <div id="dsq-comment-message-2951963890" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2951963890" class="dsq-comment-text">
	                                <p>This is not actualy what I wanted. Let say: what if I wanted to filter by few values of field? For records of 2015 and 2016 years for example... So i need to set some sort of array-of-years  in -&gt;setParameter. But it want only strings! And sends an error when i'm trying to set something else.<br>How do you solve this?</p><p>Or even more complicated example. What if I need to filter by relational field. In this case I need to set entity as param of filter. Or even ArrayCollection of entities!</p><p>For now I'm decide it like this: I json_encode array before set it to setParameter in controller. And then I json_encode it in Filter class. BUT! There in Filter class I need to make one more step. I need to remove single and doublequotes from json string. Because they was added by setParameter to  escape string (thats why we love it )) ).</p><p>Code hacks like this we call "crutches" here in Russia. So I'd like to avoid of them and write more elegant code )</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2951150053" id="dsq-comment-2951150053">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2951150053">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-15</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2951150053" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2951150053" class="dsq-comment-text">
	                                <p>Hey!</p><p>I'm not sure off the top of my head - but it looks like you got a reply on SO that makes sense to me. Let us know if it works out!</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2949661538" id="dsq-comment-2949661538">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/avknor/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/7357/7352/avatar92.jpg?1476585650">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2949661538">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-10-14</span>
	                            <span class="dsq-commenter-name">avknor</span>
	                        </div>

	                        <div id="dsq-comment-message-2949661538" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2949661538" class="dsq-comment-text">
	                                <p>Filters are grate! But I can't find any info about how to set one filter to one query many times with different parameters ((<br>Please help me if you can.  Deadline is killing me ))</p><p>I made Q at Stackoverflow  <a href="http://disq.us/url?url=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F40034291%2Farray-as-parameter-in-doctrine-sqlfilter%3AsmBXmzCaPPvRnj9YI8XK2nJz9Z8&amp;cuid=1175718" rel="nofollow noopener">http://stackoverflow.com/quest...</a></p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2847932289" id="dsq-comment-2847932289">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/monika_szanda_a/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/21744/7057/avatar92.jpg?1471675359">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2847932289">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-08-20</span>
	                            <span class="dsq-commenter-name">Monika Szandaa</span>
	                        </div>

	                        <div id="dsq-comment-message-2847932289" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2847932289" class="dsq-comment-text">
	                                <p>Thank you very much for your help.</p><p>And my addFilterConstraint function may look like that:</p><p>$parameters = array();<br>if($this-&gt;hasParameter('discontinued'))<br>{<br>	$parameters[] = sprintf('%s.discontinued LIKE %s', $targetTableAlias, $this-&gt;getParameter('discontinued'));<br>}</p><p>if($this-&gt;hasParameter('discontinuedDate'))<br>{<br>	$parameters[] = sprintf('%s.discontinuedDate = %s', $targetTableAlias, $this-&gt;getParameter('discontinuedDate'));<br>}</p><p>$result = implode("AND ", $parameters);</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2847372396" id="dsq-comment-2847372396">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2847372396">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-08-19</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2847372396" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2847372396" class="dsq-comment-text">
	                                <p>Hey Monika!</p><p>Hmm, let's see. So, in this chapter, we have just one parameter: discontinued. Suppose we need *another* parameter - e.g. "discontinuedDate" (just for an example). You *should* be able to do this, simply by setting *both* parameters:</p><p></p><pre><code><br>$filter = $this-&gt;em<br>    -&gt;getFilters()<br>    -&gt;enable('fortune_cookie_discontinued');<br>$filter-&gt;setParameter('discontinued', false);<br>$filter-&gt;setParameter('discontinuedDate', new \DateTime('-1 day'));<br></code></pre><p></p><p>Does that help answer your question? Let me know either way :).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2845582331" id="dsq-comment-2845582331">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/monika_szanda_a/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/21744/7057/avatar92.jpg?1471675359">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2845582331">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-08-19</span>
	                            <span class="dsq-commenter-name">Monika Szandaa</span>
	                        </div>

	                        <div id="dsq-comment-message-2845582331" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2845582331" class="dsq-comment-text">
	                                <p>How can I use more then one parameters in Filter. Do I need to add another filter in config.yml with the same class name of filter?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2744462456" id="dsq-comment-2744462456">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/miryafa/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/10001/3998/avatar92.jpg?1432337684">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2744462456">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-06-22</span>
	                            <span class="dsq-commenter-name">Miryafa</span>
	                        </div>

	                        <div id="dsq-comment-message-2744462456" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2744462456" class="dsq-comment-text">
	                                <p>For anyone who just looked at this page without doing the rest of the course up to this point (as with me) and/or aren't using Symfony: You can access the current configuration with the following two lines:</p><p>$em = $this-&gt;getServiceLocator()-&gt;get('Doctrine\ORM\EntityManager');<br>$config = $em-&gt;getConfiguration();</p><p>And you just put those lines in the indexAction of your controller (or whichever action you want). So the $config line would look like this:</p><p>public function indexAction()<br>{</p><p>    // ... other code ...</p><p>    // from <a href="http://disq.us/url?url=http%3A%2F%2Fdoctrine-orm.readthedocs.org%2Fen%2Flatest%2Freference%2Ffilters.html%23configuration%3AICPeULuBPsCIEEHfi1tMuwIM6rA&amp;cuid=1175718" rel="nofollow noopener">http://doctrine-orm.readthedoc...</a><br>    $em = $this-&gt;getServiceLocator()-&gt;get('Doctrine\ORM\EntityManager');<br>    $config = $em-&gt;getConfiguration();<br>    $config-&gt;addFilter('locale', '\Doctrine\Tests\ORM\Functional\MyLocaleFilter');</p><p>    // ... other code ...</p><p>}</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2694600325" id="dsq-comment-2694600325">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/Votruba_Tomas/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/1270/8281/avatar92.jpg?1482363467">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2694600325">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-05-25</span>
	                            <span class="dsq-commenter-name">Tom Votruba</span>
	                        </div>

	                        <div id="dsq-comment-message-2694600325" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2694600325" class="dsq-comment-text">
	                                <p>Recently I wrote and article about decoupled Filters and how to build them:<br><a href="http://disq.us/url?url=http%3A%2F%2Fwww.tomasvotruba.cz%2Fblog%2F2016%2F04%2F30%2Fdecouple-your-doctrine-filters%3A1DfufCDUZbgsLW1ADGZV2ocon1A&amp;cuid=1175718" rel="nofollow noopener">http://www.tomasvotruba.cz/blo...</a></p><p>It's easy if you try :)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2576593499" id="dsq-comment-2576593499">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/Votruba_Tomas/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/1270/8281/avatar92.jpg?1482363467">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2576593499">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-18</span>
	                            <span class="dsq-commenter-name">Tom Votruba</span>
	                        </div>

	                        <div id="dsq-comment-message-2576593499" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2576593499" class="dsq-comment-text">
	                                <p>Thanks!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2576505811" id="dsq-comment-2576505811">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2576505811">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-18</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2576505811" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2576505811" class="dsq-comment-text">
	                                <p>I like it!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2576364804" id="dsq-comment-2576364804">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/Votruba_Tomas/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/1270/8281/avatar92.jpg?1482363467">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2576364804">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-18</span>
	                            <span class="dsq-commenter-name">Tom Votruba</span>
	                        </div>

	                        <div id="dsq-comment-message-2576364804" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2576364804" class="dsq-comment-text">
	                                <p>If you prefer using only Filter class and keep Controllers clean, you might like this package <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2FSymplify%2FModularDoctrineFilters%3Azcu4-33EdPnLrZCY-j2qWAGSpF4&amp;cuid=1175718" rel="nofollow noopener">https://github.com/Symplify/Mo...</a></p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2576362185" id="dsq-comment-2576362185">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/Votruba_Tomas/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/1270/8281/avatar92.jpg?1482363467">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2576362185">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2016-03-18</span>
	                            <span class="dsq-commenter-name">Tom Votruba</span>
	                        </div>

	                        <div id="dsq-comment-message-2576362185" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2576362185" class="dsq-comment-text">
	                                <p>Hi, this might be a solution for you: <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2FSymplify%2FModularDoctrineFilters%3Azcu4-33EdPnLrZCY-j2qWAGSpF4&amp;cuid=1175718" rel="nofollow noopener">https://github.com/Symplify/Mo...</a></p><p>It doesn't depend on Controller, nor Doctrine yaml configuration, nor Doctrine bundle. It is standalone and easily portable to any project.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2176420918" id="dsq-comment-2176420918">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/wargotgeorg/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2176420918">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-05</span>
	                            <span class="dsq-commenter-name">WarGot Georg</span>
	                        </div>

	                        <div id="dsq-comment-message-2176420918" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2176420918" class="dsq-comment-text">
	                                <p>Thanks for answer.<br>Big big sorry. I write answer for you with my code, but I later understand what I use query for database, this query also call sql filter, before I send parameter to this filter. Dead loop.</p><p>Code after<br><a href="http://disq.us/url?url=http%3A%2F%2Fcodepen.io%2Fanon%2Fpen%2FOVdORM%3Feditors%3D100%3AeFexgHcJnDFrmAjMbTaKczrmxfE&amp;cuid=1175718" rel="nofollow noopener">http://codepen.io/anon/pen/OVd...</a><br>before <br><a href="http://disq.us/url?url=http%3A%2F%2Fcodepen.io%2Fanon%2Fpen%2FxGMPqQ%3Feditors%3D100%3A-rL9iSslwksSNYn5cL23WKPndcs&amp;cuid=1175718" rel="nofollow noopener">http://codepen.io/anon/pen/xGM...</a> attention to the line 32</p><p>Thanks, good luck. Perfect article.</p><p>And as always, sorry my english -)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2176309075" id="dsq-comment-2176309075">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2176309075">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-05</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2176309075" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2176309075" class="dsq-comment-text">
	                                <p>Hey there!</p><p>I think your English is fine :). I don't know what your problem is, but the finished code for this tutorial *does* work (I just re-tried it). Specifically, in this sections - <a href="https://disq.us/url?url=https%3A%2F%2Fknpuniversity.com%2Fscreencast%2Fdoctrine-queries%2Ffilters%23passing-values-to-configuring-a-filter%3AuwjT5Y5WNfHfOUL_DBUtW8czbGE&amp;cuid=1175718" rel="nofollow noopener">https://knpuniversity.com/scre...</a> - if you don't call setParameter() in the listener, then you'll get the error "Parameter 'discontinued' does not exist." If you do not get this error, then I think it *is* working.</p><p>But one warning: after you call setParameter(), Doctrine "escapes" the value before passing it to your filter. So, if you pass it the string hello, the parameter will become 'hello' (a string with quotes in the string). If you pass false (like I do), this will become 0. So, it's possible that you're passing some value and it's being escaped in some unexpected way.</p><p>Good luck!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2176292974" id="dsq-comment-2176292974">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/wargotgeorg/">
	                            	                                <img alt="" src="http://a.disquscdn.com/1479321018/images/noavatar92.png">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2176292974">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-08-05</span>
	                            <span class="dsq-commenter-name">WarGot Georg</span>
	                        </div>

	                        <div id="dsq-comment-message-2176292974" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2176292974" class="dsq-comment-text">
	                                <p>Good afternoon.<br>There is a problem. In the filter, I do not get the parameter from eventlistener. The problem is then I don`t use controller. What to do.<br>Doctrine filter work before event listener.<br>Thanks.<br>P.S. Sorry my english -)</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2148894489" id="dsq-comment-2148894489">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2148894489">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-21</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2148894489" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2148894489" class="dsq-comment-text">
	                                <p>Criteria are a bit more interesting than I thought - I will admit I like the fluid interface that can be used to either make a query (with matching) or filter a collection (though I want to minimize doing this sort of thing).</p><p>If I start finding uses for it in my code, then I may add a chapter on it. It looks like a nice feature - but I'm not convinced yet that I'll have a pattern where I use it. Your point about using them in controllers is valid, but I still think I'll create custom repo methods. There's a lot of personal preference down at this level.</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2147432090" id="dsq-comment-2147432090">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/bocharsky25/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/11445/2822/avatar92.jpg?1482506193">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2147432090">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-20</span>
	                            <span class="dsq-commenter-name">Victor Bocharsky</span>
	                        </div>

	                        <div id="dsq-comment-message-2147432090" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2147432090" class="dsq-comment-text">
	                                <p>Wow.. :) I agree with you, Criteria more complex at first look and the beginners hard to use it. However, I could use criteria without custom entity repositories for minor things in any controller calling `matching()` method on entity repository. It's allowing me to avoid mixing layers. I mean using query builder in controllers is a wrong way because it mixing DB layer with controller business logic layer that violates MVC pattern, so this is a bad approach. Creating entity repository with many custom methods in some cases could be overhead. So in this cases criteria could help as well.</p><p>Also I like to easily apply criteria to already fetched <a href="http://disq.us/url?url=http%3A%2F%2Fdoctrine-orm.readthedocs.org%2Fen%2Flatest%2Freference%2Fworking-with-associations.html%23filtering-collections%3A-ux4VBDIYS0Nqg6uZx12ymov8tM&amp;cuid=1175718" rel="nofollow noopener">Doctrine array collections</a> calling `matching()` method on it. It's allowing me filtering any collection and avoid sending a new query to database again (filtering on PHP collection level).</p><p>Summing up, I think about *doctrine criteria* like about *array criteria* on steroids that I could passed to `fetchBy` and `fetchOneBy` methods :) It allowing me to use negotiation (NOT), partial matching (LIKE), checking for NULL and OR logical operations, &gt;, &lt; operators etc. that I can get directly in controller and that not supported by  `fetchBy` and `fetchOneBy` methods out-of-the-box.</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2146813686" id="dsq-comment-2146813686">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2146813686">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-20</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-2146813686" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2146813686" class="dsq-comment-text">
	                                <p><a data-dsq-mention="bocharsky25:disqus" href="https://disq.us/url?url=https%3A%2F%2Fdisqus.com%2Fby%2Fbocharsky25%2F%3AgIdqA26yExlw2J4mAvgXK7oxIYI&amp;cuid=1175718" rel="nofollow noopener">Victor Bocharsky</a> maybe...? :) I've never used them and avoid them on purpose because they always strike me as a really complicated way of doing something that could be done very easily inside a DQL string. So, instead of all the expression/criteria stuff (example <a href="http://disq.us/url?url=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F5349790%2Fhow-do-i-use-a-complex-criteria-inside-a-doctrine-2-entitys-repository%23answer-16105183%29%3AIAZiI6aXQEgBJgNJejVIN_VKYJ0&amp;cuid=1175718" rel="nofollow noopener">http://stackoverflow.com/quest...</a>, I'll just put what I need inside of an andWhere() string, like we do here: <a href="https://disq.us/url?url=https%3A%2F%2Fknpuniversity.com%2Fscreencast%2Fdoctrine-queries%2Fand-where-or-where%23or-where%3AvtBcVxp5jhjqW-r4NvOtx5lvRDg&amp;cuid=1175718" rel="nofollow noopener">https://knpuniversity.com/scre...</a>.</p><p>That's subjective - but it looks much easier to me than the Criteria stuff. But there may also be a use-case that can only be done with Critiera?</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="2146395417" id="dsq-comment-2146395417">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/bocharsky25/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/11445/2822/avatar92.jpg?1482506193">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-2146395417">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-07-20</span>
	                            <span class="dsq-commenter-name">Victor Bocharsky</span>
	                        </div>

	                        <div id="dsq-comment-message-2146395417" class="dsq-comment-message">
	                            <div id="dsq-comment-text-2146395417" class="dsq-comment-text">
	                                <p>It will be great to add a new screencast about Doctrine <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Fdoctrine%2Fcollections%2Fblob%2Fmaster%2Flib%2FDoctrine%2FCommon%2FCollections%2FCriteria.php%3A_ftsPC-R1Pnk01LrWmG473xCv1A&amp;cuid=1175718" rel="nofollow noopener">Criteria</a> to this tutorial. I think they awesome too! :)<br>What do you think, Ryan?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="1899539373" id="dsq-comment-1899539373">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-1899539373">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-03-10</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-1899539373" class="dsq-comment-message">
	                            <div id="dsq-comment-text-1899539373" class="dsq-comment-text">
	                                <p>I think you've summarized the options (that I know of) nicely:</p><p>1. I agree with your con<br>2. I think you're over-estimating the performance loss. And if you hydrate "extra lazy" and do a count of the children, the extra query will be done automatically.<br>3. Agree its over-kill<br>4. Yea, this may be slower than option (2)</p><p>So, I would do 2 - I'm certain it's not that big of a deal. And if it were, I'd start to employ other strategies - e.g. caching. The only exception is if I were processing MANY rows (e.g. making a CSV download) where I needed to keep memory managed. In that case, I'd probably be doing a low-level query (e.g. something like option 1, but with a Doctrine "iterator").</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="1899193992" id="dsq-comment-1899193992">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/pietrinoatzeni/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/13809/2509/avatar92.jpg?1423640655">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-1899193992">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-03-10</span>
	                            <span class="dsq-commenter-name">Pietrino Atzeni</span>
	                        </div>

	                        <div id="dsq-comment-message-1899193992" class="dsq-comment-message">
	                            <div id="dsq-comment-text-1899193992" class="dsq-comment-text">
	                                <p>:))) Maybe I'm trying to do something strange, but what I'd like to accomplish is something like this: I want to view a list of all "parent" classes, with a "count" of all their children (such as "users" and their "posts"). Now, I think the choices I have are:</p><p>1. hydrate arrays (just as you made in chapter "Selecting specific fields";<br>2. perform multiple queries (1 + 1*"number of parents") to retrieve all the children of each parent;<br>3. create a custom hydrator;<br>4. use joins.</p><p>Cons:<br>1. I will miss the objects logic;<br>2. I will kill performances because of queries;<br>3. seems overkilling, looking at the Doctrine docs;<br>4. I will kill performances if children hydrating tons of objects</p><p>Any idea?</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="1899032278" id="dsq-comment-1899032278">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/weaverryan/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/32/6480/avatar92.jpg?1482356913">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-1899032278">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-03-10</span>
	                            <span class="dsq-commenter-name">weaverryan</span>
	                        </div>

	                        <div id="dsq-comment-message-1899032278" class="dsq-comment-message">
	                            <div id="dsq-comment-text-1899032278" class="dsq-comment-text">
	                                <p>Hi Pietrino!</p><p>To be honest, I've never tried this before! But as far as I can tell, this is not possible. The only possibility I can think of is with a custom hydrator. That looks possible, but might not be worth it. I think part of the issue would be that if you were able to put this in annotations (e.g. something attached to the Category entity), Doctrine might not be able to perform the query needed to do that count. For example, counting "totalCookies" for a Category would require a join. So Doctrine would need you to add that join, it would need to make it automatically, or it would need to do a separate query. And the last option is already sort of possible - e.g. count($category-&gt;getCookies()) - which will be done by doing a fast COUNT() query if you use the extra lazy association: <a href="http://disq.us/url?url=http%3A%2F%2Fdoctrine-orm.readthedocs.org%2Fen%2Flatest%2Ftutorials%2Fextra-lazy-associations.html%3AlIMvYvN9nUwiIXzqRpBjwWP8jQ8&amp;cuid=1175718" rel="nofollow noopener">http://doctrine-orm.readthedoc...</a></p><p>It's possible I'm over-looking something in Doctrine, but this is what I know :).</p><p>Cheers!</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	                <li class="dsq-comment dsq-clearfix" data-dsq-comment-id="1898464974" id="dsq-comment-1898464974">
	                    <div class="dsq-avatar dsq-tt">
	                        <a href="https://disqus.com/by/pietrinoatzeni/">
	                            	                                <img alt="" src="http://a.disquscdn.com/uploads/users/13809/2509/avatar92.jpg?1423640655">
	                            	                        </a>
	                    </div>
	                    <div class="dsq-comment-body" id="dsq-comment-body-1898464974">
	                        <div class="dsq-comment-header">
	                            <span class="dsq-comment-date">2015-03-10</span>
	                            <span class="dsq-commenter-name">Pietrino Atzeni</span>
	                        </div>

	                        <div id="dsq-comment-message-1898464974" class="dsq-comment-message">
	                            <div id="dsq-comment-text-1898464974" class="dsq-comment-text">
	                                <p>Hi Ryan, great video as usual! Many things learned on the journey. I have still two questions that relate to filtering:</p><p>1. can we fetch objects (not arrays) with "extra" columns using DQL? For example, an object "Category" with the property "totalCookies" automatically hydrated?<br>2. if we can, can we also "declare" this "automatic hydration" in annotations (or yml/xml)?</p><p>Thanks,<br>Pietro</p>
	                            </div>
	                        </div>
	                    </div>
	                </li>
	            	        </ul>
	    </div>
            </div>

    <script type="text/javascript">
    var disqus_shortname = 'knpuniversity';
    var disqus_container_id = 'disqus_thread';var disqus_developer = 1;var disqus_identifier = 'course_video_filters';var disqus_url = 'https://knpuniversity.com/screencast/doctrine-queries/filters';var disqus_config = function () {};

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

                                            </div>
                    <div class="pull-left-xs pull-right-md">
                                        <a class="btn btn-success"
           href="resume">
            Finish Course <i class="fa fa-caret-right"></i>
        </a>
    
                    </div>
                    <div class="pull-left addthis-module">
                        
    <div class="addthis_toolbox addthis_default_style js-analytics-addthis-wrapper addthis_32x32_style" addthis:url="http://knpuniversity.com/screencast/doctrine-queries/filters" addthis:title="Go Pro with Doctrine Queries">
        <a class="addthis_button_preferred_1"></a>
        <a class="addthis_button_preferred_2"></a>
        <a class="addthis_button_preferred_3"></a>
        <a class="addthis_button_preferred_4"></a>
        <a class="addthis_button_compact"></a>
        <a class="addthis_counter addthis_bubble_style"></a>
    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<footer class="footer footer-styling">
    <div class="container">
        <div class="row">
                        <div class="col-xs-7 col-sm-4">
                <div class="row">
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../courses/all">All Courses</a></li>
                                                            <li><a class="knp-color-black" href="../../pricing.1">Pricing</a></li>
                                                        <li><a class="knp-color-black" href="../../faq">FAQ</a></li>
                            <li><a class="knp-color-black" href="../../training">Training</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-6">
                        <ul class="list-unstyled footer-link">
                            <li><a class="knp-color-black" href="../../about">About</a></li>
                            <li><a class="knp-color-black" href="../../blog">Blog</a></li>
                            <li><a class="knp-color-black" href="../../contact">Contact Us</a></li>
                            <li>
                                <a class="knp-color-black" href="../../terms">Terms</a>
                                <span class="knp-color-black">&amp;</span>
                                <a class="knp-color-black" href="../../privacy">Privacy</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="hidden-xs col-sm-4">
                <p class="disclaimer">Symfony is a registered trademark of Fabien Potencier in the United States and/or other countries.
                This product is not endorsed or sponsored by Fabien Potencier.
                </p>
            </div>
            <div class="col-xs-5 col-sm-4">
                <div class="social-icons">
                    <a class="btn btn-social-icon btn-twitter" href="https://twitter.com/KnpUniversity">
                        <i class="fa fa-twitter"></i>
                    </a>
                    <a class="btn btn-social-icon btn-facebook" href="https://www.facebook.com/KnpLabs/">
                        <i class="fa fa-facebook"></i>
                    </a>
                    <a class="btn btn-social-icon btn-github" href="https://github.com/knpuniversity">
                        <i class="fa fa-github"></i>
                    </a>
                </div>
            </div>
                    </div>
    </div>
</footer>

<!-- JS -->
            <script>
        Core.analyticsVideoStatsUrl = '/api/analytics/video/duration';
    </script>

            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-7062980-20']);
        _gaq.push(['_trackPageview']);
    </script>
    <script>
    
    </script>
    
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
    
                <script type="text/javascript">
      (function() {
        var uv = document.createElement('script'); uv.type = 'text/javascript'; uv.async = true;
        uv.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'widget.uservoice.com/pOay2WLVabhXiEffbarO6Q.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(uv, s);
      })();

      UserVoice = window.UserVoice || [];
      UserVoice.push(['showTab', 'classic_widget', {
          tab_position: 'bottom-right',
          tab_label: 'Ideas or Feedback?',
          tab_color: '#005E8E'
      }]);
    </script>
        
            
        <script type="text/javascript">
    var _sf_async_config={uid:54262,domain:"knpuniversity.com",useCanonical:true};
    (function(){
      function loadChartbeat() {
        window._sf_endpt=(new Date()).getTime();
        var e = document.createElement('script');
        e.setAttribute('language', 'javascript');
        e.setAttribute('type', 'text/javascript');
        e.setAttribute('src', '//static.chartbeat.com/js/chartbeat.js');
        document.body.appendChild(e);
      }
      var oldonload = window.onload;
      window.onload = (typeof window.onload != 'function') ?
         loadChartbeat : function() { oldonload(); loadChartbeat(); };
    })();
    </script>
    
            <script>
            (function(){
                var t,i,e,n=window,o=document,a=arguments,s="script",r=["config","track","identify","visit","push","call"],c=function(){var t,i=this;for(i._e=[],t=0;r.length>t;t++)(function(t){i[t]=function(){return i._e.push([t].concat(Array.prototype.slice.call(arguments,0))),i}})(r[t])};for(n._w=n._w||{},t=0;a.length>t;t++)n._w[a[t]]=n[a[t]]=n[a[t]]||new c;i=o.createElement(s),i.async=1,i.src="//static.woopra.com/js/w.js",e=o.getElementsByTagName(s)[0],e.parentNode.insertBefore(i,e)
            })("woopra");

            woopra.config({
                domain: 'knpuniversity.com',
                download_tracking: true,
                outgoing_tracking: true
            });

                            woopra.identify({
                    userType: 'anonymous',
                    hasSubscription: 'no'
                });
                    </script>

        <script>
            woopra.track(
            'course_view_chapter',
            {"course":"doctrine-queries","courseIsOwned":false,"chapter":"Filters","chapterNumber":10,"chapterIsFree":false}
        );
    </script>

        <script>
            woopra.track();
        </script>
     
        <script type="text/javascript">
    var _qevents = _qevents || [];

    (function() {
    var elem = document.createElement('script');
    elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";
    elem.async = true;
    elem.type = "text/javascript";
    var scpt = document.getElementsByTagName('script')[0];
    scpt.parentNode.insertBefore(elem, scpt);
    })();

    _qevents.push({
    qacct:"p-8-SEHS37bhSQ0"
    });
    </script>

    <noscript>
    <div style="display:none;">
    <img src="http://pixel.quantserve.com/pixel/p-8-SEHS37bhSQ0.gif" border="0" height="1" width="1" alt="Quantcast"/>
    </div>
    </noscript>
    


    <script type="text/javascript" src="../../assets/vendor/jquery-sticky/jquery.sticky.js"></script>
    <script type="text/javascript" src="../../assets/vendor/zeroclipboard/dist/ZeroClipboard.min.js"></script>
    <script type="text/javascript" src="../../js/CodeBlocks.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/underscore.js"></script>
    <script type="text/javascript" src="../../bundles/knpuniversity/sphinx/js/doctools.js"></script>

    <script>
        Core.courseTitle = 'Go Pro with Doctrine Queries';
        Core.courseId = 56
        Core.courseIsOwned = false;
        Core.courseSlug = 'doctrine-queries';
                    Core.chapterTitle = 'Filters';
            Core.chapterNumber = 10;
            Core.chapterIsFree = false;
            Core.chapterSlug = 'filters';
        
                var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '1.0.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
        };

        jQuery(document).ready(function() {
            // Stick left sidebar menu
            $('.js-sticker').sticky();

            var $scriptWrapper = $('.js-script-content-wrapper');
            var codeBlocks = new Core.CodeBlocks($scriptWrapper);

            var expandList = $('.js-expand-list');

            expandList.on('click', function(){
                var target = $(this).data('target');
                var $expandArea = $('#' + target);
                $expandArea.toggleClass('expanded');

                // http://stackoverflow.com/questions/2868582/click-outside-menu-to-close-in-jquery
                $(document).one('click', function closeExpandList (e){
                    if($expandArea.has(e.target).length === 0){
                        $expandArea.removeClass('expanded');
                    } else {
                        $(document).one('click', closeExpandList);
                    }
                });
            });
        });
    </script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>



    <script type="text/javascript">
    var addthis_share = {
        templates: {
            twitter: '{{title}} - {{url}} | via @KnpUniversity'
        }
    }
</script>
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=weaverryan"></script>

</body>
</html>
